/*
 jQuery UI - v1.9.1 - 2012-10-25
 http://jqueryui.com
 Includes: jquery.ui.widget.js
 Copyright 2012 jQuery Foundation and other contributors; Licensed MIT */
(function(d,c){var b=0,a=Array.prototype.slice,e=d.cleanData;d.cleanData=function(a){for(var f=0,b;null!=(b=a[f]);f++)try{d(b).triggerHandler("remove")}catch(l){}e(a)};d.widget=function(a,f,b){var e=a.split(".")[0];a=a.split(".")[1];var c=e+"-"+a;b||(b=f,f=d.Widget);d.expr[":"][c.toLowerCase()]=function(f){return!!d.data(f,c)};d[e]=d[e]||{};var k=d[e][a];var g=d[e][a]=function(f,a){if(!this._createWidget)return new g(f,a);arguments.length&&this._createWidget(f,a)};d.extend(g,k,{version:b.version,
_proto:d.extend({},b),_childConstructors:[]});var q=new f;q.options=d.widget.extend({},q.options);d.each(b,function(a,e){d.isFunction(e)&&(b[a]=function(){var b=function(){return f.prototype[a].apply(this,arguments)},c=function(b){return f.prototype[a].apply(this,b)};return function(){var f=this._super,a=this._superApply,k;return this._super=b,this._superApply=c,k=e.apply(this,arguments),this._super=f,this._superApply=a,k}}())});g.prototype=d.widget.extend(q,{widgetEventPrefix:q.widgetEventPrefix||
a},b,{constructor:g,namespace:e,widgetName:a,widgetBaseClass:c,widgetFullName:c});k?(d.each(k._childConstructors,function(f,a){var b=a.prototype;d.widget(b.namespace+"."+b.widgetName,g,a._proto)}),delete k._childConstructors):f._childConstructors.push(g);d.widget.bridge(a,g)};d.widget.extend=function(b){for(var f=a.call(arguments,1),e=0,g=f.length,m,p;e<g;e++)for(m in f[e])p=f[e][m],f[e].hasOwnProperty(m)&&p!==c&&(d.isPlainObject(p)?b[m]=d.isPlainObject(b[m])?d.widget.extend({},b[m],p):d.widget.extend({},
p):b[m]=p);return b};d.widget.bridge=function(b,f){var e=f.prototype.widgetFullName;d.fn[b]=function(k){var g="string"==typeof k,l=a.call(arguments,1),n=this;return k=!g&&l.length?d.widget.extend.apply(null,[k].concat(l)):k,g?this.each(function(){var f=d.data(this,e);if(!f)return d.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+k+"'");if(!d.isFunction(f[k])||"_"===k.charAt(0))return d.error("no such method '"+k+"' for "+b+" widget instance");var a=f[k].apply(f,
l);if(a!==f&&a!==c)return n=a&&a.jquery?n.pushStack(a.get()):a,!1}):this.each(function(){var a=d.data(this,e);a?a.option(k||{})._init():new f(k,this)}),n}};d.Widget=function(){};d.Widget._childConstructors=[];d.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(a,f){f=d(f||this.defaultElement||this)[0];this.element=d(f);this.uuid=b++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=d.widget.extend({},
this.options,this._getCreateOptions(),a);this.bindings=d();this.hoverable=d();this.focusable=d();f!==this&&(d.data(f,this.widgetName,this),d.data(f,this.widgetFullName,this),this._on(this.element,{remove:function(a){a.target===f&&this.destroy()}}),this.document=d(f.style?f.ownerDocument:f.document||f),this.window=d(this.document[0].defaultView||this.document[0].parentWindow));this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:d.noop,_getCreateEventData:d.noop,
_create:d.noop,_init:d.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(d.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:d.noop,widget:function(){return this.element},
option:function(a,f){var b=a,e;if(0===arguments.length)return d.widget.extend({},this.options);if("string"==typeof a){b={};var g=a.split(".");a=g.shift();if(g.length){var p=b[a]=d.widget.extend({},this.options[a]);for(e=0;e<g.length-1;e++)p[g[e]]=p[g[e]]||{},p=p[g[e]];a=g.pop();if(f===c)return p[a]===c?null:p[a];p[a]=f}else{if(f===c)return this.options[a]===c?null:this.options[a];b[a]=f}}return this._setOptions(b),this},_setOptions:function(a){for(var f in a)this._setOption(f,a[f]);return this},_setOption:function(a,
f){return this.options[a]=f,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!f).attr("aria-disabled",f),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(a,f){var b,e=this;f?(a=b=d(a),this.bindings=this.bindings.add(a)):(f=a,a=this.element,b=this.widget());d.each(f,function(f,c){function k(){if(!0!==
e.options.disabled&&!d(this).hasClass("ui-state-disabled"))return("string"==typeof c?e[c]:c).apply(e,arguments)}"string"!=typeof c&&(k.guid=c.guid=c.guid||k.guid||d.guid++);var g=f.match(/^(\w+)\s*(.*)$/),l=g[1]+e.eventNamespace;(g=g[2])?b.delegate(g,l,k):a.bind(l,k)})},_off:function(a,f){f=(f||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;a.unbind(f).undelegate(f)},_delay:function(a,f){var b=this;return setTimeout(function(){return("string"==typeof a?b[a]:a).apply(b,arguments)},
f||0)},_hoverable:function(a){this.hoverable=this.hoverable.add(a);this._on(a,{mouseenter:function(f){d(f.currentTarget).addClass("ui-state-hover")},mouseleave:function(f){d(f.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(a){this.focusable=this.focusable.add(a);this._on(a,{focusin:function(f){d(f.currentTarget).addClass("ui-state-focus")},focusout:function(f){d(f.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(a,f,b){var e,c=this.options[a];b=b||{};f=d.Event(f);
f.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();f.target=this.element[0];if(a=f.originalEvent)for(e in a)e in f||(f[e]=a[e]);return this.element.trigger(f,b),!(d.isFunction(c)&&!1===c.apply(this.element[0],[f].concat(b))||f.isDefaultPrevented())}};d.each({show:"fadeIn",hide:"fadeOut"},function(a,f){d.Widget.prototype["_"+a]=function(b,e,c){"string"==typeof e&&(e={effect:e});var k=e?!0===e||"number"==typeof e?f:e.effect||f:a;e=e||{};"number"==typeof e&&(e={duration:e});
var g=!d.isEmptyObject(e);e.complete=c;e.delay&&b.delay(e.delay);g&&d.effects&&(d.effects.effect[k]||!1!==d.uiBackCompat&&d.effects[k])?b[a](e):k!==a&&b[k]?b[k](e.duration,e.easing,c):b.queue(function(f){d(this)[a]();c&&c.call(b[0]);f()})}});!1!==d.uiBackCompat&&(d.Widget.prototype._getCreateOptions=function(){return d.metadata&&d.metadata.get(this.element[0])[this.widgetName]})})(jQuery);
(function(d){"function"===typeof define&&define.amd?define(["jquery"],d):d(window.jQuery)})(function(d){var c=0;d.ajaxTransport("iframe",function(b){if(b.async){var a=b.initialIframeSrc||"javascript:false;",e,g,f;return{send:function(k,l){e=d('<form style="display:none;"></form>');e.attr("accept-charset",b.formAcceptCharset);f=/\?/.test(b.url)?"&":"?";"DELETE"===b.type?(b.url=b.url+f+"_method=DELETE",b.type="POST"):"PUT"===b.type?(b.url=b.url+f+"_method=PUT",b.type="POST"):"PATCH"===b.type&&(b.url=
b.url+f+"_method=PATCH",b.type="POST");c+=1;g=d('<iframe src="'+a+'" name="iframe-transport-'+c+'"></iframe>').bind("load",function(){var f=d.isArray(b.paramName)?b.paramName:[b.paramName];g.unbind("load").bind("load",function(){try{var f=g.contents();if(!f.length||!f[0].firstChild)throw Error();}catch(q){f=void 0}l(200,"success",{iframe:f});d('<iframe src="'+a+'"></iframe>').appendTo(e);window.setTimeout(function(){e.remove()},0)});e.prop("target",g.prop("name")).prop("action",b.url).prop("method",
b.type);b.formData&&d.each(b.formData,function(f,a){d('<input type="hidden"/>').prop("name",a.name).val(a.value).appendTo(e)});if(b.fileInput&&b.fileInput.length&&"POST"===b.type){var c=b.fileInput.clone();b.fileInput.after(function(f){return c[f]});b.paramName&&b.fileInput.each(function(a){d(this).prop("name",f[a]||b.paramName)});e.append(b.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data");b.fileInput.removeAttr("form")}e.submit();c&&c.length&&b.fileInput.each(function(f,
a){var b=d(c[f]);d(a).prop("name",b.prop("name")).attr("form",b.attr("form"));b.replaceWith(a)})});e.append(g).appendTo(document.body)},abort:function(){g&&g.unbind("load").prop("src",a);e&&e.remove()}}}});d.ajaxSetup({converters:{"iframe text":function(b){return b&&d(b[0].body).text()},"iframe json":function(b){return b&&d.parseJSON(d(b[0].body).text())},"iframe html":function(b){return b&&d(b[0].body).html()},"iframe xml":function(b){return(b=b&&b[0])&&d.isXMLDoc(b)?b:d.parseXML(b.XMLDocument&&
b.XMLDocument.xml||d(b.body).html())},"iframe script":function(b){return b&&d.globalEval(d(b[0].body).text())}}})});
(function(d){"function"===typeof define&&define.amd?define(["jquery","jquery.ui.widget"],d):d(window.jQuery)})(function(d){d.support.fileInput=!(/(Android (1\.[0156]|2\.[01]))|(Windows Phone (OS 7|8\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1\.0|2\.[05]|3\.0))/.test(window.navigator.userAgent)||d('<input type="file">').prop("disabled"));d.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader);d.support.xhrFormDataFileUpload=!!window.FormData;d.support.blobSlice=
window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);d.widget("blueimp.fileupload",{options:{dropZone:d(document),pasteZone:d(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,
uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(c,b){c=this.messages[c]||c.toString();b&&d.each(b,function(a,b){c=c.replace("{"+a+"}",b)});return c},formData:function(c){return c.serializeArray()},add:function(c,b){if(c.isDefaultPrevented())return!1;(b.autoUpload||!1!==b.autoUpload&&d(this).fileupload("option","autoUpload"))&&b.process().done(function(){b.submit()})},processData:!1,
contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:d.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.bitrate=this.loaded=0;this.getBitrate=function(c,b,a){var e=c-this.timestamp;if(!this.bitrate||!a||e>a)this.bitrate=1E3/e*(b-this.loaded)*8,this.loaded=b,this.timestamp=c;return this.bitrate}},
_isXHRUpload:function(c){return!c.forceIframeTransport&&(!c.multipart&&d.support.xhrFileUpload||d.support.xhrFormDataFileUpload)},_getFormData:function(c){if("function"===d.type(c.formData))return c.formData(c.form);if(d.isArray(c.formData))return c.formData;if("object"===d.type(c.formData)){var b=[];d.each(c.formData,function(a,e){b.push({name:a,value:e})});return b}return[]},_getTotal:function(c){var b=0;d.each(c,function(a,e){b+=e.size||1});return b},_initProgressObject:function(c){var b={loaded:0,
total:0,bitrate:0};c._progress?d.extend(c._progress,b):c._progress=b},_initResponseObject:function(c){var b;if(c._response)for(b in c._response)c._response.hasOwnProperty(b)&&delete c._response[b];else c._response={}},_onProgress:function(c,b){if(c.lengthComputable){var a=Date.now?Date.now():(new Date).getTime();if(!(b._time&&b.progressInterval&&a-b._time<b.progressInterval&&c.loaded!==c.total)){b._time=a;var e=Math.floor(c.loaded/c.total*(b.chunkSize||b._progress.total))+(b.uploadedBytes||0);this._progress.loaded+=
e-b._progress.loaded;this._progress.bitrate=this._bitrateTimer.getBitrate(a,this._progress.loaded,b.bitrateInterval);b._progress.loaded=b.loaded=e;b._progress.bitrate=b.bitrate=b._bitrateTimer.getBitrate(a,e,b.bitrateInterval);this._trigger("progress",d.Event("progress",{delegatedEvent:c}),b);this._trigger("progressall",d.Event("progressall",{delegatedEvent:c}),this._progress)}}},_initProgressListener:function(c){var b=this,a=c.xhr?c.xhr():d.ajaxSettings.xhr();a.upload&&(d(a.upload).bind("progress",
function(a){var e=a.originalEvent;a.lengthComputable=e.lengthComputable;a.loaded=e.loaded;a.total=e.total;b._onProgress(a,c)}),c.xhr=function(){return a})},_isInstanceOf:function(c,b){return Object.prototype.toString.call(b)==="[object "+c+"]"},_initXHRData:function(c){var b=this,a=c.files[0],e=c.multipart||!d.support.xhrFileUpload,g="array"===d.type(c.paramName)?c.paramName[0]:c.paramName;c.headers=d.extend({},c.headers);c.contentRange&&(c.headers["Content-Range"]=c.contentRange);e&&!c.blob&&this._isInstanceOf("File",
a)||(c.headers["Content-Disposition"]='attachment; filename="'+encodeURI(a.name)+'"');if(!e)c.contentType=a.type||"application/octet-stream",c.data=c.blob||a;else if(d.support.xhrFormDataFileUpload){if(c.postMessage){var f=this._getFormData(c);c.blob?f.push({name:g,value:c.blob}):d.each(c.files,function(a,b){f.push({name:"array"===d.type(c.paramName)&&c.paramName[a]||g,value:b})})}else b._isInstanceOf("FormData",c.formData)?f=c.formData:(f=new FormData,d.each(this._getFormData(c),function(a,b){f.append(b.name,
b.value)})),c.blob?f.append(g,c.blob,a.name):d.each(c.files,function(a,e){(b._isInstanceOf("File",e)||b._isInstanceOf("Blob",e))&&f.append("array"===d.type(c.paramName)&&c.paramName[a]||g,e,e.uploadName||e.name)});c.data=f}c.blob=null},_initIframeSettings:function(c){var b=d("<a></a>").prop("href",c.url).prop("host");c.dataType="iframe "+(c.dataType||"");c.formData=this._getFormData(c);c.redirect&&b&&b!==location.host&&c.formData.push({name:c.redirectParamName||"redirect",value:c.redirect})},_initDataSettings:function(c){this._isXHRUpload(c)?
(this._chunkedUpload(c,!0)||(c.data||this._initXHRData(c),this._initProgressListener(c)),c.postMessage&&(c.dataType="postmessage "+(c.dataType||""))):this._initIframeSettings(c)},_getParamName:function(c){var b=d(c.fileInput),a=c.paramName;a?d.isArray(a)||(a=[a]):(a=[],b.each(function(){for(var b=d(this),c=b.prop("name")||"files[]",b=(b.prop("files")||[1]).length;b;)a.push(c),--b}),a.length||(a=[b.prop("name")||"files[]"]));return a},_initFormSettings:function(c){c.form&&c.form.length||(c.form=d(c.fileInput.prop("form")),
c.form.length||(c.form=d(this.options.fileInput.prop("form"))));c.paramName=this._getParamName(c);c.url||(c.url=c.form.prop("action")||location.href);c.type=(c.type||"string"===d.type(c.form.prop("method"))&&c.form.prop("method")||"").toUpperCase();"POST"!==c.type&&"PUT"!==c.type&&"PATCH"!==c.type&&(c.type="POST");c.formAcceptCharset||(c.formAcceptCharset=c.form.attr("accept-charset"))},_getAJAXSettings:function(c){c=d.extend({},this.options,c);this._initFormSettings(c);this._initDataSettings(c);
return c},_getDeferredState:function(c){return c.state?c.state():c.isResolved()?"resolved":c.isRejected()?"rejected":"pending"},_enhancePromise:function(c){c.success=c.done;c.error=c.fail;c.complete=c.always;return c},_getXHRPromise:function(c,b,a){var e=d.Deferred(),g=e.promise();b=b||this.options.context||g;!0===c?e.resolveWith(b,a):!1===c&&e.rejectWith(b,a);g.abort=e.promise;return this._enhancePromise(g)},_addConvenienceMethods:function(c,b){var a=this,e=function(b){return d.Deferred().resolveWith(a,
b).promise()};b.process=function(c,f){if(c||f)b._processQueue=this._processQueue=(this._processQueue||e([this])).pipe(function(){return b.errorThrown?d.Deferred().rejectWith(a,[b]).promise():e(arguments)}).pipe(c,f);return this._processQueue||e([this])};b.submit=function(){"pending"!==this.state()&&(b.jqXHR=this.jqXHR=!1!==a._trigger("submit",d.Event("submit",{delegatedEvent:c}),this)&&a._onSend(c,this));return this.jqXHR||a._getXHRPromise()};b.abort=function(){if(this.jqXHR)return this.jqXHR.abort();
this.errorThrown="abort";a._trigger("fail",null,this);return a._getXHRPromise(!1)};b.state=function(){if(this.jqXHR)return a._getDeferredState(this.jqXHR);if(this._processQueue)return a._getDeferredState(this._processQueue)};b.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===a._getDeferredState(this._processQueue)};b.progress=function(){return this._progress};b.response=function(){return this._response}},_getUploadedBytes:function(c){return(c=(c=(c=c.getResponseHeader("Range"))&&
c.split("-"))&&1<c.length&&parseInt(c[1],10))&&c+1},_chunkedUpload:function(c,b){c.uploadedBytes=c.uploadedBytes||0;var a=this,e=c.files[0],g=e.size,f=c.uploadedBytes,k=c.maxChunkSize||g,l=this._blobSlice,m=d.Deferred(),p=m.promise(),n;if(!(this._isXHRUpload(c)&&l&&(f||k<g))||c.data)return!1;if(b)return!0;if(f>=g)return e.error=c.i18n("uploadedBytes"),this._getXHRPromise(!1,c.context,[null,"error",e.error]);var q=function(){var b=d.extend({},c),p=b._progress.loaded;b.blob=l.call(e,f,f+k,e.type);b.chunkSize=
b.blob.size;b.contentRange="bytes "+f+"-"+(f+b.chunkSize-1)+"/"+g;a._initXHRData(b);a._initProgressListener(b);n=(!1!==a._trigger("chunksend",null,b)&&d.ajax(b)||a._getXHRPromise(!1,b.context)).done(function(e,k,l){f=a._getUploadedBytes(l)||f+b.chunkSize;p+b.chunkSize-b._progress.loaded&&a._onProgress(d.Event("progress",{lengthComputable:!0,loaded:f-b.uploadedBytes,total:f-b.uploadedBytes}),b);c.uploadedBytes=b.uploadedBytes=f;b.result=e;b.textStatus=k;b.jqXHR=l;a._trigger("chunkdone",null,b);a._trigger("chunkalways",
null,b);f<g?q():m.resolveWith(b.context,[e,k,l])}).fail(function(f,e,c){b.jqXHR=f;b.textStatus=e;b.errorThrown=c;a._trigger("chunkfail",null,b);a._trigger("chunkalways",null,b);m.rejectWith(b.context,[f,e,c])})};this._enhancePromise(p);p.abort=function(){return n.abort()};q();return p},_beforeSend:function(c,b){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(b);this._initProgressObject(b);
b._progress.loaded=b.loaded=b.uploadedBytes||0;b._progress.total=b.total=this._getTotal(b.files)||1;b._progress.bitrate=b.bitrate=0;this._active+=1;this._progress.loaded+=b.loaded;this._progress.total+=b.total},_onDone:function(c,b,a,e){var g=e._progress.total,f=e._response;e._progress.loaded<g&&this._onProgress(d.Event("progress",{lengthComputable:!0,loaded:g,total:g}),e);f.result=e.result=c;f.textStatus=e.textStatus=b;f.jqXHR=e.jqXHR=a;this._trigger("done",null,e)},_onFail:function(c,b,a,e){var g=
e._response;e.recalculateProgress&&(this._progress.loaded-=e._progress.loaded,this._progress.total-=e._progress.total);g.jqXHR=e.jqXHR=c;g.textStatus=e.textStatus=b;g.errorThrown=e.errorThrown=a;this._trigger("fail",null,e)},_onAlways:function(c,b,a,e){this._trigger("always",null,e)},_onSend:function(c,b){b.submit||this._addConvenienceMethods(c,b);var a=this,e,g,f=a._getAJAXSettings(b),k=function(){a._sending+=1;f._bitrateTimer=new a._BitrateTimer;return e=e||((g||!1===a._trigger("send",d.Event("send",
{delegatedEvent:c}),f))&&a._getXHRPromise(!1,f.context,g)||a._chunkedUpload(f)||d.ajax(f)).done(function(b,e,c){a._onDone(b,e,c,f)}).fail(function(b,e,c){a._onFail(b,e,c,f)}).always(function(b,e,c){a._onAlways(b,e,c,f);--a._sending;--a._active;if(f.limitConcurrentUploads&&f.limitConcurrentUploads>a._sending)for(b=a._slots.shift();b;){if("pending"===a._getDeferredState(b)){b.resolve();break}b=a._slots.shift()}0===a._active&&a._trigger("stop")})};this._beforeSend(c,f);if(this.options.sequentialUploads||
this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending){if(1<this.options.limitConcurrentUploads){var l=d.Deferred();this._slots.push(l);var m=l.pipe(k)}else m=this._sequence=this._sequence.pipe(k,k);m.abort=function(){g=[void 0,"abort","abort"];return e?e.abort():(l&&l.rejectWith(f.context,g),k())};return this._enhancePromise(m)}return k()},_onAdd:function(c,b){var a=this,e=!0,g=d.extend({},this.options,b),f=b.files,k=f.length,l=g.limitMultiFileUploads,m=g.limitMultiFileUploadSize,
p=g.limitMultiFileUploadSizeOverhead,n=0,q=this._getParamName(g),t=0;!m||k&&void 0!==f[0].size||(m=void 0);if((g.singleFileUploads||l||m)&&this._isXHRUpload(g))if(g.singleFileUploads||m||!l)if(!g.singleFileUploads&&m){var w=[];var C=[];for(g=0;g<k;g+=1)if(n+=f[g].size+p,g+1===k||n+f[g+1].size+p>m||l&&g+1-t>=l)w.push(f.slice(t,g+1)),n=q.slice(t,g+1),n.length||(n=q),C.push(n),t=g+1,n=0}else C=q;else for(w=[],C=[],g=0;g<k;g+=l)w.push(f.slice(g,g+l)),n=q.slice(g,g+l),n.length||(n=q),C.push(n);else w=
[f],C=[q];b.originalFiles=f;d.each(w||f,function(f,k){var g=d.extend({},b);g.files=w?k:[k];g.paramName=C[f];a._initResponseObject(g);a._initProgressObject(g);a._addConvenienceMethods(c,g);return e=a._trigger("add",d.Event("add",{delegatedEvent:c}),g)});return e},_replaceFileInput:function(c){var b=c.clone(!0);d("<form></form>").append(b)[0].reset();c.after(b).detach();d.cleanData(c.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(a,e){return e===c[0]?b[0]:e});c[0]===this.element[0]&&
(this.element=b)},_handleFileTreeEntry:function(c,b){var a=this,e=d.Deferred(),g=function(f){f&&!f.entry&&(f.entry=c);e.resolve([f])};b=b||"";if(c.isFile)c._file?(c._file.relativePath=b,e.resolve(c._file)):c.file(function(f){f.relativePath=b;e.resolve(f)},g);else if(c.isDirectory){var f=c.createReader();f.readEntries(function(f){a._handleFileTreeEntries(f,b+c.name+"/").done(function(f){e.resolve(f)}).fail(g)},g)}else e.resolve([]);return e.promise()},_handleFileTreeEntries:function(c,b){var a=this;
return d.when.apply(d,d.map(c,function(e){return a._handleFileTreeEntry(e,b)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(c){c=c||{};var b=c.items;return b&&b.length&&(b[0].webkitGetAsEntry||b[0].getAsEntry)?this._handleFileTreeEntries(d.map(b,function(a){var b;if(a.webkitGetAsEntry){if(b=a.webkitGetAsEntry())b._file=a.getAsFile();return b}return a.getAsEntry()})):d.Deferred().resolve(d.makeArray(c.files)).promise()},_getSingleFileInputFiles:function(c){c=
d(c);var b=c.prop("webkitEntries")||c.prop("entries");if(b&&b.length)return this._handleFileTreeEntries(b);b=d.makeArray(c.prop("files"));if(b.length)void 0===b[0].name&&b[0].fileName&&d.each(b,function(a,b){b.name=b.fileName;b.size=b.fileSize});else{c=c.prop("value");if(!c)return d.Deferred().resolve([]).promise();b=[{name:c.replace(/^.*\\/,"")}]}return d.Deferred().resolve(b).promise()},_getFileInputFiles:function(c){return c instanceof d&&1!==c.length?d.when.apply(d,d.map(c,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],
arguments)}):this._getSingleFileInputFiles(c)},_onChange:function(c){var b=this,a={fileInput:d(c.target),form:d(c.target.form)};this._getFileInputFiles(a.fileInput).always(function(e){a.files=e;b.options.replaceFileInput&&b._replaceFileInput(a.fileInput);!1!==b._trigger("change",d.Event("change",{delegatedEvent:c}),a)&&b._onAdd(c,a)})},_onPaste:function(c){var b=c.originalEvent&&c.originalEvent.clipboardData&&c.originalEvent.clipboardData.items,a={files:[]};b&&b.length&&(d.each(b,function(b,c){var f=
c.getAsFile&&c.getAsFile();f&&a.files.push(f)}),!1!==this._trigger("paste",d.Event("paste",{delegatedEvent:c}),a)&&this._onAdd(c,a))},_onDrop:function(c){c.dataTransfer=c.originalEvent&&c.originalEvent.dataTransfer;var b=this,a=c.dataTransfer,e={};a&&a.files&&a.files.length&&(c.preventDefault(),this._getDroppedFiles(a).always(function(a){e.files=a;!1!==b._trigger("drop",d.Event("drop",{delegatedEvent:c}),e)&&b._onAdd(c,e)}))},_onDragOver:function(c){c.dataTransfer=c.originalEvent&&c.originalEvent.dataTransfer;
var b=c.dataTransfer;b&&-1!==d.inArray("Files",b.types)&&!1!==this._trigger("dragover",d.Event("dragover",{delegatedEvent:c}))&&(c.preventDefault(),b.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste}));d.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,
"dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(c,b){var a=-1!==d.inArray(c,this._specialOptions);a&&this._destroyEventHandlers();this._super(c,b);a&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var c=this.options;void 0===c.fileInput?c.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):c.fileInput instanceof d||(c.fileInput=d(c.fileInput));
c.dropZone instanceof d||(c.dropZone=d(c.dropZone));c.pasteZone instanceof d||(c.pasteZone=d(c.pasteZone))},_getRegExp:function(c){c=c.split("/");var b=c.pop();c.shift();return new RegExp(c.join("/"),b)},_isRegExpOption:function(c,b){return"url"!==c&&"string"===d.type(b)&&/^\/.*\/[igm]{0,3}$/.test(b)},_initDataAttributes:function(){var c=this,b=this.options;d.each(d(this.element[0].cloneNode(!1)).data(),function(a,e){c._isRegExpOption(a,e)&&(e=c._getRegExp(e));b[a]=e})},_create:function(){this._initDataAttributes();
this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(c){var b=this;c&&!this.options.disabled&&(c.fileInput&&!c.files?this._getFileInputFiles(c.fileInput).always(function(a){c.files=a;b._onAdd(null,c)}):(c.files=d.makeArray(c.files),this._onAdd(null,c)))},send:function(c){if(c&&!this.options.disabled){if(c.fileInput&&
!c.files){var b=this,a=d.Deferred(),e=a.promise(),g,f;e.abort=function(){f=!0;if(g)return g.abort();a.reject(null,"abort","abort");return e};this._getFileInputFiles(c.fileInput).always(function(e){f||(e.length?(c.files=e,g=b._onSend(null,c).then(function(f,b,e){a.resolve(f,b,e)},function(f,b,e){a.reject(f,b,e)})):a.reject())});return this._enhancePromise(e)}c.files=d.makeArray(c.files);if(c.files.length)return this._onSend(null,c)}return this._getXHRPromise(!1,c&&c.context)}})});
(function(d){"function"===typeof define&&define.amd?define(["jquery","./jquery.fileupload"],d):d(window.jQuery)})(function(d){var c=d.blueimp.fileupload.prototype.options.add;d.widget("blueimp.fileupload",d.blueimp.fileupload,{options:{processQueue:[],add:function(b,a){var e=d(this);a.process(function(){return e.fileupload("process",a)});c.call(this,b,a)}},processActions:{},_processFile:function(b,a){var e=this,c=d.Deferred().resolveWith(e,[b]).promise();this._trigger("process",null,b);d.each(b.processQueue,
function(f,b){var k=function(f){return a.errorThrown?d.Deferred().rejectWith(e,[a]).promise():e.processActions[b.action].call(e,f,b)};c=c.pipe(k,b.always&&k)});c.done(function(){e._trigger("processdone",null,b);e._trigger("processalways",null,b)}).fail(function(){e._trigger("processfail",null,b);e._trigger("processalways",null,b)});return c},_transformProcessQueue:function(b){var a=[];d.each(b.processQueue,function(){var e={},c=this.action,f=!0===this.prefix?c:this.prefix;d.each(this,function(a,c){"string"===
d.type(c)&&"@"===c.charAt(0)?e[a]=b[c.slice(1)||(f?f+a.charAt(0).toUpperCase()+a.slice(1):a)]:e[a]=c});a.push(e)});b.processQueue=a},processing:function(){return this._processing},process:function(b){var a=this,e=d.extend({},this.options,b);e.processQueue&&e.processQueue.length&&(this._transformProcessQueue(e),0===this._processing&&this._trigger("processstart"),d.each(b.files,function(c){var f=c?d.extend({},e):e,k=function(){return b.errorThrown?d.Deferred().rejectWith(a,[b]).promise():a._processFile(f,
b)};f.index=c;a._processing+=1;a._processingQueue=a._processingQueue.pipe(k,k).always(function(){--a._processing;0===a._processing&&a._trigger("processstop")})}));return this._processingQueue},_create:function(){this._super();this._processing=0;this._processingQueue=d.Deferred().resolveWith(this).promise()}})});
(function(d){"function"===typeof define&&define.amd?define(["jquery","./jquery.fileupload-process"],d):d(window.jQuery)})(function(d){d.blueimp.fileupload.prototype.options.processQueue.push({action:"validate",always:!0,acceptFileTypes:"@",maxFileSize:"@",minFileSize:"@",maxNumberOfFiles:"@",disabled:"@disableValidation"});d.widget("blueimp.fileupload",d.blueimp.fileupload,{options:{getNumberOfFiles:d.noop,messages:{maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",
maxFileSize:"File is too large",minFileSize:"File is too small"}},processActions:{validate:function(c,b){if(b.disabled)return c;var a=d.Deferred(),e=this.options,g=c.files[c.index];if(b.minFileSize||b.maxFileSize)var f=g.size;"number"===d.type(b.maxNumberOfFiles)&&(e.getNumberOfFiles()||0)+c.files.length>b.maxNumberOfFiles?g.error=e.i18n("maxNumberOfFiles"):!b.acceptFileTypes||b.acceptFileTypes.test(g.type)||b.acceptFileTypes.test(g.name)?f>b.maxFileSize?g.error=e.i18n("maxFileSize"):"number"===d.type(f)&&
f<b.minFileSize?g.error=e.i18n("minFileSize"):delete g.error:g.error=e.i18n("acceptFileTypes");g.error||c.files.error?(c.files.error=!0,a.rejectWith(this,[c])):a.resolveWith(this,[c]);return a.promise()}}})});
(function(d){"function"===typeof define&&define.amd?define("jquery tmpl ./jquery.fileupload-image ./jquery.fileupload-audio ./jquery.fileupload-video ./jquery.fileupload-validate".split(" "),d):d(window.jQuery,window.tmpl)})(function(d,c){d.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId");d.widget("blueimp.fileupload",d.blueimp.fileupload,{options:{autoUpload:!1,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,
prependFiles:!1,dataType:"json",getNumberOfFiles:function(){return this.filesContainer.children().not(".processing").length},getFilesFromResponse:function(b){return b.result&&d.isArray(b.result.files)?b.result.files:[]},add:function(b,a){if(b.isDefaultPrevented())return!1;var e=d(this),c=e.data("blueimp-fileupload")||e.data("fileupload"),f=c.options;a.context=c._renderUpload(a.files).data("data",a).addClass("processing");f.filesContainer[f.prependFiles?"prepend":"append"](a.context);c._forceReflow(a.context);
d.when(c._transition(a.context),a.process(function(){return e.fileupload("process",a)})).always(function(){a.context.each(function(f){d(this).find(".size").text(c._formatFileSize(a.files[f].size))}).removeClass("processing");c._renderPreviews(a)}).done(function(){a.context.find(".start").prop("disabled",!1);!1!==c._trigger("added",b,a)&&(f.autoUpload||a.autoUpload)&&!1!==a.autoUpload&&a.submit()}).fail(function(){a.files.error&&a.context.each(function(f){(f=a.files[f].error)&&d(this).find(".error").text(f)})})},
send:function(b,a){if(b.isDefaultPrevented())return!1;var e=d(this).data("blueimp-fileupload")||d(this).data("fileupload");a.context&&a.dataType&&"iframe"===a.dataType.substr(0,6)&&a.context.find(".progress").addClass(!d.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%");return e._trigger("sent",b,a)},done:function(b,a){if(b.isDefaultPrevented())return!1;var e=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),c=(a.getFilesFromResponse||
e.options.getFilesFromResponse)(a);if(a.context)a.context.each(function(g){var l=c[g]||{error:"Empty file upload result"};k=e._addFinishedDeferreds();e._transition(d(this)).done(function(){var c=d(this);f=e._renderDownload([l]).replaceAll(c);e._forceReflow(f);e._transition(f).done(function(){a.context=d(this);e._trigger("completed",b,a);e._trigger("finished",b,a);k.resolve()})})});else{var f=e._renderDownload(c)[e.options.prependFiles?"prependTo":"appendTo"](e.options.filesContainer);e._forceReflow(f);
var k=e._addFinishedDeferreds();e._transition(f).done(function(){a.context=d(this);e._trigger("completed",b,a);e._trigger("finished",b,a);k.resolve()})}},fail:function(b,a){if(b.isDefaultPrevented())return!1;var e=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),c;if(a.context)a.context.each(function(k){if("abort"!==a.errorThrown){var g=a.files[k];g.error=g.error||a.errorThrown||!0;f=e._addFinishedDeferreds();e._transition(d(this)).done(function(){var k=d(this);c=e._renderDownload([g]).replaceAll(k);
e._forceReflow(c);e._transition(c).done(function(){a.context=d(this);e._trigger("failed",b,a);e._trigger("finished",b,a);f.resolve()})})}else f=e._addFinishedDeferreds(),e._transition(d(this)).done(function(){d(this).remove();e._trigger("failed",b,a);e._trigger("finished",b,a);f.resolve()})});else if("abort"!==a.errorThrown){a.context=e._renderUpload(a.files)[e.options.prependFiles?"prependTo":"appendTo"](e.options.filesContainer).data("data",a);e._forceReflow(a.context);var f=e._addFinishedDeferreds();
e._transition(a.context).done(function(){a.context=d(this);e._trigger("failed",b,a);e._trigger("finished",b,a);f.resolve()})}else e._trigger("failed",b,a),e._trigger("finished",b,a),e._addFinishedDeferreds().resolve()},progress:function(b,a){if(b.isDefaultPrevented())return!1;var e=Math.floor(a.loaded/a.total*100);a.context&&a.context.each(function(){d(this).find(".progress").attr("aria-valuenow",e).children().first().css("width",e+"%")})},progressall:function(b,a){if(b.isDefaultPrevented())return!1;
var e=d(this),c=Math.floor(a.loaded/a.total*100),f=e.find(".fileupload-progress"),k=f.find(".progress-extended");k.length&&k.html((e.data("blueimp-fileupload")||e.data("fileupload"))._renderExtendedProgress(a));f.find(".progress").attr("aria-valuenow",c).children().first().css("width",c+"%")},start:function(b){if(b.isDefaultPrevented())return!1;var a=d(this).data("blueimp-fileupload")||d(this).data("fileupload");a._resetFinishedDeferreds();a._transition(d(this).find(".fileupload-progress")).done(function(){a._trigger("started",
b)})},stop:function(b){if(b.isDefaultPrevented())return!1;var a=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),e=a._addFinishedDeferreds();d.when.apply(d,a._getFinishedDeferreds()).done(function(){a._trigger("stopped",b)});a._transition(d(this).find(".fileupload-progress")).done(function(){d(this).find(".progress").attr("aria-valuenow","0").children().first().css("width","0%");d(this).find(".progress-extended").html("&nbsp;");e.resolve()})},processstart:function(b){if(b.isDefaultPrevented())return!1;
d(this).addClass("fileupload-processing")},processstop:function(b){if(b.isDefaultPrevented())return!1;d(this).removeClass("fileupload-processing")},destroy:function(b,a){if(b.isDefaultPrevented())return!1;var e=d(this).data("blueimp-fileupload")||d(this).data("fileupload"),c=function(){e._transition(a.context).done(function(){d(this).remove();e._trigger("destroyed",b,a)})};a.url?(a.dataType=a.dataType||e.options.dataType,d.ajax(a).done(c)):c()}},_resetFinishedDeferreds:function(){this._finishedUploads=
[]},_addFinishedDeferreds:function(b){b||(b=d.Deferred());this._finishedUploads.push(b);return b},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var b=d(this),a=b.prop("href"),e=b.prop("download");b.bind("dragstart",function(b){try{b.originalEvent.dataTransfer.setData("DownloadURL",["application/octet-stream",e,a].join(":"))}catch(f){}})},_formatFileSize:function(b){return"number"!==typeof b?"":1E9<=b?(b/1E9).toFixed(2)+" GB":1E6<=b?(b/1E6).toFixed(2)+
" MB":(b/1E3).toFixed(2)+" KB"},_formatBitrate:function(b){return"number"!==typeof b?"":1E9<=b?(b/1E9).toFixed(2)+" Gbit/s":1E6<=b?(b/1E6).toFixed(2)+" Mbit/s":1E3<=b?(b/1E3).toFixed(2)+" kbit/s":b.toFixed(2)+" bit/s"},_formatTime:function(b){var a=new Date(1E3*b);b=Math.floor(b/86400);return(b?b+"d ":"")+("0"+a.getUTCHours()).slice(-2)+":"+("0"+a.getUTCMinutes()).slice(-2)+":"+("0"+a.getUTCSeconds()).slice(-2)},_formatPercentage:function(b){return(100*b).toFixed(2)+" %"},_renderExtendedProgress:function(b){return this._formatBitrate(b.bitrate)+
" | "+this._formatTime(8*(b.total-b.loaded)/b.bitrate)+" | "+this._formatPercentage(b.loaded/b.total)+" | "+this._formatFileSize(b.loaded)+" / "+this._formatFileSize(b.total)},_renderTemplate:function(b,a){if(!b)return d();var e=b({files:a,formatFileSize:this._formatFileSize,options:this.options});return e instanceof d?e:d(this.options.templatesContainer).html(e).children()},_renderPreviews:function(b){b.context.find(".preview").each(function(a,e){d(e).append(b.files[a].preview)})},_renderUpload:function(b){return this._renderTemplate(this.options.uploadTemplate,
b)},_renderDownload:function(b){return this._renderTemplate(this.options.downloadTemplate,b).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(b){b.preventDefault();b=d(b.currentTarget);var a=b.closest(".template-upload").data("data");b.prop("disabled",!0);a&&a.submit&&a.submit()},_cancelHandler:function(b){b.preventDefault();var a=d(b.currentTarget).closest(".template-upload,.template-download"),e=a.data("data")||{};e.context=e.context||a;e.abort?e.abort():(e.errorThrown=
"abort",this._trigger("fail",b,e))},_deleteHandler:function(b){b.preventDefault();var a=d(b.currentTarget);this._trigger("destroy",b,d.extend({context:a.closest(".template-download"),type:"DELETE"},a.data()))},_forceReflow:function(b){return d.support.transition&&b.length&&b[0].offsetWidth},_transition:function(b){var a=d.Deferred();d.support.transition&&b.hasClass("fade")&&b.is(":visible")?b.bind(d.support.transition.end,function(e){e.target===b[0]&&(b.unbind(d.support.transition.end),a.resolveWith(b))}).toggleClass("in"):
(b.toggleClass("in"),a.resolveWith(b));return a},_initButtonBarEventHandlers:function(){var b=this.element.find(".fileupload-buttonbar"),a=this.options.filesContainer;this._on(b.find(".start"),{click:function(b){b.preventDefault();a.find(".start").click()}});this._on(b.find(".cancel"),{click:function(b){b.preventDefault();a.find(".cancel").click()}});this._on(b.find(".delete"),{click:function(e){e.preventDefault();a.find(".toggle:checked").closest(".template-download").find(".delete").click();b.find(".toggle").prop("checked",
!1)}});this._on(b.find(".toggle"),{change:function(b){a.find(".toggle").prop("checked",d(b.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click");this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super();this._on(this.options.filesContainer,{"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler});
this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers();this._off(this.options.filesContainer,"click");this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var b=this.options;b.templatesContainer=this.document[0].createElement(b.filesContainer.prop("nodeName"));
c&&(b.uploadTemplateId&&(b.uploadTemplate=c(b.uploadTemplateId)),b.downloadTemplateId&&(b.downloadTemplate=c(b.downloadTemplateId)))},_initFilesContainer:function(){var b=this.options;void 0===b.filesContainer?b.filesContainer=this.element.find(".files"):b.filesContainer instanceof d||(b.filesContainer=d(b.filesContainer))},_initSpecialOptions:function(){this._super();this._initFilesContainer();this._initTemplates()},_create:function(){this._super();this._resetFinishedDeferreds();d.support.fileInput||
this._disableFileInputButton()},enable:function(){var b=!1;this.options.disabled&&(b=!0);this._super();b&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton());this._super()}})});
jQuery&&function(d){d.extend(d.fn,{miniColors:function(c,b){var a=function(a,b,c){c=B(a.val())||"ffffff";var k=u(c),l=v(k),m=parseFloat(a.attr("data-opacity")).toFixed(2);1<m&&(m=1);0>m&&(m=0);var p=d('<a class="miniColors-trigger" style="background-color: #'+c+'" href="#"></a>');p.insertAfter(a);p.wrap('<span class="miniColors-triggerWrap"></span>');b.opacity&&p.css("backgroundColor","rgba("+l.r+", "+l.g+", "+l.b+", "+m+")");a.addClass("miniColors").data("original-maxlength",a.attr("maxlength")||
null).data("original-autocomplete",a.attr("autocomplete")||null).data("letterCase","uppercase"===b.letterCase?"uppercase":"lowercase").data("opacity",b.opacity?!0:!1).data("alpha",m).data("trigger",p).data("hsb",k).data("change",b.change?b.change:null).data("close",b.close?b.close:null).data("open",b.open?b.open:null).attr("maxlength",7).attr("autocomplete","off").val("#"+q(c,b.letterCase));(b.readonly||a.prop("readonly"))&&a.prop("readonly",!0);(b.disabled||a.prop("disabled"))&&e(a);p.on("click.miniColors",
function(f){f.preventDefault();""===a.val()&&a.val("#");g(a)});a.on("focus.miniColors",function(f){""===a.val()&&a.val("#");g(a)});a.on("blur.miniColors",function(f){f=B(r(v(a.data("hsb"))));a.val(f?"#"+q(f,a.data("letterCase")):"")});a.on("keydown.miniColors",function(b){9===b.keyCode&&f(a)});a.on("keyup.miniColors",function(f){n(a)});a.on("paste.miniColors",function(f){setTimeout(function(){n(a)},5)})},e=function(a){f(a);a.prop("disabled",!0).data("trigger").parent().addClass("disabled")},g=function(a){if(a.prop("disabled"))return!1;
f();var b=d('<div class="miniColors-selector"></div>');b.append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>').append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"><div class="miniColors-colorPicker-inner"></div></div>').css("display","none").addClass(a.attr("class"));a.data("opacity")&&b.addClass("opacity").prepend('<div class="miniColors-opacity"><div class="miniColors-opacityPicker"></div></div>');var e=a.data("hsb");
b.find(".miniColors-colors").css("backgroundColor","#"+r(v({h:e.h,s:100,b:100}))).end().find(".miniColors-opacity").css("backgroundColor","#"+r(v({h:e.h,s:e.s,b:e.b}))).end();var c=a.data("colorPosition");c||(c=t(e));b.find(".miniColors-colorPicker").css("top",c.y+"px").css("left",c.x+"px");(c=a.data("huePosition"))||(c=w(e));b.find(".miniColors-huePicker").css("top",c+"px");(c=a.data("opacityPosition"))||(c=C(a.attr("data-opacity")));b.find(".miniColors-opacityPicker").css("top",c+"px");a.data("selector",
b).data("huePicker",b.find(".miniColors-huePicker")).data("opacityPicker",b.find(".miniColors-opacityPicker")).data("colorPicker",b.find(".miniColors-colorPicker")).data("mousebutton",0);d("BODY").append(b);var g=a.data("trigger"),p=!a.is(":visible"),c=p?g.offset().top+g.outerHeight():a.offset().top+a.outerHeight(),p=p?g.offset().left:a.offset().left,n=b.outerWidth(),q=b.outerHeight(),x=g.outerWidth(),g=g.outerHeight(),B=d(window).height(),u=d(window).width(),y=d(window).scrollTop(),z=d(window).scrollLeft();
c+q>B+y&&(c=c-q-g);p+n>u+z&&(p=p-n+x);b.css({top:c,left:p}).fadeIn(100);b.on("selectstart",function(){return!1});if(!d.browser.msie||d.browser.msie&&9<=d.browser.version)d(window).on("resize.miniColors",function(b){f(a)});d(document).on("mousedown.miniColors touchstart.miniColors",function(b){a.data("mousebutton",1);var e=d(b.target).parents().andSelf();e.hasClass("miniColors-colors")&&(b.preventDefault(),a.data("moving","colors"),k(a,b));e.hasClass("miniColors-hues")&&(b.preventDefault(),a.data("moving",
"hues"),l(a,b));e.hasClass("miniColors-opacity")&&(b.preventDefault(),a.data("moving","opacity"),m(a,b));e.hasClass("miniColors-selector")?b.preventDefault():e.hasClass("miniColors")||f(a)}).on("mouseup.miniColors touchend.miniColors",function(f){f.preventDefault();a.data("mousebutton",0).removeData("moving")}).on("mousemove.miniColors touchmove.miniColors",function(f){f.preventDefault();1===a.data("mousebutton")&&("colors"===a.data("moving")&&k(a,f),"hues"===a.data("moving")&&l(a,f),"opacity"===
a.data("moving")&&m(a,f))});a.data("open")&&a.data("open").call(a.get(0),"#"+r(v(e)),d.extend(v(e),{a:parseFloat(a.attr("data-opacity"))}))},f=function(a){a||(a=d(".miniColors"));a.each(function(){var f=d(this).data("selector");d(this).removeData("selector");d(f).fadeOut(100,function(){if(a.data("close")){var f=a.data("hsb"),b=r(v(f));a.data("close").call(a.get(0),"#"+b,d.extend(v(f),{a:parseFloat(a.attr("data-opacity"))}))}d(this).remove()})});d(document).off(".miniColors")},k=function(a,f){var b=
a.data("colorPicker");b.hide();var e={x:f.pageX,y:f.pageY};f.originalEvent.changedTouches&&(e.x=f.originalEvent.changedTouches[0].pageX,e.y=f.originalEvent.changedTouches[0].pageY);e.x=e.x-a.data("selector").find(".miniColors-colors").offset().left-6;e.y=e.y-a.data("selector").find(".miniColors-colors").offset().top-6;-5>=e.x&&(e.x=-5);144<=e.x&&(e.x=144);-5>=e.y&&(e.y=-5);144<=e.y&&(e.y=144);a.data("colorPosition",e);b.css("left",e.x).css("top",e.y).show();b=Math.round(.67*(e.x+5));0>b&&(b=0);100<
b&&(b=100);e=100-Math.round(.67*(e.y+5));0>e&&(e=0);100<e&&(e=100);var c=a.data("hsb");c.s=b;c.b=e;p(a,c,!0)},l=function(a,f){var b=a.data("huePicker");b.hide();var e=f.pageY;f.originalEvent.changedTouches&&(e=f.originalEvent.changedTouches[0].pageY);e=e-a.data("selector").find(".miniColors-colors").offset().top-1;-1>=e&&(e=-1);149<=e&&(e=149);a.data("huePosition",e);b.css("top",e).show();b=Math.round(2.4*(150-e-1));0>b&&(b=0);360<b&&(b=360);e=a.data("hsb");e.h=b;p(a,e,!0)},m=function(a,f){var b=
a.data("opacityPicker");b.hide();var e=f.pageY;f.originalEvent.changedTouches&&(e=f.originalEvent.changedTouches[0].pageY);e=e-a.data("selector").find(".miniColors-colors").offset().top-1;-1>=e&&(e=-1);149<=e&&(e=149);a.data("opacityPosition",e);b.css("top",e).show();b=parseFloat((150-e-1)/150).toFixed(2);0>b&&(b=0);1<b&&(b=1);a.data("alpha",b).attr("data-opacity",b);p(a,a.data("hsb"),!0)},p=function(a,f,b){a.data("hsb",f);var e=r(v(f)),c=d(a.data("selector"));b&&a.val("#"+q(e,a.data("letterCase")));
c.find(".miniColors-colors").css("backgroundColor","#"+r(v({h:f.h,s:100,b:100}))).end().find(".miniColors-opacity").css("backgroundColor","#"+e).end();b=v(f);a.data("trigger").css("backgroundColor","#"+e);a.data("opacity")&&a.data("trigger").css("backgroundColor","rgba("+b.r+", "+b.g+", "+b.b+", "+a.attr("data-opacity")+")");a.data("change")&&e+","+a.attr("data-opacity")!==a.data("lastChange")&&(a.data("change").call(a.get(0),"#"+e,d.extend(v(f),{a:parseFloat(a.attr("data-opacity"))})),a.data("lastChange",
e+","+a.attr("data-opacity")))},n=function(a){a.val("#"+a.val().replace(/[^A-F0-9]/ig,""));var f=B(a.val());if(!f)return!1;var f=u(f),b=t(f);d(a.data("colorPicker")).css("top",b.y+"px").css("left",b.x+"px");a.data("colorPosition",b);b=w(f);d(a.data("huePicker")).css("top",b+"px");a.data("huePosition",b);b=C(a.attr("data-opacity"));d(a.data("opacityPicker")).css("top",b+"px");a.data("opacityPosition",b);p(a,f);return!0},q=function(a,f){return"uppercase"===f?a.toUpperCase():a.toLowerCase()},t=function(a){var f=
Math.ceil(a.s/.67);0>f&&(f=0);150<f&&(f=150);a=150-Math.ceil(a.b/.67);0>a&&(a=0);150<a&&(a=150);return{x:f-5,y:a-5}},w=function(a){a=150-a.h/2.4;0>a&&(h=0);150<a&&(h=150);return a},C=function(a){a*=150;0>a&&(a=0);150<a&&(a=150);return 150-a},B=function(a){a=a.replace(/[^A-F0-9]/ig,"");if(!a)return null;3===a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);return 6===a.length?a:null},v=function(a){var f,b;var e=Math.round(a.h);var c=Math.round(255*a.s/100);a=Math.round(255*a.b/100);if(0===c)e=f=b=a;else{var c=
(255-c)*a/255,k=e%60*(a-c)/60;360===e&&(e=0);60>e?(e=a,b=c,f=c+k):120>e?(f=a,b=c,e=a-k):180>e?(f=a,e=c,b=c+k):240>e?(b=a,e=c,f=a-k):300>e?(b=a,f=c,e=c+k):360>e?(e=a,f=c,b=a-k):b=f=e=0}return{r:Math.round(e),g:Math.round(f),b:Math.round(b)}},r=function(a){var f=[a.r.toString(16),a.g.toString(16),a.b.toString(16)];d.each(f,function(a,b){1===b.length&&(f[a]="0"+b)});return f.join("")},u=function(a){var f=a,f=parseInt(-1<f.indexOf("#")?f.substring(1):f,16);a=f>>16;var b=(f&65280)>>8,f=f&255,e={h:0,s:0,
b:0},c=Math.max(a,b,f),k=c-Math.min(a,b,f);e.b=c;e.s=0!==c?255*k/c:0;e.h=0!==e.s?a===c?(b-f)/k:b===c?2+(f-a)/k:4+(a-b)/k:-1;e.h*=60;0>e.h&&(e.h+=360);e.s*=100/255;e.b*=100/255;0===e.s&&(e.h=360);return e};switch(c){case "readonly":return d(this).each(function(){d(this).hasClass("miniColors")&&d(this).prop("readonly",b)}),d(this);case "disabled":return d(this).each(function(){d(this).hasClass("miniColors")&&(b?e(d(this)):d(this).prop("disabled",!1).data("trigger").parent().removeClass("disabled"))}),
d(this);case "value":if(void 0===b){if(!d(this).hasClass("miniColors"))break;var y=d(this),z=B(y.val());return z?"#"+q(z,y.data("letterCase")):null}d(this).each(function(){d(this).hasClass("miniColors")&&(d(this).val(b),n(d(this)))});return d(this);case "opacity":if(void 0===b){if(!d(this).hasClass("miniColors"))break;return d(this).data("opacity")?parseFloat(d(this).attr("data-opacity")):null}d(this).each(function(){d(this).hasClass("miniColors")&&(0>b&&(b=0),1<b&&(b=1),d(this).attr("data-opacity",
b).data("alpha",b),n(d(this)))});return d(this);case "destroy":return d(this).each(function(){if(d(this).hasClass("miniColors")){var a=d(this);f();a=d(a);a.data("trigger").parent().remove();a.attr("autocomplete",a.data("original-autocomplete")).attr("maxlength",a.data("original-maxlength")).removeData().removeClass("miniColors").off(".miniColors");d(document).off(".miniColors")}}),d(this);default:return c||(c={}),d(this).each(function(){"input"===d(this)[0].tagName.toLowerCase()&&(d(this).data("trigger")||
a(d(this),c,b))}),d(this)}}})}(jQuery);
var Canvas2Image=function(){var d=!1,c=document.createElement("canvas");c.getContext("2d")&&(d=!0);if(!d)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var b=!!c.getContext("2d").getImageData,a=!!c.toDataURL,e=!!window.btoa,g=function(a){var f="";if("string"==typeof a)f=a;else for(var b=0;b<a.length;b++)f+=String.fromCharCode(a[b]);return btoa(f)},f=function(a){console.log(a);document.location.href=a},k=function(a){var f=document.createElement("img");f.src=a;return f},
l=function(a,f,b){if(f&&b){var e=document.createElement("canvas");e.width=f;e.height=b;e.style.width=f+"px";e.style.height=b+"px";e.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,f,b);return e}return a};return{saveAsPNG:function(b,e,c,g){if(!a)return!1;b=l(b,c,g).toDataURL("image/png");if(e)return k(b);f(b.replace("image/png","image/octet-stream"));return!0},saveAsJPEG:function(b,e,c,g){if(!a)return!1;b=l(b,c,g).toDataURL("image/jpeg");if(5!=b.indexOf("image/jpeg"))return!1;if(e)return k(b);
f(b.replace("image/jpeg","image/octet-stream"));return!0},saveAsBMP:function(a,c,d,q){if(!b||!e)return!1;a=l(a,d,q);d=parseInt(a.width);q=parseInt(a.height);var m=a.getContext("2d").getImageData(0,0,d,q);a=[];d=m.width;var p=m.height;a.push(66);a.push(77);q=d*p*3+54;a.push(q%256);q=Math.floor(q/256);a.push(q%256);q=Math.floor(q/256);a.push(q%256);q=Math.floor(q/256);a.push(q%256);a.push(0);a.push(0);a.push(0);a.push(0);a.push(54);a.push(0);a.push(0);a.push(0);q=[];q.push(40);q.push(0);q.push(0);q.push(0);
var n=d;q.push(n%256);n=Math.floor(n/256);q.push(n%256);n=Math.floor(n/256);q.push(n%256);n=Math.floor(n/256);q.push(n%256);n=p;q.push(n%256);n=Math.floor(n/256);q.push(n%256);n=Math.floor(n/256);q.push(n%256);n=Math.floor(n/256);q.push(n%256);q.push(1);q.push(0);q.push(24);q.push(0);q.push(0);q.push(0);q.push(0);q.push(0);n=d*p*3;q.push(n%256);n=Math.floor(n/256);q.push(n%256);n=Math.floor(n/256);q.push(n%256);n=Math.floor(n/256);q.push(n%256);for(n=0;16>n;n++)q.push(0);var n=(4-3*d%4)%4,m=m.data,
B="";do{for(var v=d*(p-1)*4,r="",u=0;u<d;u++)var y=4*u,r=r+String.fromCharCode(m[v+y+2]),r=r+String.fromCharCode(m[v+y+1]),r=r+String.fromCharCode(m[v+y]);for(v=0;v<n;v++)r+=String.fromCharCode(0);B+=r}while(--p);a=g(a.concat(q))+g(B);if(c)return k("data:image/bmp;base64,"+a);f("data:image/octet-stream;base64,"+a);return!0}}}(),fabric=fabric||{version:"1.6.0-rc.1"};"undefined"!=typeof exports&&(exports.fabric=fabric);
"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow);fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window;
fabric.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width id".split(" ");fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1;
(function(){function d(a,b){this.__eventListeners[a]&&(b?fabric.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)}function c(a,b){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var f in a)this.on(f,a[f]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function b(a,b){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"==
typeof arguments[0])for(var f in a)d.call(this,f,a[f]);else d.call(this,a,b);return this}}function a(a,b){if(this.__eventListeners){var f=this.__eventListeners[a];if(f){for(var e=0,c=f.length;c>e;e++)f[e].call(this,b||{});return this}}}fabric.Observable={observe:c,stopObserving:b,fire:a,on:c,off:b,trigger:a}})();
fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var d=0,c=arguments.length;c>d;d++)this._onObjectAdded(arguments[d]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(d,c,b){var a=this.getObjects();return b?a[c]=d:a.splice(c,0,d),this._onObjectAdded(d),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var d,c=this.getObjects(),b=0,a=arguments.length;a>b;b++)d=c.indexOf(arguments[b]),-1!==d&&(c.splice(d,1),this._onObjectRemoved(arguments[b]));
return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(d,c){for(var b=this.getObjects(),a=b.length;a--;)d.call(c,b[a],a,b);return this},getObjects:function(d){return"undefined"==typeof d?this._objects:this._objects.filter(function(c){return c.type===d})},item:function(d){return this.getObjects()[d]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(d){return-1<this.getObjects().indexOf(d)},complexity:function(){return this.getObjects().reduce(function(d,
c){return d+(c.complexity?c.complexity():0)},0)}};
(function(d){var c=Math.sqrt,b=Math.atan2,a=(Math.atan,Math.pow),e=Math.abs,g=Math.PI/180;fabric.util={removeFromArray:function(a,b){var f=a.indexOf(b);return-1!==f&&a.splice(f,1),a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*g},radiansToDegrees:function(a){return a/g},rotatePoint:function(a,b,e){a.subtractEquals(b);a=fabric.util.rotateVector(a,e);return(new fabric.Point(a.x,a.y)).addEquals(b)},rotateVector:function(a,b){var f=Math.sin(b),
e=Math.cos(b);return{x:a.x*e-a.y*f,y:a.x*f+a.y*e}},transformPoint:function(a,b,e){return e?new fabric.Point(b[0]*a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y):new fabric.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},makeBoundingBoxFromPoints:function(a){var b=[a[0].x,a[1].x,a[2].x,a[3].x],f=fabric.util.array.min(b),b=fabric.util.array.max(b),b=Math.abs(f-b),e=[a[0].y,a[1].y,a[2].y,a[3].y];a=fabric.util.array.min(e);e=fabric.util.array.max(e);return{left:f,top:a,width:b,height:Math.abs(a-e)}},invertTransform:function(a){var b=
1/(a[0]*a[3]-a[1]*a[2]),b=[b*a[3],-b*a[1],-b*a[2],b*a[0]];a=fabric.util.transformPoint({x:a[4],y:a[5]},b,!0);return b[4]=-a.x,b[5]=-a.y,b},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var f=/\D{0,2}$/.exec(a),e=parseFloat(a);switch(b||(b=fabric.Text.DEFAULT_SVG_FONT_SIZE),f[0]){case "mm":return e*fabric.DPI/25.4;case "cm":return e*fabric.DPI/2.54;case "in":return e*fabric.DPI;case "pt":return e*fabric.DPI/72;case "pc":return e*fabric.DPI/72*12;case "em":return e*
b;default:return e}},falseFunction:function(){return!1},getKlass:function(a,b){return a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),fabric.util.resolveNamespace(b)[a]},resolveNamespace:function(a){if(!a)return fabric;a=a.split(".");for(var b=a.length,f=d||fabric.window,e=0;b>e;++e)f=f[a[e]];return f},loadImage:function(a,b,e,c){if(!a)return void(b&&b.call(e,a));var f=fabric.util.createImage();f.onload=function(){b&&b.call(e,f);f=f.onload=f.onerror=null};f.onerror=function(){fabric.log("Error loading "+
f.src);b&&b.call(e,null,!0);f=f.onload=f.onerror=null};0!==a.indexOf("data")&&c&&(f.crossOrigin=c);f.src=a},enlivenObjects:function(a,b,e,c){function f(){++g===d&&b&&b(k)}a=a||[];var k=[],g=0,d=a.length;return d?void a.forEach(function(a,b){if(!a||!a.type)return void f();var g=fabric.util.getKlass(a.type,e);g.async?g.fromObject(a,function(e,g){g||(k[b]=e,c&&c(a,k[b]));f()}):(k[b]=g.fromObject(a),c&&c(a,k[b]),f())}):void(b&&b(k))},groupSVGElements:function(a,b,e){var f;return f=new fabric.PathGroup(a,
b),"undefined"!=typeof e&&f.setSourcePath(e),f},populateWithProperties:function(a,b,e){if(e&&"[object Array]"===Object.prototype.toString.call(e))for(var f=0,c=e.length;c>f;f++)e[f]in a&&(b[e[f]]=a[e[f]])},drawDashedLine:function(a,e,g,d,p,n){d-=e;var f=p-g;p=c(d*d+f*f);d=b(f,d);var f=n.length,k=0,l=!0;a.save();a.translate(e,g);a.moveTo(0,0);a.rotate(d);for(e=0;p>e;)e+=n[k++%f],e>p&&(e=p),a[l?"lineTo":"moveTo"](e,0),l=!l;a.restore()},createCanvasElement:function(a){return a||(a=fabric.document.createElement("canvas")),
a.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a),a},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(a){a=a.prototype;for(var b=a.stateProperties.length;b--;){var f=a.stateProperties[b],e=f.charAt(0).toUpperCase()+f.slice(1),c="set"+e,e="get"+e;a[e]||(a[e]=new Function('return this.get("'+f+'")'));a[c]||(a[c]=new Function("value",'return this.set("'+f+'", value)'))}},
clipContext:function(a,b){b.save();b.beginPath();a.clipTo(b);b.clip()},multiplyTransformMatrices:function(a,b,e){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],e?0:a[0]*b[4]+a[2]*b[5]+a[4],e?0:a[1]*b[4]+a[3]*b[5]+a[5]]},qrDecompose:function(f){var e=b(f[1],f[0]),d=a(f[0],2)+a(f[1],2),m=c(d),p=(f[0]*f[3]-f[2]*f[1])/m,d=b(f[0]*f[2]+f[1]*f[3],d);return{angle:e/g,scaleX:m,scaleY:p,skewX:d/g,skewY:0,translateX:f[4],translateY:f[5]}},customTransformMatrix:function(a,
b,c){c=[1,0,e(Math.tan(c*g)),1];a=[e(a),0,0,e(b)];return fabric.util.multiplyTransformMatrices(a,c,!0)},resetObjectTransform:function(a){a.scaleX=1;a.scaleY=1;a.skewX=0;a.skewY=0;a.flipX=!1;a.flipY=!1;a.setAngle(0)},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,e,c){0<c&&(b>c?b-=c:b=0,e>c?e-=c:e=0);var f=!0;a=a.getImageData(b,e,2*c||1,2*c||1);b=3;for(e=a.data.length;e>b&&(f=0>=a.data[b],!1!==f);b+=4);return f},parsePreserveAspectRatioAttribute:function(a){var b,
f="meet",e="Mid",c="Mid";a=a.split(" ");return a&&a.length&&(f=a.pop(),"meet"!==f&&"slice"!==f?(b=f,f="meet"):a.length&&(b=a.pop())),e="none"!==b?b.slice(1,4):"none",c="none"!==b?b.slice(5,8):"none",{meetOrSlice:f,alignX:e,alignY:c}}}})("undefined"!=typeof exports?exports:this);
(function(){function d(a,f,g,d,q,t,w){var l=k.call(arguments);if(e[l])return e[l];var m=Math.PI,p=w*m/180,n=Math.sin(p),p=Math.cos(p),u=0,y=0;g=Math.abs(g);d=Math.abs(d);var z=-p*a*.5-n*f*.5,x=-p*f*.5+n*a*.5,A=g*g,F=d*d,D=x*x,E=z*z,G=A*F-A*D-F*E,I=0;0>G?(A=Math.sqrt(1-G/(A*F)),g*=A,d*=A):I=(q===t?-1:1)*Math.sqrt(G/(A*D+F*E));D=I*g*x/d;E=-I*d*z/g;I=p*D-n*E+.5*a;A=n*D+p*E+.5*f;F=b(1,0,(z-D)/g,(x-E)/d);x=b((z-D)/g,(x-E)/d,(-z-D)/g,(-x-E)/d);0===t&&0<x?x-=2*m:1===t&&0>x&&(x+=2*m);m=Math.ceil(Math.abs(x/
m*2));z=[];x/=m;D=8/3*Math.sin(x/4)*Math.sin(x/4)/Math.sin(x/2);E=F+x;for(G=0;m>G;G++)z[G]=c(F,E,p,n,g,d,I,A,D,u,y),u=z[G][4],y=z[G][5],F=E,E+=x;return e[l]=z,z}function c(a,b,f,e,c,d,w,C,B,v,r){var l=k.call(arguments);if(g[l])return g[l];var m=Math.cos(a),p=Math.sin(a),n=Math.cos(b),q=Math.sin(b),t=f*c*n-e*d*q+w,D=e*c*n+f*d*q+C;return g[l]=[v+B*(-f*c*p-e*d*m),r+B*(-e*c*p+f*d*m),t+B*(f*c*q+e*d*n),D+B*(e*c*q-f*d*n),t,D],g[l]}function b(a,b,f,e){a=Math.atan2(b,a);f=Math.atan2(e,f);return f>=a?f-a:2*
Math.PI-(a-f)}function a(a,b,e,c,g,d,w,C){var l=k.call(arguments);if(f[l])return f[l];var m,p,n,q=Math.sqrt,t=Math.min,x=Math.max,A=Math.abs,F=[],D=[[],[]];var E=6*a-12*e+6*g;var G=-3*a+9*e-9*g+3*w;var I=3*e-3*a;for(var J=0;2>J;++J)if(0<J&&(E=6*b-12*c+6*d,G=-3*b+9*c-9*d+3*C,I=3*c-3*b),1E-12>A(G)){if(!(1E-12>A(E))){var H=-I/E;0<H&&1>H&&F.push(H)}}else H=E*E-4*I*G,0>H||(n=q(H),m=(-E+n)/(2*G),0<m&&1>m&&F.push(m),p=(-E-n)/(2*G),0<p&&1>p&&F.push(p));for(E=G=F.length;G--;)H=F[G],m=1-H,I=m*m*m*a+3*m*m*H*
e+3*m*H*H*g+H*H*H*w,D[0][G]=I,H=m*m*m*b+3*m*m*H*c+3*m*H*H*d+H*H*H*C,D[1][G]=H;D[0][E]=a;D[1][E]=b;D[0][E+1]=w;D[1][E+1]=C;t=[{x:t.apply(null,D[0]),y:t.apply(null,D[1])},{x:x.apply(null,D[0]),y:x.apply(null,D[1])}];return f[l]=t,t}var e={},g={},f={},k=Array.prototype.join;fabric.util.drawArc=function(a,b,f,e){var c=[[],[],[],[]];e=d(e[5]-b,e[6]-f,e[0],e[1],e[3],e[4],e[2]);for(var g=0,k=e.length;k>g;g++)c[g][0]=e[g][0]+b,c[g][1]=e[g][1]+f,c[g][2]=e[g][2]+b,c[g][3]=e[g][3]+f,c[g][4]=e[g][4]+b,c[g][5]=
e[g][5]+f,a.bezierCurveTo.apply(a,c[g])};fabric.util.getBoundsOfArc=function(b,f,e,c,g,k,w,C,B){var l=0,m=0,p=[];e=d(C-b,B-f,e,c,k,w,g);c=[[],[]];g=0;for(k=e.length;k>g;g++)l=a(l,m,e[g][0],e[g][1],e[g][2],e[g][3],e[g][4],e[g][5]),c[0].x=l[0].x+b,c[0].y=l[0].y+f,c[1].x=l[1].x+b,c[1].y=l[1].y+f,p.push(c[0]),p.push(c[1]),l=e[g][4],m=e[g][5];return p};fabric.util.getBoundsOfCurve=a})();
(function(){function d(b,a,e){if(b&&0!==b.length){var c=b.length-1,f=a?b[c][a]:b[c];if(a)for(;c--;)e(b[c][a],f)&&(f=b[c][a]);else for(;c--;)e(b[c],f)&&(f=b[c]);return f}}var c=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(b){if(void 0===this||null===this)throw new TypeError;var a=Object(this),e=a.length>>>0;if(0===e)return-1;var c=0;if(0<arguments.length&&(c=Number(arguments[1]),c!==c?c=0:0!==c&&c!==Number.POSITIVE_INFINITY&&c!==Number.NEGATIVE_INFINITY&&(c=(0<c||
-1)*Math.floor(Math.abs(c)))),c>=e)return-1;for(c=0<=c?c:Math.max(e-Math.abs(c),0);e>c;c++)if(c in a&&a[c]===b)return c;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(b,a){for(var e=0,c=this.length>>>0;c>e;e++)e in this&&b.call(a,this[e],e,this)});Array.prototype.map||(Array.prototype.map=function(b,a){for(var e=[],c=0,f=this.length>>>0;f>c;c++)c in this&&(e[c]=b.call(a,this[c],c,this));return e});Array.prototype.every||(Array.prototype.every=function(b,a){for(var e=0,c=this.length>>>
0;c>e;e++)if(e in this&&!b.call(a,this[e],e,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(b,a){for(var e=0,c=this.length>>>0;c>e;e++)if(e in this&&b.call(a,this[e],e,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(b,a){for(var e,c=[],f=0,k=this.length>>>0;k>f;f++)f in this&&(e=this[f],b.call(a,e,f,this)&&c.push(e));return c});Array.prototype.reduce||(Array.prototype.reduce=function(b){var a=this.length>>>0,e=0;if(1<arguments.length)var c=
arguments[1];else for(;;){if(e in this){c=this[e++];break}if(++e>=a)throw new TypeError;}for(;a>e;e++)e in this&&(c=b.call(null,c,this[e],e,this));return c});fabric.util.array={invoke:function(b,a){for(var e=c.call(arguments,2),g=[],f=0,k=b.length;k>f;f++)g[f]=e.length?b[f][a].apply(b[f],e):b[f][a].call(b[f]);return g},min:function(b,a){return d(b,a,function(a,b){return b>a})},max:function(b,a){return d(b,a,function(a,b){return a>=b})}}})();
(function(){function d(c,b){for(var a in b)c[a]=b[a];return c}fabric.util.object={extend:d,clone:function(c){return d({},c)}}})();
(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:function(d){return d.replace(/-+(.)?/g,function(c,b){return b?b.toUpperCase():""})},capitalize:function(d,c){return d.charAt(0).toUpperCase()+(c?d.slice(1):d.slice(1).toLowerCase())},escapeXml:function(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var d=Array.prototype.slice,c=Function.prototype.apply,b=function(){};Function.prototype.bind||(Function.prototype.bind=function(a){var e,g=this,f=d.call(arguments,1);return e=f.length?function(){return c.call(g,this instanceof b?this:a,f.concat(d.call(arguments)))}:function(){return c.call(g,this instanceof b?this:a,arguments)},b.prototype=this.prototype,e.prototype=new b,e})})();
(function(){function d(){}function c(a){var f=this.constructor.superclass.prototype[a];return 1<arguments.length?f.apply(this,b.call(arguments,1)):f.call(this)}var b=Array.prototype.slice,a=function(){},e=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),g=function(a,b,c){for(var f in b)f in a.prototype&&"function"==typeof a.prototype[f]&&-1<(b[f]+"").indexOf("callSuper")?a.prototype[f]=function(a){return function(){var f=this.constructor.superclass;this.constructor.superclass=
c;var e=b[a].apply(this,arguments);return this.constructor.superclass=f,"initialize"!==a?e:void 0}}(f):a.prototype[f]=b[f],e&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};fabric.util.createClass=function(){function f(){this.initialize.apply(this,arguments)}var e=null,l=b.call(arguments,0);"function"==typeof l[0]&&(e=l.shift());f.superclass=e;f.subclasses=[];e&&(d.prototype=e.prototype,f.prototype=
new d,e.subclasses.push(f));for(var m=0,p=l.length;p>m;m++)g(f,l[m],e);return f.prototype.initialize||(f.prototype.initialize=a),f.prototype.constructor=f,f.prototype.callSuper=c,f}})();
(function(){function d(a){var b,f,e=Array.prototype.slice.call(arguments,1),c=e.length;for(f=0;c>f;f++)if(b=typeof a[e[f]],!/^(?:function|object|unknown)$/.test(b))return!1;return!0}function c(a,b){return function(f){b.call(e(a),f||fabric.window.event)}}function b(a,b){return function(f){if(q[a]&&q[a][b])for(var e=q[a][b],c=0,g=e.length;g>c;c++)e[c].call(this,f||fabric.window.event)}}function a(a,b,f){var e="touchend"===a.type?"changedTouches":"touches";return a[e]&&a[e][0]?a[e][0][b]-(a[e][0][b]-
a[e][0][f])||a[f]:a[f]}var e,g,f=function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}}();!function(){var a={};e=function(b){return a[b]};g=function(b,f){a[b]=f}}();var k,l,m=d(fabric.document.documentElement,"addEventListener","removeEventListener")&&d(fabric.window,"addEventListener","removeEventListener"),p=d(fabric.document.documentElement,"attachEvent","detachEvent")&&d(fabric.window,"attachEvent","detachEvent"),n={},q={};m?(k=function(a,b,f){a.addEventListener(b,
f,!1)},l=function(a,b,f){a.removeEventListener(b,f,!1)}):p?(k=function(a,b,e){var k=f(a);g(k,a);n[k]||(n[k]={});n[k][b]||(n[k][b]=[]);e={handler:e,wrappedHandler:c(k,e)};n[k][b].push(e);a.attachEvent("on"+b,e.wrappedHandler)},l=function(a,b,e){var c,g=f(a);if(n[g]&&n[g][b])for(var k=0,d=n[g][b].length;d>k;k++)(c=n[g][b][k])&&c.handler===e&&(a.detachEvent("on"+b,c.wrappedHandler),n[g][b][k]=null)}):(k=function(a,e,c){var g=f(a);if(q[g]||(q[g]={}),!q[g][e]){q[g][e]=[];var k=a["on"+e];k&&q[g][e].push(k);
a["on"+e]=b(g,e)}q[g][e].push(c)},l=function(a,b,e){a=f(a);if(q[a]&&q[a][b]){b=q[a][b];a=0;for(var c=b.length;c>a;a++)b[a]===e&&b.splice(a,1)}});fabric.util.addListener=k;fabric.util.removeListener=l;var t=function(a){return"unknown"!==typeof a.clientX?a.clientX:0},w=function(a){return"unknown"!==typeof a.clientY?a.clientY:0};fabric.isTouchSupported&&(t=function(b){return a(b,"pageX","clientX")},w=function(b){return a(b,"pageY","clientY")});fabric.util.getPointer=function(a){a||(a=fabric.window.event);
var b=fabric.util.getScrollLeftTop(a.target||("unknown"!==typeof a.srcElement?a.srcElement:null));return{x:t(a)+b.left,y:w(a)+b.top}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var d=fabric.document.createElement("div"),c="string"==typeof d.style.filter,b=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(a){return a};"string"==typeof d.style.opacity?a=function(a,b){return a.style.opacity=b,a}:c&&(a=function(a,c){var f=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(f.zoom=1),b.test(f.filter)?(c=.9999<=c?"":"alpha(opacity="+100*c+")",f.filter=f.filter.replace(b,c)):f.filter+=" alpha(opacity="+100*c+")",a});fabric.util.setStyle=function(b,c){var f=
b.style;if(!f)return b;if("string"==typeof c)return b.style.cssText+=";"+c,-1<c.indexOf("opacity")?a(b,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):b;for(var e in c)"opacity"===e?a(b,c[e]):f["float"===e||"cssFloat"===e?"undefined"==typeof f.styleFloat?"cssFloat":"styleFloat":e]=c[e];return b}})();
(function(){function d(a,b){var f=fabric.document.createElement(a),e;for(e in b)"class"===e?f.className=b[e]:"for"===e?f.htmlFor=b[e]:f.setAttribute(e,b[e]);return f}function c(a){for(var b=0,f=0,e=fabric.document.documentElement,c=fabric.document.body||{scrollLeft:0,scrollTop:0};a&&(a.parentNode||a.host)&&(a=a.parentNode||a.host,a===fabric.document?(b=c.scrollLeft||e.scrollLeft||0,f=c.scrollTop||e.scrollTop||0):(b+=a.scrollLeft||0,f+=a.scrollTop||0),1!==a.nodeType||"fixed"!==fabric.util.getElementStyle(a,
"position")););return{left:b,top:f}}var b=Array.prototype.slice,a=function(a){return b.call(a,0)};try{var e=a(fabric.document.childNodes)instanceof Array}catch(f){}e||(a=function(a){for(var b=Array(a.length),f=a.length;f--;)b[f]=a[f];return b});var g=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,b){var f=fabric.document.defaultView.getComputedStyle(a,null);return f?f[b]:void 0}:function(a,b){var f=a.style[b];return!f&&a.currentStyle&&(f=a.currentStyle[b]),f};
(function(){var a=fabric.document.documentElement.style,b="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction),b?a.style[b]="none":"string"==typeof a.unselectable&&(a.unselectable="on"),a};fabric.util.makeElementSelectable=function(a){return"undefined"!=typeof a.onselectstart&&
(a.onselectstart=null),b?a.style[b]="":"string"==typeof a.unselectable&&(a.unselectable=""),a}})();(function(){fabric.util.getScript=function(a,b){var f=fabric.document.getElementsByTagName("head")[0],e=fabric.document.createElement("script"),c=!0;e.onload=e.onreadystatechange=function(a){!c||"string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(c=!1,b(a||fabric.window.event),e=e.onload=e.onreadystatechange=null)};e.src=a;f.appendChild(e)}})();fabric.util.getById=
function(a){return"string"==typeof a?fabric.document.getElementById(a):a};fabric.util.toArray=a;fabric.util.makeElement=d;fabric.util.addClass=function(a,b){a&&-1===(" "+a.className+" ").indexOf(" "+b+" ")&&(a.className+=(a.className?" ":"")+b)};fabric.util.wrapElement=function(a,b,e){return"string"==typeof b&&(b=d(b,e)),a.parentNode&&a.parentNode.replaceChild(b,a),b.appendChild(a),b};fabric.util.getScrollLeftTop=c;fabric.util.getElementOffset=function(a){var b,e,f=a&&a.ownerDocument,d={left:0,top:0},
n={left:0,top:0},q={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!f)return n;for(var t in q)n[q[t]]+=parseInt(g(a,t),10)||0;return b=f.documentElement,"undefined"!=typeof a.getBoundingClientRect&&(d=a.getBoundingClientRect()),e=c(a),{left:d.left+e.left-(b.clientLeft||0)+n.left,top:d.top+e.top-(b.clientTop||0)+n.top}};fabric.util.getElementStyle=g})();
(function(){function d(a,b){return a+(/\?/.test(a)?"&":"?")+b}function c(){}var b=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{if(a[b]())return a[b]}catch(g){}}();fabric.util.request=function(a,e){e||(e={});var g,f=e.method?e.method.toUpperCase():"GET",k=e.onComplete||function(){},l=b();return l.onreadystatechange=
function(){4===l.readyState&&(k(l),l.onreadystatechange=c)},"GET"===f&&(g=null,"string"==typeof e.parameters&&(a=d(a,e.parameters))),l.open(f,a,!0),("POST"===f||"PUT"===f)&&l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send(g),l}})();fabric.log=function(){};fabric.warn=function(){};"undefined"!=typeof console&&["log","warn"].forEach(function(d){"undefined"!=typeof console[d]&&"function"==typeof console[d].apply&&(fabric[d]=function(){return console[d].apply(console,arguments)})});
(function(){function d(){return c.apply(fabric.window,arguments)}var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(b){fabric.window.setTimeout(b,1E3/60)};fabric.util.animate=function(b){d(function(a){b||(b={});var e,c=a||+new Date,f=b.duration||500,k=c+f,l=b.onChange||function(){},m=b.abort||function(){return!1},p=b.easing||function(a,b,
e,f){return-e*Math.cos(a/f*(Math.PI/2))+e+b},n="startValue"in b?b.startValue:0;a="endValue"in b?b.endValue:100;var q=b.byValue||a-n;b.onStart&&b.onStart();(function w(a){e=a||+new Date;a=e>k?f:e-c;return m()?void(b.onComplete&&b.onComplete()):(l(p(a,n,q,f)),e>k?void(b.onComplete&&b.onComplete()):void d(w))})(c)})};fabric.util.requestAnimFrame=d})();
(function(){function d(a,b,f,c){return a<Math.abs(b)?(a=b,c=f/4):c=f/(2*Math.PI)*Math.asin(b/a),{a:a,c:b,p:f,s:c}}function c(a,b,f){return a.a*Math.pow(2,10*--b)*Math.sin(2*(b*f-a.s)*Math.PI/a.p)}function b(b,c,f,k){return f-a(k-b,0,f,k)+c}function a(a,b,f,c){return(a/=c)<1/2.75?7.5625*f*a*a+b:2/2.75>a?f*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?f*(7.5625*(a-=2.25/2.75)*a+.9375)+b:f*(7.5625*(a-=2.625/2.75)*a+.984375)+b}fabric.util.ease={easeInQuad:function(a,b,f,c){return f*(a/=c)*a+b},easeOutQuad:function(a,
b,f,c){return-f*(a/=c)*(a-2)+b},easeInOutQuad:function(a,b,f,c){return a/=c/2,1>a?f/2*a*a+b:-f/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,f,c){return f*(a/=c)*a*a+b},easeOutCubic:function(a,b,f,c){return f*((a=a/c-1)*a*a+1)+b},easeInOutCubic:function(a,b,f,c){return a/=c/2,1>a?f/2*a*a*a+b:f/2*((a-=2)*a*a+2)+b},easeInQuart:function(a,b,f,c){return f*(a/=c)*a*a*a+b},easeOutQuart:function(a,b,f,c){return-f*((a=a/c-1)*a*a*a-1)+b},easeInOutQuart:function(a,b,f,c){return a/=c/2,1>a?f/2*a*a*a*a+b:-f/2*
((a-=2)*a*a*a-2)+b},easeInQuint:function(a,b,f,c){return f*(a/=c)*a*a*a*a+b},easeOutQuint:function(a,b,f,c){return f*((a=a/c-1)*a*a*a*a+1)+b},easeInOutQuint:function(a,b,f,c){return a/=c/2,1>a?f/2*a*a*a*a*a+b:f/2*((a-=2)*a*a*a*a+2)+b},easeInSine:function(a,b,f,c){return-f*Math.cos(a/c*(Math.PI/2))+f+b},easeOutSine:function(a,b,f,c){return f*Math.sin(a/c*(Math.PI/2))+b},easeInOutSine:function(a,b,f,c){return-f/2*(Math.cos(Math.PI*a/c)-1)+b},easeInExpo:function(a,b,f,c){return 0===a?b:f*Math.pow(2,
10*(a/c-1))+b},easeOutExpo:function(a,b,f,c){return a===c?b+f:f*(-Math.pow(2,-10*a/c)+1)+b},easeInOutExpo:function(a,b,f,c){return 0===a?b:a===c?b+f:(a/=c/2,1>a?f/2*Math.pow(2,10*(a-1))+b:f/2*(-Math.pow(2,-10*--a)+2)+b)},easeInCirc:function(a,b,f,c){return-f*(Math.sqrt(1-(a/=c)*a)-1)+b},easeOutCirc:function(a,b,f,c){return f*Math.sqrt(1-(a=a/c-1)*a)+b},easeInOutCirc:function(a,b,f,c){return a/=c/2,1>a?-f/2*(Math.sqrt(1-a*a)-1)+b:f/2*(Math.sqrt(1-(a-=2)*a)+1)+b},easeInElastic:function(a,b,f,k){var e=
0;if(0===a)return b;if(a/=k,1===a)return b+f;e||(e=.3*k);f=d(f,f,e,1.70158);return-c(f,a,k)+b},easeOutElastic:function(a,b,f,c){var e=0;if(0===a)return b;if(a/=c,1===a)return b+f;e||(e=.3*c);f=d(f,f,e,1.70158);return f.a*Math.pow(2,-10*a)*Math.sin(2*(a*c-f.s)*Math.PI/f.p)+f.c+b},easeInOutElastic:function(a,b,f,k){var e=0;if(0===a)return b;if(a/=k/2,2===a)return b+f;e||(e=.3*k*1.5);f=d(f,f,e,1.70158);return 1>a?-.5*c(f,a,k)+b:f.a*Math.pow(2,-10*--a)*Math.sin(2*(a*k-f.s)*Math.PI/f.p)*.5+f.c+b},easeInBack:function(a,
b,f,c,d){return void 0===d&&(d=1.70158),f*(a/=c)*a*((d+1)*a-d)+b},easeOutBack:function(a,b,f,c,d){return void 0===d&&(d=1.70158),f*((a=a/c-1)*a*((d+1)*a+d)+1)+b},easeInOutBack:function(a,b,f,c,d){return void 0===d&&(d=1.70158),a/=c/2,1>a?f/2*a*a*(((d*=1.525)+1)*a-d)+b:f/2*((a-=2)*a*(((d*=1.525)+1)*a+d)+2)+b},easeInBounce:b,easeOutBounce:a,easeInOutBounce:function(c,g,f,k){return k/2>c?.5*b(2*c,0,f,k)+g:.5*a(2*c-k,0,f,k)+.5*f+g}}})();
(function(d){function c(a){return a in x?x[a]:a}function b(a,b,f,c){var e,g="[object Array]"===Object.prototype.toString.call(b);return"fill"!==a&&"stroke"!==a||"none"!==b?"strokeDashArray"===a?b=b.replace(/,/g," ").split(/\s+/).map(function(a){return parseFloat(a)}):"transformMatrix"===a?b=f&&f.transformMatrix?v(f.transformMatrix,n.parseTransformAttribute(b)):n.parseTransformAttribute(b):"visible"===a?(b="none"===b||"hidden"===b?!1:!0,f&&!1===f.visible&&(b=!1)):"originX"===a?b="start"===b?"left":
"end"===b?"right":"center":e=g?b.map(B):B(b,c):b="",!g&&isNaN(e)?b:e}function a(a){for(var b in A)if("undefined"!=typeof a[A[b]]){if(!a[b]){if(!n.Object.prototype[b])continue;a[b]=n.Object.prototype[b]}if(0!==a[b].indexOf("url(")){var f=new n.Color(a[b]);a[b]=f.setAlpha(C(f.getAlpha()*a[A[b]],2)).toRgba()}}return a}function e(a,f){var e,g;a.replace(/;\s*$/,"").split(";").forEach(function(a){a=a.split(":");e=c(a[0].trim().toLowerCase());g=b(e,a[1].trim());f[e]=g})}function g(a,b){var c={},e;for(e in n.cssRules[b]){var g,
k=a,d=e.split(" "),l=!0;if((g=f(k,d.pop()))&&d.length){for(var l=void 0,m=d,p=!0;k.parentNode&&1===k.parentNode.nodeType&&m.length;)p&&(l=m.pop()),k=k.parentNode,p=f(k,l);l=0===m.length}if(g&&l&&0===d.length)for(var q in n.cssRules[b][e])c[q]=n.cssRules[b][e][q]}return c}function f(a,b){var f,c=a.nodeName,e=a.getAttribute("class"),g=a.getAttribute("id");if(f=new RegExp("^"+c,"i"),b=b.replace(f,""),g&&b.length&&(f=new RegExp("#"+g+"(?![a-zA-Z\\-]+)","i"),b=b.replace(f,"")),e&&b.length)for(e=e.split(" "),
c=e.length;c--;)f=new RegExp("\\."+e[c]+"(?![a-zA-Z\\-]+)","i"),b=b.replace(f,"");return 0===b.length}function k(a){for(var b=a.getElementsByTagName("use"),f=0;b.length&&f<b.length;){var c=b[f];var e=c.getAttribute("xlink:href").substr(1);var g=c.getAttribute("x")||0;var k=c.getAttribute("y")||0;var d;a:{var m=d=void 0;var p=a;if(p.getElementById&&(m=p.getElementById(e)),m)d=m;else{p=p.getElementsByTagName("*");for(m=0;m<p.length;m++)if(d=p[m],e===d.getAttribute("id"))break a;d=void 0}}d=d.cloneNode(!0);
var p=(d.getAttribute("transform")||"")+" translate("+g+", "+k+")",n=b.length;if(l(d),/^svg$/i.test(d.nodeName)){var q=d.ownerDocument.createElement("g");k=0;e=d.attributes;for(m=e.length;m>k;k++)g=e.item(k),q.setAttribute(g.nodeName,g.nodeValue);for(;null!=d.firstChild;)q.appendChild(d.firstChild);d=q}k=0;e=c.attributes;for(m=e.length;m>k;k++)g=e.item(k),"x"!==g.nodeName&&"y"!==g.nodeName&&"xlink:href"!==g.nodeName&&("transform"===g.nodeName?p=g.nodeValue+" "+p:d.setAttribute(g.nodeName,g.nodeValue));
d.setAttribute("transform",p);d.setAttribute("instantiated_by_use","1");d.removeAttribute("id");c.parentNode.replaceChild(d,c);b.length===n&&f++}}function l(a){var b,f,c=a.getAttribute("viewBox"),e=1,g=1,k=0,d=0,l=a.getAttribute("width"),m=a.getAttribute("height"),p=a.getAttribute("x")||0,q=a.getAttribute("y")||0,t=a.getAttribute("preserveAspectRatio")||"",w=!c||!u.test(a.tagName)||!(c=c.match(F)),C=!l||!m||"100%"===l||"100%"===m,r=w&&C,v={};var G="";if(v.width=0,v.height=0,v.toBeParsed=r,r)return v;
if(w)return v.width=B(l),v.height=B(m),v;if(k=-parseFloat(c[1]),d=-parseFloat(c[2]),b=parseFloat(c[3]),f=parseFloat(c[4]),C?(v.width=b,v.height=f):(v.width=B(l),v.height=B(m),e=v.width/b,g=v.height/f),t=n.util.parsePreserveAspectRatioAttribute(t),"none"!==t.alignX&&(g=e=e>g?g:e),1===e&&1===g&&0===k&&0===d&&0===p&&0===q)return v;if((p||q)&&(G=" translate("+B(p)+" "+B(q)+") "),b=G+" matrix("+e+" 0 0 "+g+" "+k*e+" "+d*g+") ","svg"===a.tagName){for(G=a.ownerDocument.createElement("g");null!=a.firstChild;)G.appendChild(a.firstChild);
a.appendChild(G)}else G=a,b=G.getAttribute("transform")+b;return G.setAttribute("transform",b),v}function m(a){var b=a.objects;a=a.options;return b=b.map(function(a){return n[t(a.type)].fromObject(a)}),{objects:b,options:a}}function p(a,b,f){b[f]&&b[f].toSVG&&a.push('\t<pattern x="0" y="0" id="',f,'Pattern" ','width="',b[f].source.width,'" height="',b[f].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',b[f].source.width,'" height="',b[f].source.height,'" xlink:href="',
b[f].source.src,'"></image>\n\t</pattern>\n')}var n=d.fabric||(d.fabric={}),q=n.util.object.extend,t=n.util.string.capitalize,w=n.util.object.clone,C=n.util.toFixed,B=n.util.parseUnit,v=n.util.multiplyTransformMatrices,r=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,u=/^(symbol|image|marker|pattern|view|svg)$/i,y=/^(?:pattern|defs|symbol|metadata)$/i,z=/^(symbol|g|a|svg)$/i,x={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix",
"fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},A={stroke:"strokeOpacity",fill:"fillOpacity"};n.cssRules={};n.gradientDefs={};n.parseTransformAttribute=
function(){function a(a,b){var f=b[0],c=3===b.length?b[1]:0,e=3===b.length?b[2]:0;a[0]=Math.cos(f);a[1]=Math.sin(f);a[2]=-Math.sin(f);a[3]=Math.cos(f);a[4]=c-(a[0]*c+a[2]*e);a[5]=e-(a[1]*c+a[3]*e)}function b(a,b){var f=2===b.length?b[1]:b[0];a[0]=b[0];a[3]=f}function f(a,b){a[4]=b[0];2===b.length&&(a[5]=b[1])}var c=[1,0,0,1,0,0],e=n.reNum,g="(?:"+("(?:(matrix)\\s*\\(\\s*("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+
e+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+e+")(?:(?:\\s+,?\\s*|,\\s*)("+e+")(?:\\s+,?\\s*|,\\s*)("+e+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+e+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+e+")\\s*\\))")+")",k=new RegExp("^\\s*(?:"+("(?:"+g+"(?:(?:\\s+,?\\s*|,\\s*)"+g+")*)")+"?)\\s*$"),d=new RegExp(g,"g");return function(e){var l=c.concat(),
m=[];if(!e||e&&!k.test(e))return l;e.replace(d,function(e){var k=(new RegExp(g)).exec(e).filter(function(a){return""!==a&&null!=a});e=k[1];k=k.slice(2).map(parseFloat);switch(e){case "translate":f(l,k);break;case "rotate":k[0]=n.util.degreesToRadians(k[0]);a(l,k);break;case "scale":b(l,k);break;case "skewX":l[2]=Math.tan(n.util.degreesToRadians(k[0]));break;case "skewY":l[1]=Math.tan(n.util.degreesToRadians(k[0]));break;case "matrix":l=k}m.push(l.concat());l=c.concat()});for(e=m[0];1<m.length;)m.shift(),
e=n.util.multiplyTransformMatrices(e,m[0]);return e}}();var F=new RegExp("^\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*$");n.parseSVGDocument=function(){return function(a,b,f){if(a){k(a);var c=new Date,e=n.Object.__uid++,g=l(a),d=n.util.toArray(a.getElementsByTagName("*"));if(g.svgUid=e,0===d.length&&n.isLikelyNode){for(var d=a.selectNodes('//*[name(.)!="svg"]'),m=[],p=0,q=d.length;q>p;p++)m[p]=d[p];d=m}d=d.filter(function(a){l(a);var b;if(b=r.test(a.tagName)){a:{for(;a&&
(a=a.parentNode);)if(y.test(a.nodeName)&&!a.getAttribute("instantiated_by_use")){a=!0;break a}a=!1}b=!a}return b});if(!d||d&&!d.length)return void(b&&b([],{}));n.gradientDefs[e]=n.getGradientDefs(a);n.cssRules[e]=n.getCSSRules(a);n.parseElements(d,function(a){n.documentParsingTime=new Date-c;b&&b(a,g)},w(g),f)}}}();var D={has:function(a,b){b(!1)},get:function(){},set:function(){}},E=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+
n.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+n.reNum+"))?\\s+(.*)");q(n,{parseFontDeclaration:function(a,b){var f=a.match(E);if(f){var c=f[1],e=f[3],g=f[4],k=f[5],f=f[6];c&&(b.fontStyle=c);e&&(b.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e));g&&(b.fontSize=B(g));f&&(b.fontFamily=f);k&&(b.lineHeight="normal"===k?1:k)}},getGradientDefs:function(a){var b;var f=a.getElementsByTagName("linearGradient");var c=a.getElementsByTagName("radialGradient"),e=0,g=[];a={};var k={};g.length=f.length+c.length;
for(b=f.length;b--;)g[e++]=f[b];for(b=c.length;b--;)g[e++]=c[b];for(;e--;){f=g[e];b=f.getAttribute("xlink:href");var d=f.getAttribute("id");b&&(k[d]=b.substr(1));a[d]=f}for(d in k)for(e=a[k[d]].cloneNode(!0),f=a[d];e.firstChild;)f.appendChild(e.firstChild);return a},parseAttributes:function(f,e,k){if(f){var d,l={};"undefined"==typeof k&&(k=f.getAttribute("svgUid"));f.parentNode&&z.test(f.parentNode.nodeName)&&(l=n.parseAttributes(f.parentNode,e,k));var m=l&&l.fontSize||f.getAttribute("font-size")||
n.Text.DEFAULT_SVG_FONT_SIZE;e=e.reduce(function(a,e){return d=f.getAttribute(e),d&&(e=c(e),d=b(e,d,l,m),a[e]=d),a},{});return e=q(e,q(g(f,k),n.parseStyleAttribute(f))),e.font&&n.parseFontDeclaration(e.font,e),a(q(l,e))}},parseElements:function(a,b,f,c){(new n.ElementsParser(a,b,f,c)).parse()},parseStyleAttribute:function(a){var f={};if(a=a.getAttribute("style"))if("string"==typeof a)e(a,f);else{var g,k,d;for(d in a)"undefined"!=typeof a[d]&&(g=c(d.toLowerCase()),k=b(g,a[d]),f[g]=k)}return f},parsePointsAttribute:function(a){if(!a)return null;
a=a.replace(/,/g," ").trim();a=a.split(/\s+/);var b,f=[];var c=0;for(b=a.length;b>c;c+=2)f.push({x:parseFloat(a[c]),y:parseFloat(a[c+1])});return f},getCSSRules:function(a){var f;a=a.getElementsByTagName("style");for(var e={},g=0,k=a.length;k>g;g++){var d=a[g].textContent,d=d.replace(/\/\*[\s\S]*?\*\//g,"");""!==d.trim()&&(f=d.match(/[^{]*\{[\s\S]*?\}/g),f=f.map(function(a){return a.trim()}),f.forEach(function(a){a=a.match(/([\s\S]*?)\s*\{([^}]*)\}/);for(var f={},g=a[2].trim().replace(/;$/,"").split(/\s*;\s*/),
k=0,d=g.length;d>k;k++){var l=g[k].split(/\s*:\s*/),m=c(l[0]),l=b(m,l[1],l[0]);f[m]=l}a=a[1];a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim();""!==a&&(e[a]=n.util.object.clone(f))})}))}return e},loadSVGFromURL:function(a,b,f){function c(c){var e=c.responseXML;e&&!e.documentElement&&n.window.ActiveXObject&&c.responseText&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(c.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e&&e.documentElement&&n.parseSVGDocument(e.documentElement,
function(f,c){D.set(a,{objects:n.util.array.invoke(f,"toObject"),options:c});b(f,c)},f)}a=a.replace(/^\n\s*/,"").trim();D.has(a,function(f){f?D.get(a,function(a){a=m(a);b(a.objects,a.options)}):new n.util.request(a,{method:"get",onComplete:c})})},loadSVGFromString:function(a,b,f){a=a.trim();var c;if("undefined"!=typeof DOMParser){var e=new DOMParser;e&&e.parseFromString&&(c=e.parseFromString(a,"text/xml"))}else n.window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,
"")));n.parseSVGDocument(c.documentElement,function(a,f){b(a,f)},f)},createSVGFontFacesMarkup:function(a){for(var b="",f=0,c=a.length;c>f;f++)"text"===a[f].type&&a[f].path&&(b+=["@font-face {font-family: ",a[f].fontFamily,"; src: url('",a[f].path,"')}\n"].join(""));return b&&(b=['\t<style type="text/css"><![CDATA[',b,"]]\x3e</style>\n"].join("")),b},createSVGRefElementsMarkup:function(a){var b=[];return p(b,a,"backgroundColor"),p(b,a,"overlayColor"),b.join("")}})})("undefined"!=typeof exports?exports:
this);fabric.ElementsParser=function(d,c,b,a){this.elements=d;this.callback=c;this.options=b;this.reviver=a;this.svgUid=b&&b.svgUid||0};fabric.ElementsParser.prototype.parse=function(){this.instances=Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};
fabric.ElementsParser.prototype.createObjects=function(){for(var d=0,c=this.elements.length;c>d;d++)this.elements[d].setAttribute("svgUid",this.svgUid),function(b,a){setTimeout(function(){b.createObject(b.elements[a],a)},0)}(this,d)};fabric.ElementsParser.prototype.createObject=function(d,c){var b=fabric[fabric.util.string.capitalize(d.tagName)];if(b&&b.fromElement)try{this._createObject(b,d,c)}catch(a){fabric.log(a)}else this.checkIfDone()};
fabric.ElementsParser.prototype._createObject=function(d,c,b){d.async?d.fromElement(c,this.createCallback(b,c),this.options):(d=d.fromElement(c,this.options),this.resolveGradient(d,"fill"),this.resolveGradient(d,"stroke"),this.reviver&&this.reviver(c,d),this.instances[b]=d,this.checkIfDone())};fabric.ElementsParser.prototype.createCallback=function(d,c){var b=this;return function(a){b.resolveGradient(a,"fill");b.resolveGradient(a,"stroke");b.reviver&&b.reviver(c,a);b.instances[d]=a;b.checkIfDone()}};
fabric.ElementsParser.prototype.resolveGradient=function(d,c){var b=d.get(c);/^url\(/.test(b)&&(b=b.slice(5,b.length-1),fabric.gradientDefs[this.svgUid][b]&&d.set(c,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][b],d)))};fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(d){return null!=d}),this.callback(this.instances))};
(function(d){function c(b,a){this.x=b;this.y=a}d=d.fabric||(d.fabric={});return d.Point?void d.warn("fabric.Point is already defined"):(d.Point=c,void(c.prototype={constructor:c,add:function(b){return new c(this.x+b.x,this.y+b.y)},addEquals:function(b){return this.x+=b.x,this.y+=b.y,this},scalarAdd:function(b){return new c(this.x+b,this.y+b)},scalarAddEquals:function(b){return this.x+=b,this.y+=b,this},subtract:function(b){return new c(this.x-b.x,this.y-b.y)},subtractEquals:function(b){return this.x-=
b.x,this.y-=b.y,this},scalarSubtract:function(b){return new c(this.x-b,this.y-b)},scalarSubtractEquals:function(b){return this.x-=b,this.y-=b,this},multiply:function(b){return new c(this.x*b,this.y*b)},multiplyEquals:function(b){return this.x*=b,this.y*=b,this},divide:function(b){return new c(this.x/b,this.y/b)},divideEquals:function(b){return this.x/=b,this.y/=b,this},eq:function(b){return this.x===b.x&&this.y===b.y},lt:function(b){return this.x<b.x&&this.y<b.y},lte:function(b){return this.x<=b.x&&
this.y<=b.y},gt:function(b){return this.x>b.x&&this.y>b.y},gte:function(b){return this.x>=b.x&&this.y>=b.y},lerp:function(b,a){return new c(this.x+(b.x-this.x)*a,this.y+(b.y-this.y)*a)},distanceFrom:function(b){var a=this.x-b.x;b=this.y-b.y;return Math.sqrt(a*a+b*b)},midPointFrom:function(b){return new c(this.x+(b.x-this.x)/2,this.y+(b.y-this.y)/2)},min:function(b){return new c(Math.min(this.x,b.x),Math.min(this.y,b.y))},max:function(b){return new c(Math.max(this.x,b.x),Math.max(this.y,b.y))},toString:function(){return this.x+
","+this.y},setXY:function(b,a){this.x=b;this.y=a},setFromPoint:function(b){this.x=b.x;this.y=b.y},swap:function(b){var a=this.x,c=this.y;this.x=b.x;this.y=b.y;b.x=a;b.y=c}}))})("undefined"!=typeof exports?exports:this);
(function(d){function c(a){this.status=a;this.points=[]}var b=d.fabric||(d.fabric={});return b.Intersection?void b.warn("fabric.Intersection is already defined"):(b.Intersection=c,b.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},b.Intersection.intersectLineLine=function(a,e,g,f){var k,d=(f.x-g.x)*(a.y-g.y)-(f.y-g.y)*(a.x-g.x),m=(e.x-a.x)*(a.y-g.y)-(e.y-a.y)*(a.x-g.x);g=(f.y-g.y)*(e.x-a.x)-(f.x-g.x)*(e.y-a.y);0!==g?
(d/=g,m/=g,0<=d&&1>=d&&0<=m&&1>=m?(k=new c("Intersection"),k.points.push(new b.Point(a.x+d*(e.x-a.x),a.y+d*(e.y-a.y)))):k=new c):k=new c(0===d||0===m?"Coincident":"Parallel");return k},b.Intersection.intersectLinePolygon=function(a,b,g){for(var f=new c,e=g.length,d=0;e>d;d++){var m=c.intersectLineLine(a,b,g[d],g[(d+1)%e]);f.appendPoints(m.points)}return 0<f.points.length&&(f.status="Intersection"),f},b.Intersection.intersectPolygonPolygon=function(a,b){for(var e=new c,f=a.length,k=0;f>k;k++){var d=
c.intersectLinePolygon(a[k],a[(k+1)%f],b);e.appendPoints(d.points)}return 0<e.points.length&&(e.status="Intersection"),e},void(b.Intersection.intersectPolygonRectangle=function(a,e,g){var f=e.min(g),k=e.max(g);g=new b.Point(k.x,f.y);var d=new b.Point(f.x,k.y);e=c.intersectLinePolygon(f,g,a);g=c.intersectLinePolygon(g,k,a);k=c.intersectLinePolygon(k,d,a);a=c.intersectLinePolygon(d,f,a);f=new c;return f.appendPoints(e.points),f.appendPoints(g.points),f.appendPoints(k.points),f.appendPoints(a.points),
0<f.points.length&&(f.status="Intersection"),f}))})("undefined"!=typeof exports?exports:this);
(function(d){function c(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function b(a,b,f){return 0>f&&(f+=1),1<f&&--f,1/6>f?a+6*(b-a)*f:.5>f?b:2/3>f?a+(b-a)*(2/3-f)*6:a}var a=d.fabric||(d.fabric={});return a.Color?void a.warn("fabric.Color is already defined."):(a.Color=c,a.Color.prototype={_tryParsingColor:function(a){var b;return a in c.colorNameMap&&(a=c.colorNameMap[a]),"transparent"===a?void this.setSource([255,255,255,0]):(b=c.sourceFromHex(a),b||(b=c.sourceFromRgb(a)),b||(b=c.sourceFromHsl(a)),
void(b&&this.setSource(b)))},_rgbToHsl:function(b,c,f){b/=255;c/=255;f/=255;var e,g=a.util.array.max([b,c,f]);var d=a.util.array.min([b,c,f]);if(e=(g+d)/2,g===d)var p=d=0;else{var n=g-d;switch(d=.5<e?n/(2-g-d):n/(g+d),g){case b:p=(c-f)/n+(f>c?6:0);break;case c:p=(f-b)/n+2;break;case f:p=(b-c)/n+4}p/=6}return[Math.round(360*p),Math.round(100*d),Math.round(100*e)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+
","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a,b,f,c=this.getSource();return a=c[0].toString(16),a=1===a.length?"0"+a:a,b=c[1].toString(16),b=1===b.length?"0"+b:b,f=c[2].toString(16),
f=1===f.length?"0"+f:f,a.toUpperCase()+b.toUpperCase()+f.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();return b[3]=a,this.setSource(b),this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);return this.setSource([b,b,b,a[3]]),this},toBlackWhite:function(a){var b=this.getSource(),f=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),b=b[3];return a=a||127,f=Number(f)<Number(a)?0:255,this.setSource([f,
f,f,b]),this},overlayWith:function(a){a instanceof c||(a=new c(a));var b=[],f=this.getAlpha(),e=this.getSource();a=a.getSource();for(var d=0;3>d;d++)b.push(Math.round(.5*e[d]+.5*a[d]));return b[3]=f,this.setSource(b),this}},a.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,a.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,a.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,
a.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},a.Color.fromRgb=function(a){return c.fromSource(c.sourceFromRgb(a))},a.Color.sourceFromRgb=function(a){if(a=a.match(c.reRGBa)){var b=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),f=parseInt(a[2],
10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),e=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(b,10),parseInt(f,10),parseInt(e,10),a[4]?parseFloat(a[4]):1]}},a.Color.fromRgba=c.fromRgb,a.Color.fromHsl=function(a){return c.fromSource(c.sourceFromHsl(a))},a.Color.sourceFromHsl=function(a){if(a=a.match(c.reHSLa)){var e=(parseFloat(a[1])%360+360)%360/360;var f=parseFloat(a[2])/(/%$/.test(a[2])?100:1);var k=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===f)k=f=
e=k;else{var d=.5>=k?k*(f+1):k+f-k*f,m=2*k-d;k=b(m,d,e+1/3);f=b(m,d,e);e=b(m,d,e-1/3)}return[Math.round(255*k),Math.round(255*f),Math.round(255*e),a[4]?parseFloat(a[4]):1]}},a.Color.fromHsla=c.fromHsl,a.Color.fromHex=function(a){return c.fromSource(c.sourceFromHex(a))},a.Color.sourceFromHex=function(a){if(a.match(c.reHex)){var b=a.slice(a.indexOf("#")+1),f=3===b.length;a=f?b.charAt(0)+b.charAt(0):b.substring(0,2);var e=f?b.charAt(1)+b.charAt(1):b.substring(2,4),b=f?b.charAt(2)+b.charAt(2):b.substring(4,
6);return[parseInt(a,16),parseInt(e,16),parseInt(b,16),1]}},void(a.Color.fromSource=function(a){var b=new c;return b.setSource(a),b}))})("undefined"!=typeof exports?exports:this);
(function(){function d(b){var a,c,d,f=b.getAttribute("style"),k=b.getAttribute("offset")||0;if(k=parseFloat(k)/(/%$/.test(k)?100:1),k=0>k?0:1<k?1:k,f){f=f.split(/\s*;\s*/);""===f[f.length-1]&&f.pop();for(var l=f.length;l--;){var m=f[l].split(/\s*:\s*/),p=m[0].trim(),m=m[1].trim();"stop-color"===p?a=m:"stop-opacity"===p&&(d=m)}}return a||(a=b.getAttribute("stop-color")||"rgb(0,0,0)"),d||(d=b.getAttribute("stop-opacity")),a=new fabric.Color(a),c=a.getAlpha(),d=isNaN(parseFloat(d))?1:parseFloat(d),d*=
c,{offset:k,color:a.toRgb(),opacity:d}}function c(b,a,c){var e=0,f="",d;for(d in a){var l=parseFloat(a[d],10);var m="string"==typeof a[d]&&/^\d+%$/.test(a[d])?.01:1;"x1"===d||"x2"===d||"r2"===d?(m*="objectBoundingBox"===c?b.width:1,e="objectBoundingBox"===c?b.left||0:0):("y1"===d||"y2"===d)&&(m*="objectBoundingBox"===c?b.height:1,e="objectBoundingBox"===c?b.top||0:0);a[d]=l*m+e}"ellipse"===b.type&&null!==a.r2&&"objectBoundingBox"===c&&b.rx!==b.ry&&(b=b.ry/b.rx,f=" scale(1, "+b+")",a.y1&&(a.y1/=b),
a.y2&&(a.y2/=b));return f}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(b){b||(b={});this.id=fabric.Object.__uid++;this.type=b.type||"linear";var a={x1:b.coords.x1||0,y1:b.coords.y1||0,x2:b.coords.x2||0,y2:b.coords.y2||0};"radial"===this.type&&(a.r1=b.coords.r1||0,a.r2=b.coords.r2||0);this.coords=a;this.colorStops=b.colorStops.slice();b.gradientTransform&&(this.gradientTransform=b.gradientTransform);this.offsetX=b.offsetX||this.offsetX;this.offsetY=b.offsetY||this.offsetY},
addColorStop:function(b){for(var a in b){var c=new fabric.Color(b[a]);this.colorStops.push({offset:a,color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform}},toSVG:function(b){var a,c=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(a,b){return a.offset-b.offset}),
!b.group||"path-group"!==b.group.type)for(var d in c)"x1"===d||"x2"===d||"r2"===d?c[d]+=this.offsetX-b.width/2:("y1"===d||"y2"===d)&&(c[d]+=this.offsetY-b.height/2);b='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"';this.gradientTransform&&(b+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" ');"linear"===this.type?a=["<linearGradient ",b,' x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'">\n']:"radial"===this.type&&(a=["<radialGradient ",b,' cx="',c.x2,'" cy="',c.y2,
'" r="',c.r2,'" fx="',c.x1,'" fy="',c.y1,'">\n']);for(c=0;c<this.colorStops.length;c++)a.push("<stop ",'offset="',100*this.colorStops[c].offset+"%",'" style="stop-color:',this.colorStops[c].color,null!=this.colorStops[c].opacity?";stop-opacity: "+this.colorStops[c].opacity:";",'"/>\n');return a.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),a.join("")},toLive:function(b,a){var c,d=fabric.util.object.clone(this.coords);if(this.type){if(a.group&&"path-group"===a.group.type)for(f in d)"x1"===
f||"x2"===f?d[f]+=-this.offsetX+a.width/2:("y1"===f||"y2"===f)&&(d[f]+=-this.offsetY+a.height/2);"linear"===this.type?c=b.createLinearGradient(d.x1,d.y1,d.x2,d.y2):"radial"===this.type&&(c=b.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2));var f=0;for(d=this.colorStops.length;d>f;f++){var k=this.colorStops[f].color,l=this.colorStops[f].opacity,m=this.colorStops[f].offset;"undefined"!=typeof l&&(k=(new fabric.Color(k)).setAlpha(l).toRgba());c.addColorStop(parseFloat(m),k)}return c}}});fabric.util.object.extend(fabric.Gradient,
{fromElement:function(b,a){var e=b.getElementsByTagName("stop");var g="linearGradient"===b.nodeName?"linear":"radial",f=b.getAttribute("gradientUnits")||"objectBoundingBox",k=b.getAttribute("gradientTransform"),l=[],m={};"linear"===g?m={x1:b.getAttribute("x1")||0,y1:b.getAttribute("y1")||0,x2:b.getAttribute("x2")||"100%",y2:b.getAttribute("y2")||0}:"radial"===g&&(m={x1:b.getAttribute("fx")||b.getAttribute("cx")||"50%",y1:b.getAttribute("fy")||b.getAttribute("cy")||"50%",r1:0,x2:b.getAttribute("cx")||
"50%",y2:b.getAttribute("cy")||"50%",r2:b.getAttribute("r")||"50%"});for(var p=e.length;p--;)l.push(d(e[p]));e=c(a,m,f);g=new fabric.Gradient({type:g,coords:m,colorStops:l,offsetX:-a.left,offsetY:-a.top});return(k||""!==e)&&(g.gradientTransform=fabric.parseTransformAttribute((k||"")+e)),g},forObject:function(b,a){return a||(a={}),c(b,a.coords,"userSpaceOnUse"),new fabric.Gradient(a)}})})();
fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(d){if(d||(d={}),this.id=fabric.Object.__uid++,d.source)if("string"==typeof d.source)if("undefined"!=typeof fabric.util.getFunctionBody(d.source))this.source=new Function(fabric.util.getFunctionBody(d.source));else{var c=this;this.source=fabric.util.createImage();fabric.util.loadImage(d.source,function(b){c.source=b})}else this.source=d.source;d.repeat&&(this.repeat=d.repeat);d.offsetX&&(this.offsetX=d.offsetX);
d.offsetY&&(this.offsetY=d.offsetY)},toObject:function(){var d;return"function"==typeof this.source?d=String(this.source):"string"==typeof this.source.src?d=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(d=this.source.toDataURL()),{source:d,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(d){var c="function"==typeof this.source?this.source():this.source,b=c.width/d.getWidth(),a=c.height/d.getHeight(),e=this.offsetX/d.getWidth();d=this.offsetY/d.getHeight();
var g="";return("repeat-x"===this.repeat||"no-repeat"===this.repeat)&&(a=1),("repeat-y"===this.repeat||"no-repeat"===this.repeat)&&(b=1),c.src?g=c.src:c.toDataURL&&(g=c.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+e+'" y="'+d+'" width="'+b+'" height="'+a+'">\n<image x="0" y="0" width="'+c.width+'" height="'+c.height+'" xlink:href="'+g+'"></image>\n</pattern>\n'},toLive:function(d){var c="function"==typeof this.source?this.source():this.source;return c&&("undefined"==typeof c.src||c.complete&&
0!==c.naturalWidth&&0!==c.naturalHeight)?d.createPattern(c,this.repeat):""}});
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.toFixed;return c.Shadow?void c.warn("fabric.Shadow is already defined."):(c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(a){"string"==typeof a&&(a=this._parseShadow(a));for(var b in a)this[b]=a[b];this.id=c.Object.__uid++},_parseShadow:function(a){a=a.trim();var b=c.Shadow.reOffsetsAndBlur.exec(a)||[];return{color:(a.replace(c.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),
offsetX:parseInt(b[1],10)||0,offsetY:parseInt(b[2],10)||0,blur:parseInt(b[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var e=40,d=40,f=c.Object.NUM_FRACTION_DIGITS,k=c.util.rotateVector({x:this.offsetX,y:this.offsetY},c.util.degreesToRadians(-a.angle));return a.width&&a.height&&(e=100*b((Math.abs(k.x)+this.blur)/a.width,f)+20,d=100*b((Math.abs(k.y)+this.blur)/a.height,f)+20),'<filter id="SVGID_'+this.id+'" y="-'+d+'%" height="'+
(100+2*d)+'%" x="-'+e+'%" width="'+(100+2*e)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+b(this.blur?this.blur/2:0,f)+'"></feGaussianBlur>\n\t<feOffset dx="'+b(k.x,f)+'" dy="'+b(k.y,f)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,
blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var a={},b=c.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(c){this[c]!==b[c]&&(a[c]=this[c])},this),a}}),void(c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))})("undefined"!=typeof exports?exports:this);
(function(){if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var d=fabric.util.object.extend,c=fabric.util.getElementOffset,b=fabric.util.removeFromArray,a=fabric.util.toFixed,e=Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,b){b||(b={});this._initStatic(a,b);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,
stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);this._initOptions(b);this._setImageSmoothing();this.interactive||this._initRetinaScaling();b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,
this.renderAll.bind(this));b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this));b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this));this.calcOffset()},_initRetinaScaling:function(){1!==fabric.devicePixelRatio&&this.enableRetinaScaling&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,
fabric.devicePixelRatio))},calcOffset:function(){return this._offset=c(this.lowerCanvasEl),this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();
return"undefined"!=typeof a.imageSmoothingEnabled?void(a.imageSmoothingEnabled=this.imageSmoothingEnabled):(a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,a.mozImageSmoothingEnabled=this.imageSmoothingEnabled,a.msImageSmoothingEnabled=this.imageSmoothingEnabled,void(a.oImageSmoothingEnabled=this.imageSmoothingEnabled))},__setBgOverlayImage:function(a,b,c,e){return"string"==typeof b?fabric.util.loadImage(b,function(b){this[a]=new fabric.Image(b,e);c&&c()},this,e&&e.crossOrigin):(e&&b.setOptions(e),
this[a]=b,c&&c()),this},__setBgOverlayColor:function(a,b,c){if(b&&b.source){var f=this;fabric.util.loadImage(b.source,function(e){f[a]=new fabric.Pattern({source:e,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY});c&&c()})}else this[a]=b,c&&c();return this},_createCanvasElement:function(){var a=fabric.document.createElement("canvas");if(a.style||(a.style={}),!a)throw e;return this._initCanvasElement(a),a},_initCanvasElement:function(a){if(fabric.util.createCanvasElement(a),"undefined"==typeof a.getContext)throw e;
},_initOptions:function(a){for(var b in a)this[b]=a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||
this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){b=b||{};for(var c in a){var f=
a[c];b.cssOnly||(this._setBackstoreDimension(c,a[c]),f+="px");b.backstoreOnly||this._setCssDimension(c,f)}return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),b.cssOnly||this.renderAll(),this},_setBackstoreDimension:function(a,b){return this.lowerCanvasEl[a]=b,this.upperCanvasEl&&(this.upperCanvasEl[a]=b),this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b),this[a]=b,this},_setCssDimension:function(a,b){return this.lowerCanvasEl.style[a]=b,this.upperCanvasEl&&(this.upperCanvasEl.style[a]=
b),this.wrapperEl&&(this.wrapperEl.style[a]=b),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){var b=this.getActiveGroup();this.viewportTransform=a;this.renderAll();a=0;for(var c=this._objects.length;c>a;a++)this._objects[a].setCoords();return b&&b.setCoords(),this},zoomToPoint:function(a,b){var c=a;a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=b;this.viewportTransform[3]=
b;var f=fabric.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=c.x-f.x;this.viewportTransform[5]+=c.y-f.y;this.renderAll();c=0;for(f=this._objects.length;f>c;c++)this._objects[c].setCoords();return this},setZoom:function(a){return this.zoomToPoint(new fabric.Point(0,0),a),this},absolutePan:function(a){this.viewportTransform[4]=-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var b=this._objects.length;b>a;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-
this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_onObjectAdded:function(a){this.stateful&&a.setupState();a._set("canvas",this);a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));
this.fire("object:removed",{target:a});a.fire("removed")},clearContext:function(a){return a.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},_chooseObjectsToRender:function(){var a=
this.getActiveGroup(),b=[],c=[];if(a&&!this.preserveObjectStacking){for(var e=0,d=this._objects.length;d>e;e++){var p=this._objects[e];a.contains(p)?c.push(p):b.push(p)}a._set("_objects",c)}else b=this._objects;return b},renderAll:function(){var a,b=this.contextContainer;return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),this.clearContext(b),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,b),this._renderBackground(b),b.save(),a=this._chooseObjectsToRender(),
b.transform.apply(b,this.viewportTransform),this._renderObjects(b,a),this.preserveObjectStacking||this._renderObjects(b,[this.getActiveGroup()]),b.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(b),this.clipTo&&b.restore(),this._renderOverlay(b),this.controlsAboveOverlay&&this.interactive&&this.drawControls(b),this.fire("after:render"),b.restore(),this},_renderObjects:function(a,b){for(var c=0,f=b.length;f>c;++c)b[c]&&b[c].render(a)},_renderBackgroundOrOverlay:function(a,
b){var c=this[b+"Color"];c&&(a.fillStyle=c.toLive?c.toLive(a):c,a.fillRect(c.offsetX||0,c.offsetY||0,this.width,this.height));(c=this[b+"Image"])&&c.render(a)},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},renderTop:function(){return this.clearContext(this.contextTop||this.contextContainer),this.selection&&this._groupSelector&&this._drawSelection(),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/
2,left:this.getWidth()/2}},centerObjectH:function(a){return this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(a){return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(a){var b=this.getCenter();return this._centerObject(a,new fabric.Point(b.left,b.top)),this.renderAll(),this},_centerObject:function(a,b){return a.setPositionByOrigin(b,"center",
"center"),this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,b){var c={objects:this._toObjects(a,b)};return d(c,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,c,b),c},_toObjects:function(a,b){return this.getObjects().map(function(c){return this._toObject(c,a,b)},this)},_toObject:function(a,b,
c){var f;this.includeDefaultValues||(f=a.includeDefaultValues,a.includeDefaultValues=!1);var e=this._realizeGroupTransformOnObject(a);b=a[b](c);return this.includeDefaultValues||(a.includeDefaultValues=f),this._unwindGroupTransformOnObject(a,e),b},_realizeGroupTransformOnObject:function(a){var b="angle flipX flipY height left scaleX scaleY top width".split(" ");if(a.group&&a.group===this.getActiveGroup()){var c={};return b.forEach(function(b){c[b]=a[b]}),this.getActiveGroup().realizeTransform(a),
c}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(a.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(a.overlayImage=this.overlayImage.toObject()),a},svgViewportTransformation:!0,
toSVG:function(a,b){a||(a={});var c=[];return this._setSVGPreamble(c,a),this._setSVGHeader(c,a),this._setSVGBgOverlayColor(c,"backgroundColor"),this._setSVGBgOverlayImage(c,"backgroundImage"),this._setSVGObjects(c,b),this._setSVGBgOverlayColor(c,"overlayColor"),this._setSVGBgOverlayImage(c,"overlayImage"),c.push("</svg>"),c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',
'"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(b,c){var f,e=c.width||this.width,d=c.height||this.height,g='viewBox="0 0 '+this.width+" "+this.height+'" ',n=fabric.Object.NUM_FRACTION_DIGITS;c.viewBox?g='viewBox="'+c.viewBox.x+" "+c.viewBox.y+" "+c.viewBox.width+" "+c.viewBox.height+'" ':this.svgViewportTransformation&&(f=this.viewportTransform,g='viewBox="'+a(-f[4]/f[0],n)+" "+a(-f[5]/f[3],n)+" "+a(this.width/f[0],n)+" "+a(this.height/f[3],n)+'" ');b.push("<svg ",
'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',e,'" ','height="',d,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,g,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(a,b){for(var c=0,f=this.getObjects(),
e=f.length;e>c;c++){var d=f[c],g=this._realizeGroupTransformOnObject(d);a.push(d.toSVG(b));this._unwindGroupTransformOnObject(d,g)}},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?
this[b].source.height:this.height,'" fill="url(#'+b+'Pattern)"',"></rect>\n"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>\n")},sendToBack:function(a){return b(this._objects,a),this._objects.unshift(a),this.renderAll&&this.renderAll()},bringToFront:function(a){return b(this._objects,a),this._objects.push(a),this.renderAll&&this.renderAll()},sendBackwards:function(a,c){var f=this._objects.indexOf(a);0!==f&&(f=
this._findNewLowerIndex(a,f,c),b(this._objects,a),this._objects.splice(f,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,b,c){if(c)for(c=b,--b;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b-1;return c},bringForward:function(a,c){var f=this._objects.indexOf(a);f!==this._objects.length-1&&(f=this._findNewUpperIndex(a,f,c),b(this._objects,a),this._objects.splice(f,
0,a),this.renderAll&&this.renderAll());return this},_findNewUpperIndex:function(a,b,c){if(c)for(c=b,b+=1;b<this._objects.length;++b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){c=b;break}}else c=b+1;return c},moveTo:function(a,c){return b(this._objects,a),this._objects.splice(c,0,a),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+
this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});d(fabric.StaticCanvas.prototype,fabric.Observable);d(fabric.StaticCanvas.prototype,fabric.Collection);d(fabric.StaticCanvas.prototype,fabric.DataURLExporter);d(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case "getImageData":return"undefined"!=typeof c.getImageData;
case "setLineDash":return"undefined"!=typeof c.setLineDash;case "toDataURL":return"undefined"!=typeof b.toDataURL;case "toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(l){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject})();
fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(d){return this.shadow=new fabric.Shadow(d),this},_setBrushStyles:function(){var d=this.canvas.contextTop;d.strokeStyle=this.color;d.lineWidth=this.width;d.lineCap=this.strokeLineCap;d.lineJoin=this.strokeLineJoin;this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&d.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var d=
this.canvas.contextTop;d.shadowColor=this.shadow.color;d.shadowBlur=this.shadow.blur;d.shadowOffsetX=this.shadow.offsetX;d.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var d=this.canvas.contextTop;d.shadowColor="";d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0}});
(function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(d){this.canvas=d;this._points=[]},onMouseDown:function(d){this._prepareForDrawing(d);this._captureDrawingPath(d);this._render()},onMouseMove:function(d){this._captureDrawingPath(d);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(d){d=new fabric.Point(d.x,d.y);this._reset();this._addPoint(d);this.canvas.contextTop.moveTo(d.x,
d.y)},_addPoint:function(d){this._points.push(d)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(d){d=new fabric.Point(d.x,d.y);this._addPoint(d)},_render:function(){var d=this.canvas.contextTop,c=this.canvas.viewportTransform,b=this._points[0],a=this._points[1];d.save();d.transform(c[0],c[1],c[2],c[3],c[4],c[5]);d.beginPath();2===this._points.length&&b.x===a.x&&b.y===a.y&&(b.x-=.5,a.x+=.5);d.moveTo(b.x,b.y);for(var c=1,e=this._points.length;e>
c;c++)a=b.midPointFrom(a),d.quadraticCurveTo(b.x,b.y,a.x,a.y),b=this._points[c],a=this._points[c+1];d.lineTo(b.x,b.y);d.stroke();d.restore()},convertPointsToSVGPath:function(d){var c=[],b=new fabric.Point(d[0].x,d[0].y),a=new fabric.Point(d[1].x,d[1].y);c.push("M ",d[0].x," ",d[0].y," ");for(var e=1,g=d.length;g>e;e++){var f=b.midPointFrom(a);c.push("Q ",b.x," ",b.y," ",f.x," ",f.y," ");b=new fabric.Point(d[e].x,d[e].y);e+1<d.length&&(a=new fabric.Point(d[e+1].x,d[e+1].y))}return c.push("L ",b.x,
" ",b.y," "),c},createPath:function(d){d=new fabric.Path(d,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,d.setShadow(this.shadow)),d},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var d=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===d)return void this.canvas.renderAll();
d=this.createPath(d);this.canvas.add(d);d.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:d})}})})();
fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(d){this.canvas=d;this.points=[]},drawDot:function(d){d=this.addPoint(d);var c=this.canvas.contextTop,b=this.canvas.viewportTransform;c.save();c.transform(b[0],b[1],b[2],b[3],b[4],b[5]);c.fillStyle=d.fill;c.beginPath();c.arc(d.x,d.y,d.radius,0,2*Math.PI,!1);c.closePath();c.fill();c.restore()},onMouseDown:function(d){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(d)},
onMouseMove:function(d){this.drawDot(d)},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var c=[],b=0,a=this.points.length;a>b;b++){var e=this.points[b],e=new fabric.Circle({radius:e.radius,left:e.x,top:e.y,originX:"center",originY:"center",fill:e.fill});this.shadow&&e.setShadow(this.shadow);c.push(e)}c=new fabric.Group(c,{originX:"center",originY:"center"});c.canvas=this.canvas;this.canvas.add(c);this.canvas.fire("path:created",{path:c});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},addPoint:function(d){d=new fabric.Point(d.x,d.y);var c=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,b=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return d.radius=c,d.fill=b,this.points.push(d),d}});
fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(d){this.canvas=d;this.sprayChunks=[]},onMouseDown:function(d){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(d);this.render()},onMouseMove:function(d){this.addSprayChunk(d);this.render()},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=
!1;for(var c=[],b=0,a=this.sprayChunks.length;a>b;b++)for(var e=this.sprayChunks[b],g=0,f=e.length;f>g;g++){var k=new fabric.Rect({width:e[g].width,height:e[g].width,left:e[g].x+1,top:e[g].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&k.setShadow(this.shadow);c.push(k)}this.optimizeOverlapping&&(c=this._getOptimizedRects(c));c=new fabric.Group(c,{originX:"center",originY:"center"});c.canvas=this.canvas;this.canvas.add(c);this.canvas.fire("path:created",{path:c});this.canvas.clearContext(this.canvas.contextTop);
this._resetShadow();this.canvas.renderOnAddRemove=d;this.canvas.renderAll()},_getOptimizedRects:function(d){for(var c,b={},a=0,e=d.length;e>a;a++)c=d[a].left+""+d[a].top,b[c]||(b[c]=d[a]);d=[];for(c in b)d.push(b[c]);return d},render:function(){var d=this.canvas.contextTop;d.fillStyle=this.color;var c=this.canvas.viewportTransform;d.save();d.transform(c[0],c[1],c[2],c[3],c[4],c[5]);for(var c=0,b=this.sprayChunkPoints.length;b>c;c++){var a=this.sprayChunkPoints[c];"undefined"!=typeof a.opacity&&(d.globalAlpha=
a.opacity);d.fillRect(a.x,a.y,a.width,a.width)}d.restore()},addSprayChunk:function(d){this.sprayChunkPoints=[];for(var c,b,a,e=this.width/2,g=0;g<this.density;g++)c=fabric.util.getRandomInt(d.x-e,d.x+e),b=fabric.util.getRandomInt(d.y-e,d.y+e),a=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,c=new fabric.Point(c,b),c.width=a,this.randomOpacity&&(c.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c);
this.sprayChunks.push(this.sprayChunkPoints)}});
fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var d=fabric.document.createElement("canvas"),c=d.getContext("2d");return d.width=d.height=25,c.fillStyle=this.color,c.beginPath(),c.arc(10,10,10,0,2*Math.PI,!1),c.closePath(),c.fill(),d},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(d){d=this.callSuper("createPath",d);return d.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),d}});
(function(){var d=fabric.util.getPointer,c=fabric.util.degreesToRadians,b=fabric.util.radiansToDegrees,a=Math.atan2,e=Math.abs;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={});this._initStatic(a,b);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",
selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this._initRetinaScaling();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);
this.calcOffset()},_resetCurrentTransform:function(){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,skewX:a.original.skewX,skewY:a.original.skewY,left:a.original.left,top:a.original.top});this._shouldCenterTransform(a.target)?"rotate"===a.action?this._setOriginToCenter(a.target):("center"!==a.originX&&("right"===a.originX?a.mouseXSign=-1:a.mouseXSign=1),"center"!==a.originY&&("bottom"===a.originY?a.mouseYSign=-1:a.mouseYSign=1),a.originX="center",a.originY=
"center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(a,b){var c=this.getPointer(a,!0),f=this._normalizePointer(b,c);return b.containsPoint(f)||b._findTargetCorner(c)},_normalizePointer:function(a,b){var c,f=this.getActiveGroup(),e=b.x,d=b.y;return f&&"group"!==a.type&&f.contains(a)&&(c=fabric.util.transformPoint(f.getCenterPoint(),this.viewportTransform,!0),e-=c.x,d-=c.y,e/=f.scaleX,d/=f.scaleY),{x:e,y:d}},isTargetTransparent:function(a,b,c){var f=a.hasBorders,
e=a.transparentCorners;a.hasBorders=a.transparentCorners=!1;a.render(this.contextCache);a._renderControls(this.contextCache);a.hasBorders=f;a.transparentCorners=e;a=fabric.util.isTransparent(this.contextCache,b,c,this.targetFindTolerance);return this.clearContext(this.contextCache),a},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),f=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey||b&&!b.evented||b&&!b.selectable&&f&&f!==b},_shouldCenterTransform:function(a){if(a){var b,
c=this._currentTransform;return"scale"===c.action||"scaleX"===c.action||"scaleY"===c.action?b=this.centeredScaling||a.centeredScaling:"rotate"===c.action&&(b=this.centeredRotation||a.centeredRotation),b?!c.altKey:c.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};return"ml"===b||"tl"===b||"bl"===b?c.x="right":("mr"===b||"tr"===b||"br"===b)&&(c.x="left"),"tl"===b||"mt"===b||"tr"===b?c.y="bottom":("bl"===b||"mb"===b||"br"===b)&&(c.y="top"),c},_getActionFromCorner:function(a,
b,c){if(!b)return"drag";switch(b){case "mtr":return"rotate";case "ml":case "mr":return c.shiftKey?"skewY":"scaleX";case "mt":case "mb":return c.shiftKey?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(a,b){if(b){var f=this.getPointer(a),e=b._findTargetCorner(this.getPointer(a,!0)),d=this._getActionFromCorner(b,e,a),k=this._getOriginFromCorner(b,e);this._currentTransform={target:b,action:d,corner:e,scaleX:b.scaleX,scaleY:b.scaleY,skewX:b.skewX,skewY:b.skewY,offsetX:f.x-b.left,
offsetY:f.y-b.top,originX:k.x,originY:k.y,ex:f.x,ey:f.y,lastX:f.x,lastY:f.y,left:b.left,top:b.top,theta:c(b.angle),width:b.width*b.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:a.shiftKey,altKey:a.altKey};this._currentTransform.original={left:b.left,top:b.top,scaleX:b.scaleX,scaleY:b.scaleY,skewX:b.skewX,skewY:b.skewY,originX:k.x,originY:k.y};this._resetCurrentTransform()}},_translateObject:function(a,b){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",a-this._currentTransform.offsetX);
c.get("lockMovementY")||c.set("top",b-this._currentTransform.offsetY)},_changeSkewTransformOrigin:function(a,b,c){var f="originX",e={0:"center"},d=b.target.skewX,k="left",g="right",l="mt"===b.corner||"ml"===b.corner?1:-1,C=1;a=0<a?1:-1;"y"===c&&(d=b.target.skewY,k="top",g="bottom",f="originY");e[-1]=k;e[1]=g;b.target.flipX&&(C*=-1);b.target.flipY&&(C*=-1);0===d?(b.skewSign=-l*a*C,b[f]=e[-a]):(d=0<d?1:-1,b.skewSign=d,b[f]=e[d*l*C])},_skewObject:function(a,b,c){var f=this._currentTransform,e=f.target,
d=e.get("lockSkewingX"),k=e.get("lockSkewingY");if(!(d&&"x"===c||k&&"y"===c)){var k=e.getCenterPoint();var g=e.toLocalPoint(new fabric.Point(a,b),"center","center")[c];var l=e.toLocalPoint(new fabric.Point(f.lastX,f.lastY),"center","center")[c],d=e._getTransformedDimensions();this._changeSkewTransformOrigin(g-l,f,c);g=e.toLocalPoint(new fabric.Point(a,b),f.originX,f.originY)[c];k=e.translateToOriginPoint(k,f.originX,f.originY);this._setObjectSkew(g,f,c,d);f.lastX=a;f.lastY=b;e.setPositionByOrigin(k,
f.originX,f.originY)}},_setObjectSkew:function(a,b,c,e){var f,d,k,g,m,l,B,v=b.target;b=b.skewSign;"x"===c?(g="y",m="Y",l="X",k=0,B=v.skewY):(g="x",m="X",l="Y",k=v.skewX,B=0);k=v._getTransformedDimensions(k,B);a=2*Math.abs(a)-k[c];2>=a?f=0:(f=b*Math.atan(a/v["scale"+l]/(k[g]/v["scale"+m])),f=fabric.util.radiansToDegrees(f));v.set("skew"+l,f);0!==v["skew"+m]&&(d=v._getTransformedDimensions(),f=e[g]/d[g]*v["scale"+m],v.set("scale"+m,f))},_scaleObject:function(a,b,c){var f=this._currentTransform,e=f.target,
d=e.get("lockScalingX"),k=e.get("lockScalingY"),g=e.get("lockScalingFlip");if(!d||!k){var l=e.translateToOriginPoint(e.getCenterPoint(),f.originX,f.originY);a=e.toLocalPoint(new fabric.Point(a,b),f.originX,f.originY);b=e._getTransformedDimensions();this._setLocalMouse(a,f);this._setObjectScale(a,f,d,k,c,g,b);e.setPositionByOrigin(l,f.originX,f.originY)}},_setObjectScale:function(a,b,c,e,d,g,q){var f=b.target,k=!1,m=!1;b.newScaleX=a.x*f.scaleX/q.x;b.newScaleY=a.y*f.scaleY/q.y;g&&0>=b.newScaleX&&b.newScaleX<
f.scaleX&&(k=!0);g&&0>=b.newScaleY&&b.newScaleY<f.scaleY&&(m=!0);"equally"!==d||c||e?d?"x"!==d||f.get("lockUniScaling")?"y"!==d||f.get("lockUniScaling")||m||e||f.set("scaleY",b.newScaleY):k||c||f.set("scaleX",b.newScaleX):(k||c||f.set("scaleX",b.newScaleX),m||e||f.set("scaleY",b.newScaleY)):k||m||this._scaleObjectEqually(a,f,b,q);k||m||this._flipObject(b,d)},_scaleObjectEqually:function(a,b,c,e){a=a.y+a.x;e=e.y*c.original.scaleY/b.scaleY+e.x*c.original.scaleX/b.scaleX;c.newScaleX=c.original.scaleX*
a/e;c.newScaleY=c.original.scaleY*a/e;b.set("scaleX",c.newScaleX);b.set("scaleY",c.newScaleY)},_flipObject:function(a,b){0>a.newScaleX&&"y"!==b&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left"));0>a.newScaleY&&"x"!==b&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,b){var c=b.target;"right"===b.originX?a.x*=-1:"center"===b.originX&&(a.x=2*a.x*b.mouseXSign,0>a.x&&(b.mouseXSign=-b.mouseXSign));"bottom"===b.originY?
a.y*=-1:"center"===b.originY&&(a.y=2*a.y*b.mouseYSign,0>a.y&&(b.mouseYSign=-b.mouseYSign));e(a.x)>c.padding?0>a.x?a.x+=c.padding:a.x-=c.padding:a.x=0;e(a.y)>c.padding?0>a.y?a.y+=c.padding:a.y-=c.padding:a.y=0},_rotateObject:function(c,e){var f=this._currentTransform;if(!f.target.get("lockRotation")){var d=a(f.ey-f.top,f.ex-f.left),k=a(e-f.top,c-f.left),d=b(k-d+f.theta);0>d&&(d=360+d);f.target.angle=d%360}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=
1;a.scaleY=1;a.skewX=0;a.skewY=0;a.setAngle(0)},_drawSelection:function(){var a=this.contextTop,b=this._groupSelector,c=b.left,d=b.top,g=e(c),n=e(d);(a.fillStyle=this.selectionColor,a.fillRect(b.ex-(0<c?0:-c),b.ey-(0<d?0:-d),g,n),a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,1<this.selectionDashArray.length)?(c=b.ex+.5-(0<c?0:g),b=b.ey+.5-(0<d?0:n),a.beginPath(),fabric.util.drawDashedLine(a,c,b,c+g,b,this.selectionDashArray),fabric.util.drawDashedLine(a,c,b+n-1,c+g,b+
n-1,this.selectionDashArray),fabric.util.drawDashedLine(a,c,b,c,b+n,this.selectionDashArray),fabric.util.drawDashedLine(a,c+g-1,b,c+g-1,b+n,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(b.ex+.5-(0<c?0:g),b.ey+.5-(0<d?0:n),g,n)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,
!0))},findTarget:function(a,b){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!b&&this.containsPoint(a,c))return c;c=this._searchPossibleTargets(a,b);return this._fireOverOutEvents(c,a),c}},_fireOverOutEvents:function(a,b){a?this._hoveredTarget!==a&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:b}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:a,e:b}),
a.fire("mouseover"),this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:b}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(a,b)&&(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing||!this.isTargetTransparent(b,c.x,c.y)))return!0},_searchPossibleTargets:function(a,b){for(var c,e=this.getPointer(a,!0),f=this._objects.length;f--;)if((!this._objects[f].group||
b)&&this._checkTarget(a,this._objects[f],e)){this.relatedTarget=this._objects[f];c=this._objects[f];break}return c},getPointer:function(a,b,c){c||(c=this.upperCanvasEl);var e;a=d(a);var f=c.getBoundingClientRect(),g=f.width||0,k=f.height||0;return g&&k||("top"in f&&"bottom"in f&&(k=Math.abs(f.top-f.bottom)),"right"in f&&"left"in f&&(g=Math.abs(f.right-f.left))),this.calcOffset(),a.x-=this._offset.left,a.y-=this._offset.top,b||(a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform))),
e=0===g||0===k?{width:1,height:1}:{width:c.width/g,height:c.height/k},{x:a.x*e.width,y:a.y*e.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},
_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},
_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0});a.width=b;a.height=c;fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=
a;a.set("active",!0)},setActiveObject:function(a,b){return this._setActiveObject(a),this.renderAll(),this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:a}),this},_setActiveGroup:function(a){(this._activeGroup=
a)&&a.set("active",!0)},setActiveGroup:function(a,b){return this._setActiveGroup(a),a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){return this._discardActiveGroup(),this.fire("selection:cleared",{e:a}),this},deactivateAll:function(){for(var a=this.getObjects(),b=0,c=a.length;c>b;b++)a[b].set("active",
!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup()||this.getActiveObject();return b&&this.fire("before:selection:cleared",{target:b,e:a}),this.deactivateAll(),b&&this.fire("selection:cleared",{e:a}),this},drawControls:function(a){var b=this.getActiveGroup();b?b._renderControls(a):this._drawObjectsControls(a)},_drawObjectsControls:function(a){for(var b=0,c=this._objects.length;c>b;++b)this._objects[b]&&this._objects[b].active&&
(this._objects[b]._renderControls(a),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[b])}});for(var g in fabric.StaticCanvas)"prototype"!==g&&(fabric.Canvas[g]=fabric.StaticCanvas[g]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas})();
(function(){var d={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=fabric.util.addListener,b=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();c(fabric.window,"resize",this._onResize);c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"mousewheel",this._onMouseWheel);
c(this.upperCanvasEl,"touchstart",this._onMouseDown);c(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);
this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){b(fabric.window,"resize",this._onResize);b(this.upperCanvasEl,"mousedown",
this._onMouseDown);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"mousewheel",this._onMouseWheel);b(this.upperCanvasEl,"touchstart",this._onMouseDown);b(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,
"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&
this.__onLongPress(a,b)},_onMouseDown:function(a){this.__onMouseDown(a);c(fabric.document,"touchend",this._onMouseUp);c(fabric.document,"touchmove",this._onMouseMove);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"touchmove",this._onMouseMove);"touchstart"===a.type?b(this.upperCanvasEl,"mousedown",this._onMouseDown):(c(fabric.document,"mouseup",this._onMouseUp),c(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(a){if(this.__onMouseUp(a),b(fabric.document,
"mouseup",this._onMouseUp),b(fabric.document,"touchend",this._onMouseUp),b(fabric.document,"mousemove",this._onMouseMove),b(fabric.document,"touchmove",this._onMouseMove),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===a.type){var e=this;setTimeout(function(){c(e.upperCanvasEl,"mousedown",e._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},
_shouldRender:function(a,b){var c=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==c)||!a&&c||!a&&!c&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){var b;if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(a);this._currentTransform?(this._finalizeCurrentTransform(),b=this._currentTransform.target):b=this.findTarget(a,!0);var c=this._shouldRender(b,
this.getPointer(a));this._maybeGroupObjects(a);b&&(b.isMoving=!1);c&&this.renderAll();this._handleCursorAndEvent(a,b)},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var c=this;setTimeout(function(){c._setCursorFromEvent(a,b)},50);this.fire("mouse:up",{target:b,e:a});b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=this._currentTransform.target;a._scaling&&(a._scaling=!1);a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),
a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&fabric.util.clipContext(this,
this.contextTop);var b=fabric.util.invertTransform(this.viewportTransform),b=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseDown(b);this.fire("mouse:down",{e:a});b=this.findTarget(a);"undefined"!=typeof b&&b.fire("mousedown",{e:a,target:b})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=fabric.util.invertTransform(this.viewportTransform),b=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseMove(b)}this.setCursor(this.freeDrawingCursor);
this.fire("mouse:move",{e:a});b=this.findTarget(a);"undefined"!=typeof b&&b.fire("mousemove",{e:a,target:b})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a});var b=this.findTarget(a);"undefined"!=typeof b&&b.fire("mouseup",{e:a,target:b})},__onMouseDown:function(a){if(("which"in a?1===a.which:0===a.button)||fabric.isTouchSupported){if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(a);
if(!this._currentTransform){var b=this.findTarget(a),c=this.getPointer(a,!0);this._previousPointer=c;var f=this._shouldRender(b,c),d=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this._clearSelection(a,b,c):d&&(this._handleGrouping(a,b),b=this.getActiveGroup());b&&b.selectable&&(b.__corner||!d)&&(this._beforeTransform(a,b),this._setupCurrentTransform(a,b));f&&this.renderAll();this.fire("mouse:down",{target:b,e:a});b&&b.fire("mousedown",{e:a})}}},_beforeTransform:function(a,b){this.stateful&&
b.saveState();b._findTargetCorner(this.getPointer(a))&&this.onBeforeScaleRotate(b);b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a))},_clearSelection:function(a,b,c){this.deactivateAllWithDispatch(a);b&&b.selectable?this.setActiveObject(b,a):this.selection&&(this._groupSelector={ex:c.x,ey:c.y,top:0,left:0})},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;
var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null},__onMouseMove:function(a){var b,c;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(a);
if(!("undefined"!=typeof a.touches&&1<a.touches.length)){var f=this._groupSelector;f?(c=this.getPointer(a,!0),f.left=c.x-f.ex,f.top=c.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),!b||b&&!b.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,b));this.fire("mouse:move",{target:b,e:a});b&&b.fire("mousemove",{e:a})}},_transformObject:function(a){var b=this.getPointer(a),c=this._currentTransform;c.reset=!1;c.target.isMoving=!0;this._beforeScaleTransform(a,
c);this._performTransformAction(a,c,b);this.renderAll()},_performTransformAction:function(a,b,c){var f=c.x;c=c.y;var e=b.target,d=b.action;"rotate"===d?(this._rotateObject(f,c),this._fire("rotating",e,a)):"scale"===d?(this._onScale(a,b,f,c),this._fire("scaling",e,a)):"scaleX"===d?(this._scaleObject(f,c,"x"),this._fire("scaling",e,a)):"scaleY"===d?(this._scaleObject(f,c,"y"),this._fire("scaling",e,a)):"skewX"===d?(this._skewObject(f,c,"x"),this._fire("skewing",e,a)):"skewY"===d?(this._skewObject(f,
c,"y"),this._fire("skewing",e,a)):(this._translateObject(f,c),this._fire("moving",e,a),this.setCursor(this.moveCursor))},_fire:function(a,b,c){this.fire("object:"+a,{target:b,e:c});b.fire(a,{e:c})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var c=this._shouldCenterTransform(b.target);(c&&("center"!==b.originX||"center"!==b.originY)||!c&&"center"===b.originX&&"center"===b.originY)&&(this._resetCurrentTransform(),b.reset=!0)}},_onScale:function(a,
b,c,f){!a.shiftKey&&!this.uniScaleTransform||b.target.get("lockUniScaling")?(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(),b.currentAction="scaleEqually",this._scaleObject(c,f,"equally")):(b.currentAction="scale",this._scaleObject(c,f))},_setCursorFromEvent:function(a,b){if(!b||!b.selectable)return this.setCursor(this.defaultCursor),!1;var c=this.getActiveGroup(),c=b._findTargetCorner&&(!c||!c.contains(b))&&b._findTargetCorner(this.getPointer(a,!0));return c?this._setCornerCursor(c,
b,a):this.setCursor(b.hoverCursor||this.hoverCursor),!0},_setCornerCursor:function(a,b,c){if(a in d)this.setCursor(this._getRotatedCornerCursor(a,b,c));else{if("mtr"!==a||!b.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(a,b,c){b=Math.round(b.getAngle()%360/45);return 0>b&&(b+=8),b+=d[a],c.shiftKey&&0===d[a]%2&&(b+=2),b%=8,this.cursorMap[b]}})})();
(function(){var d=Math.min,c=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(b,a){var c=this.getActiveObject();return b.shiftKey&&a&&a.selectable&&(this.getActiveGroup()||c&&c!==a)&&this.selection},_handleGrouping:function(b,a){(a!==this.getActiveGroup()||(a=this.findTarget(b,!0),a&&!a.isType("group")))&&(this.getActiveGroup()?this._updateActiveGroup(a,b):this._createActiveGroup(a,b),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(b,
a){var c=this.getActiveGroup();if(c.contains(b)){if(c.removeWithUpdate(b),b.set("active",!1),1===c.size())return this.discardActiveGroup(a),void this.setActiveObject(c.item(0))}else c.addWithUpdate(b);this.fire("selection:created",{target:c,e:a});c.set("active",!0)},_createActiveGroup:function(b,a){if(this._activeObject&&b!==this._activeObject){var c=this._createGroup(b);c.addWithUpdate();this.setActiveGroup(c);this._activeObject=null;this.fire("selection:created",{target:c,e:a})}b.set("active",!0)},
_createGroup:function(b){var a=this.getObjects();b=a.indexOf(this._activeObject)<a.indexOf(b)?[this._activeObject,b]:[b,this._activeObject];return new fabric.Group(b,{canvas:this})},_groupSelectedObjects:function(b){var a=this._collectObjects();1===a.length?this.setActiveObject(a[0],b):1<a.length&&(a=new fabric.Group(a.reverse(),{canvas:this}),a.addWithUpdate(),this.setActiveGroup(a,b),a.saveCoords(),this.fire("selection:created",{target:a}),this.renderAll())},_collectObjects:function(){for(var b,
a=[],e=this._groupSelector.ex,g=this._groupSelector.ey,f=e+this._groupSelector.left,k=g+this._groupSelector.top,l=new fabric.Point(d(e,f),d(g,k)),m=new fabric.Point(c(e,f),c(g,k)),e=e===f&&g===k,g=this._objects.length;g--&&(b=this._objects[g],!(b&&b.selectable&&b.visible&&(b.intersectsWithRect(l,m)||b.isContainedWithinRect(l,m)||b.containsPoint(l)||b.containsPoint(m))&&(b.set("active",!0),a.push(b),e))););return a},_maybeGroupObjects:function(b){this.selection&&this._groupSelector&&this._groupSelectedObjects(b);
(b=this.getActiveGroup())&&(b.setObjectsCoords().setCoords(),b.isMoving=!1,this.setCursor(this.defaultCursor));this._currentTransform=this._groupSelector=null}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(d){d||(d={});var c=d.format||"png",b=d.quality||1,a=d.multiplier||1;d={left:d.left,top:d.top,width:d.width,height:d.height};return 1!==a?this.__toDataURLWithMultiplier(c,b,d,a):this.__toDataURL(c,b,d)},__toDataURL:function(d,c,b){this.renderAll();var a=this.lowerCanvasEl;b=this.__getCroppedCanvas(a,b);"jpg"===d&&(d="jpeg");return fabric.StaticCanvas.supports("toDataURLWithQuality")?(b||a).toDataURL("image/"+d,c):(b||a).toDataURL("image/"+
d)},__getCroppedCanvas:function(d,c){var b,a;return("left"in c||"top"in c||"width"in c||"height"in c)&&(b=fabric.util.createCanvasElement(),a=b.getContext("2d"),b.width=c.width||this.width,b.height=c.height||this.height,a.drawImage(d,-c.left||0,-c.top||0)),b},__toDataURLWithMultiplier:function(d,c,b,a){var e=this.getWidth(),g=this.getHeight(),f=e*a,k=g*a,l=this.getActiveObject(),m=this.getActiveGroup(),p=this.contextContainer;1<a&&this.setWidth(f).setHeight(k);p.scale(a,a);b.left&&(b.left*=a);b.top&&
(b.top*=a);b.width?b.width*=a:1>a&&(b.width=f);b.height?b.height*=a:1>a&&(b.height=k);m?this._tempRemoveBordersControlsFromGroup(m):l&&this.deactivateAll&&this.deactivateAll();d=this.__toDataURL(d,c,b);return this.width=e,this.height=g,p.scale(1/a,1/a),this.setWidth(e).setHeight(g),m?this._restoreBordersControlsOnGroup(m):l&&this.setActiveObject&&this.setActiveObject(l),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),d},toDataURLWithMultiplier:function(d,c,b){return this.toDataURL({format:d,
multiplier:c,quality:b})},_tempRemoveBordersControlsFromGroup:function(d){d.origHasControls=d.hasControls;d.origBorderColor=d.borderColor;d.hasControls=!0;d.borderColor="rgba(0,0,0,0)";d.forEachObject(function(c){c.origBorderColor=c.borderColor;c.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(d){d.hideControls=d.origHideControls;d.borderColor=d.origBorderColor;d.forEachObject(function(c){c.borderColor=c.origBorderColor;delete c.origBorderColor})}});
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(d,c,b){return this.loadFromJSON(d,c,b)},loadFromJSON:function(d,c,b){if(d){var a="string"==typeof d?JSON.parse(d):d;this.clear();var e=this;return this._enlivenObjects(a.objects,function(){e._setBgOverlay(a,c)},b),this}},_setBgOverlay:function(d,c){var b=this,a={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(d.backgroundImage||d.overlayImage||d.background||d.overlay))return void(c&&
c());var e=function(){a.backgroundImage&&a.overlayImage&&a.backgroundColor&&a.overlayColor&&(b.renderAll(),c&&c())};this.__setBgOverlay("backgroundImage",d.backgroundImage,a,e);this.__setBgOverlay("overlayImage",d.overlayImage,a,e);this.__setBgOverlay("backgroundColor",d.background,a,e);this.__setBgOverlay("overlayColor",d.overlay,a,e);e()},__setBgOverlay:function(d,c,b,a){var e=this;return c?void("backgroundImage"===d||"overlayImage"===d?fabric.Image.fromObject(c,function(c){e[d]=c;b[d]=!0;a&&a()}):
this["set"+fabric.util.string.capitalize(d,!0)](c,function(){b[d]=!0;a&&a()})):void(b[d]=!0)},_enlivenObjects:function(d,c,b){var a=this;if(!d||0===d.length)return void(c&&c());var e=this.renderOnAddRemove;this.renderOnAddRemove=!1;fabric.util.enlivenObjects(d,function(b){b.forEach(function(b,c){a.insertAt(b,c,!0)});a.renderOnAddRemove=e;c&&c()},null,b)},_toDataURL:function(d,c){this.clone(function(b){c(b.toDataURL(d))})},_toDataURLWithMultiplier:function(d,c,b){this.clone(function(a){b(a.toDataURLWithMultiplier(d,
c))})},clone:function(d,c){var b=JSON.stringify(this.toJSON(c));this.cloneWithoutData(function(a){a.loadFromJSON(b,function(){d&&d(a)})})},cloneWithoutData:function(d){var c=fabric.document.createElement("canvas");c.width=this.getWidth();c.height=this.getHeight();var b=new fabric.Canvas(c);b.clipTo=this.clipTo;this.backgroundImage?(b.setBackgroundImage(this.backgroundImage.src,function(){b.renderAll();d&&d(b)}),b.backgroundImageOpacity=this.backgroundImageOpacity,b.backgroundImageStretch=this.backgroundImageStretch):
d&&d(b)}});
(function(d){var c=d.fabric||(d.fabric={});d=c.util.object.extend;var b=c.util.toFixed,a=c.util.string.capitalize,e=c.util.degreesToRadians,g=c.StaticCanvas.supports("setLineDash");c.Object||(c.Object=c.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,
centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,
lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor alignX alignY meetOrSlice skewX skewY".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||
!a.fill.colorStops||a.fill instanceof c.Gradient||this.set("fill",new c.Gradient(a.fill));!a.stroke||!a.stroke.colorStops||a.stroke instanceof c.Gradient||this.set("stroke",new c.Gradient(a.stroke))},_initPattern:function(a){!a.fill||!a.fill.source||a.fill instanceof c.Pattern||this.set("fill",new c.Pattern(a.fill));!a.stroke||!a.stroke.source||a.stroke instanceof c.Pattern||this.set("stroke",new c.Pattern(a.stroke))},_initClipping:function(a){a.clipTo&&"string"==typeof a.clipTo&&(a=c.util.getFunctionBody(a.clipTo),
"undefined"!=typeof a&&(this.clipTo=new Function("ctx",a)))},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(a,b){this.group&&this.canvas.preserveObjectStacking&&this.group===this.canvas._activeGroup&&this.group.transform(a);var c=b?this._getLeftTopCoords():this.getCenterPoint();a.translate(c.x,c.y);a.rotate(e(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1));a.transform(1,0,
Math.tan(e(this.skewX)),1,0,0);a.transform(1,Math.tan(e(this.skewY)),0,1,0,0)},toObject:function(a){var f=c.Object.NUM_FRACTION_DIGITS,f={type:this.type,originX:this.originX,originY:this.originY,left:b(this.left,f),top:b(this.top,f),width:b(this.width,f),height:b(this.height,f),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:b(this.strokeWidth,f),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():
this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:b(this.strokeMiterLimit,f),scaleX:b(this.scaleX,f),scaleY:b(this.scaleY,f),angle:b(this.getAngle(),f),flipX:this.flipX,flipY:this.flipY,opacity:b(this.opacity,f),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,
transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:b(this.skewX,f),skewY:b(this.skewY,f)};return this.includeDefaultValues||(f=this._removeDefaultValues(f)),c.util.populateWithProperties(this,f,a),f},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var b=c.util.getKlass(a.type).prototype;return b.stateProperties.forEach(function(c){a[c]===b[c]&&delete a[c];"[object Array]"===Object.prototype.toString.call(a[c])&&"[object Array]"===
Object.prototype.toString.call(b[c])&&0===a[c].length&&0===b[c].length&&delete a[c]}),a},toString:function(){return"#<fabric."+a(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){return"object"==typeof a?this._setObject(a):"function"==typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b),this},_set:function(a,e){return("scaleX"===a||"scaleY"===a)&&(e=this._constrainScale(e)),"scaleX"===a&&0>e?(this.flipX=!this.flipX,
e*=-1):"scaleY"===a&&0>e?(this.flipY=!this.flipY,e*=-1):"width"===a||"height"===a?this.minScaleLimit=b(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==a||!e||e instanceof c.Shadow||(e=new c.Shadow(e)),this[a]=e,this},setOnGroup:function(){},toggle:function(a){var b=this.get(a);return"boolean"==typeof b&&this.set(a,!b),this},setSourcePath:function(a){return this.sourcePath=a,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:
[1,0,0,1,0,0]},render:function(a,b){0===this.width&&0===this.height||!this.visible||(a.save(),this._setupCompositeOperation(a),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this._setOpacity(a),this._setShadow(a),this.clipTo&&c.util.clipContext(this,a),this._render(a,b),this.clipTo&&a.restore(),a.restore())},_setOpacity:function(a){this.group&&this.group._setOpacity(a);a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){this.stroke&&
(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill)},_renderControls:function(a,b){if(this.active&&!b){var f=this.getViewportTransform();var d=this.calcTransformMatrix(),d=c.util.multiplyTransformMatrices(f,d);f=c.util.qrDecompose(d);a.save();a.translate(f.translateX,
f.translateY);this.group&&this.group===this.canvas.getActiveGroup()?(a.rotate(e(f.angle)),this.drawBordersInGroup(a,f)):(a.rotate(e(this.angle)),this.drawBorders(a));this.drawControls(a);a.restore()}},_setShadow:function(a){if(this.shadow){var b=this.canvas&&this.canvas.viewportTransform[0]||1,c=this.canvas&&this.canvas.viewportTransform[3]||1;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*(b+c)*(this.scaleX+this.scaleY)/4;a.shadowOffsetX=this.shadow.offsetX*b*this.scaleX;a.shadowOffsetY=
this.shadow.offsetY*c*this.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){this.fill&&((a.save(),this.fill.gradientTransform)&&a.transform.apply(a,this.fill.gradientTransform),this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore())},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&((this.shadow&&
!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this.strokeDashArray)?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):(this.stroke.gradientTransform&&a.transform.apply(a,this.stroke.gradientTransform),this._stroke?this._stroke(a):a.stroke()),a.restore())},clone:function(a,b){return this.constructor.fromObject?
this.constructor.fromObject(this.toObject(b),a):new c.Object(this.toObject(b))},cloneAsImage:function(a){var b=this.toDataURL();return c.util.loadImage(b,function(b){a&&a(new c.Image(b))}),this},toDataURL:function(a){a||(a={});var b=c.util.createCanvasElement(),e=this.getBoundingRect();b.width=e.width;b.height=e.height;c.util.wrapElement(b,"div");e=new c.StaticCanvas(b);"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(e.backgroundColor="#fff");var f={active:this.get("active"),left:this.getLeft(),
top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new c.Point(b.width/2,b.height/2),"center","center");b=this.canvas;e.add(this);a=e.toDataURL(a);return this.set(f).setCoords(),this.canvas=b,e.dispose(),a},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,b){b||(b={});var e={colorStops:[]};e.type=b.type||(b.r1||b.r2?"radial":"linear");e.coords={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2};(b.r1||b.r2)&&(e.coords.r1=
b.r1,e.coords.r2=b.r2);b.gradientTransform&&(e.gradientTransform=b.gradientTransform);for(var f in b.colorStops){var d=new c.Color(b.colorStops[f]);e.colorStops.push({offset:f,color:d.toRgb(),opacity:d.getAlpha()})}return this.set(a,c.Gradient.forObject(this,e))},setPatternFill:function(a){return this.set("fill",new c.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new c.Shadow(a):null)},setColor:function(a){return this.set("fill",a),this},setAngle:function(a){var b=("center"!==this.originX||
"center"!==this.originY)&&this.centeredRotation;return b&&this._setOriginToCenter(),this.set("angle",a),b&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);var e=new c.Point(b.x,b.y),f=this._getLeftTopCoords();return this.angle&&
(e=c.util.rotatePoint(e,f,c.util.degreesToRadians(-this.angle))),{x:e.x-f.x,y:e.y-f.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}}),c.util.createAccessors(c.Object),c.Object.prototype.rotate=c.Object.prototype.setAngle,d(c.Object.prototype,c.Observable),c.Object.NUM_FRACTION_DIGITS=2,c.Object.__uid=0)})("undefined"!=typeof exports?exports:this);
(function(){var d=fabric.util.degreesToRadians,c={left:-.5,center:0,right:.5},b={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(a,e,d,f,k){var g,m=a.x,p=a.y;e=c[f]-c[e];d=b[k]-b[d];return(e||d)&&(g=this._getTransformedDimensions(),m=a.x+e*g.x,p=a.y+d*g.y),new fabric.Point(m,p)},translateToCenterPoint:function(a,b,c){b=this.translateToGivenOrigin(a,b,c,"center","center");return this.angle?fabric.util.rotatePoint(b,a,d(this.angle)):b},
translateToOriginPoint:function(a,b,c){b=this.translateToGivenOrigin(a,"center","center",b,c);return this.angle?fabric.util.rotatePoint(b,a,d(this.angle)):b},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,b){var c=this.getCenterPoint();return this.translateToOriginPoint(c,a,b)},toLocalPoint:function(a,b,c){var e,g,l=this.getCenterPoint();return e=b&&c?this.translateToGivenOrigin(l,"center",
"center",b,c):new fabric.Point(this.left,this.top),g=new fabric.Point(a.x,a.y),this.angle&&(g=fabric.util.rotatePoint(g,l,-d(this.angle))),g.subtractEquals(e)},setPositionByOrigin:function(a,b,c){a=this.translateToCenterPoint(a,b,c);a=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(a){var b=d(this.angle),g=this.getWidth(),f=Math.sin(b)*g;this.left+=Math.cos(b)*g*(c[a]-c[this.originX]);this.top+=f*(c[a]-c[this.originX]);this.setCoords();
this.originX=a},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originY=this.originX="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),
"left","top")}})})();
(function(){function d(a){return[new fabric.Point(a.tl.x,a.tl.y),new fabric.Point(a.tr.x,a.tr.y),new fabric.Point(a.br.x,a.br.y),new fabric.Point(a.bl.x,a.bl.y)]}var c=fabric.util.degreesToRadians,b=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(a,b){var c=d(this.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(c,a,b).status},intersectsWithObject:function(a){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(d(this.oCoords),
d(a.oCoords)).status},isContainedWithinObject:function(a){var b=a.getBoundingRect();a=new fabric.Point(b.left,b.top);b=new fabric.Point(b.left+b.width,b.top+b.height);return this.isContainedWithinRect(a,b)},isContainedWithinRect:function(a,b){var c=this.getBoundingRect();return c.left>=a.x&&c.left+c.width<=b.x&&c.top>=a.y&&c.top+c.height<=b.y},containsPoint:function(a){var b=this._getImageLines(this.oCoords);a=this._findCrossPoints(a,b);return 0!==a&&1===a%2},_getImageLines:function(a){return{topline:{o:a.tl,
d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,b){var c,e,d,l,m,p=0,n;for(n in b)if(m=b[n],!(m.o.y<a.y&&m.d.y<a.y||m.o.y>=a.y&&m.d.y>=a.y||(m.o.x===m.d.x&&m.o.x>=a.x?l=m.o.x:(c=(m.d.y-m.o.y)/(m.d.x-m.o.x),e=a.y-0*a.x,d=m.o.y-c*m.o.x,l=-(e-d)/(0-c)),l>=a.x&&(p+=1),2!==p)))break;return p},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){return this.oCoords||
this.setCoords(),fabric.util.makeBoundingBoxFromPoints([this.oCoords.tl,this.oCoords.tr,this.oCoords.br,this.oCoords.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){return a=this._constrainScale(a),0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1),this.scaleX=a,this.scaleY=a,this.setCoords(),
this},scaleToWidth:function(a){var b=this.getBoundingRect().width/this.getWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a){var b=this.getBoundingRect().height/this.getHeight();return this.scale(a/this.height/b)},setCoords:function(){var a=c(this.angle),b=this.getViewportTransform(),d=this._calculateCurrentDimensions(),f=d.x,k=d.y;0>f&&(f=Math.abs(f));var d=Math.sin(a),l=Math.cos(a),m=0<f?Math.atan(k/f):0,p=f/Math.cos(m)/2,n=Math.cos(m+a)*p,a=Math.sin(m+a)*p,m=fabric.util.transformPoint(this.getCenterPoint(),
b),b=new fabric.Point(m.x-n,m.y-a),f=new fabric.Point(b.x+f*l,b.y+f*d),k=new fabric.Point(b.x-k*d,b.y+k*l),n=new fabric.Point(m.x+n,m.y+a),a=new fabric.Point((b.x+k.x)/2,(b.y+k.y)/2),m=new fabric.Point((f.x+b.x)/2,(f.y+b.y)/2),p=new fabric.Point((n.x+f.x)/2,(n.y+f.y)/2),q=new fabric.Point((n.x+k.x)/2,(n.y+k.y)/2),d=new fabric.Point(m.x+d*this.rotatingPointOffset,m.y-l*this.rotatingPointOffset);return this.oCoords={tl:b,tr:f,br:n,bl:k,ml:a,mt:m,mr:p,mb:q,mtr:d},this._setCornerCoords&&this._setCornerCoords(),
this},_calcRotateMatrix:function(){if(this.angle){var a=c(this.angle),b=Math.cos(a),a=Math.sin(a);return[b,a,-a,b,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var a=this.getCenterPoint(),a=[1,0,0,1,a.x,a.y],c=this._calcRotateMatrix(),d=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),f=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];return f=b(f,a),f=b(f,c),b(f,d)},_calcDimensionsTransformMatrix:function(a,e,d){a=[1,0,Math.tan(c(a)),1];e=[1,Math.tan(c(e)),0,1];d=
b([this.scaleX*(d&&this.flipX?-1:1),0,0,this.scaleY*(d&&this.flipY?-1:1)],a,!0);return b(d,e,!0)}})})();
fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(d){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,d):this.canvas.sendBackwards(this,d),this},bringForward:function(d){return this.group?
fabric.StaticCanvas.prototype.bringForward.call(this.group,this,d):this.canvas.bringForward(this,d),this},moveTo:function(d){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,d):this.canvas.moveTo(this,d),this}});
fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var d=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",c=this.fillRule,b=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",a=this.strokeWidth?this.strokeWidth:"0",e=this.strokeDashArray?this.strokeDashArray.join(" "):"none",g=this.strokeLineCap?this.strokeLineCap:"butt",f=this.strokeLineJoin?this.strokeLineJoin:"miter",k=this.strokeMiterLimit?this.strokeMiterLimit:
"4",l="undefined"!=typeof this.opacity?this.opacity:"1",m=this.visible?"":" visibility: hidden;",p=this.getSvgFilter();return["stroke: ",b,"; stroke-width: ",a,"; stroke-dasharray: ",e,"; stroke-linecap: ",g,"; stroke-linejoin: ",f,"; stroke-miterlimit: ",k,"; fill: ",d,"; fill-rule: ",c,"; opacity: ",l,";",p,m].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var d=
fabric.util.toFixed,c=this.getAngle(),b=this.getSkewX()%360,a=this.getSkewY()%360,e=this.getCenterPoint(),g=fabric.Object.NUM_FRACTION_DIGITS,e="path-group"===this.type?"":"translate("+d(e.x,g)+" "+d(e.y,g)+")",c=0!==c?" rotate("+d(c,g)+")":"",f=1===this.scaleX&&1===this.scaleY?"":" scale("+d(this.scaleX,g)+" "+d(this.scaleY,g)+")",b=0!==b?" skewX("+d(b,g)+")":"",d=0!==a?" skewY("+d(a,g)+")":"",a="path-group"===this.type?this.width:0,g="path-group"===this.type?this.height:0;return[e,c,f,this.flipX?
" matrix(-1 0 0 1 "+a+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+g+")":"",b,d].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var d=[];return this.fill&&this.fill.toLive&&d.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&d.push(this.stroke.toSVG(this,!1)),this.shadow&&d.push(this.shadow.toSVG(this)),d}});
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(d){return this.get(d)!==this.originalState[d]},this)},saveState:function(d){return this.stateProperties.forEach(function(c){this.originalState[c]=this.get(c)},this),d&&d.stateProperties&&d.stateProperties.forEach(function(c){this.originalState[c]=this.get(c)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}});
(function(){var d=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(c){if(!this.hasControls||!this.active)return!1;var b,a,e=c.x;c=c.y;this.__corner=0;for(var d in this.oCoords)if(this.isControlVisible(d)&&("mtr"!==d||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==d&&"mr"!==d&&"mb"!==d&&"ml"!==d)&&(a=this._getImageLines(this.oCoords[d].corner),b=this._findCrossPoints({x:e,y:c},a),0!==b&&1===b%2))return this.__corner=
d,d;return!1},_setCornerCoords:function(){var c=this.oCoords;var b=d(45-this.angle);var a=.707106*this.cornerSize;var e=a*Math.cos(b),g=a*Math.sin(b),f;for(f in c)b=c[f].x,a=c[f].y,c[f].corner={tl:{x:b-g,y:a-e},tr:{x:b+e,y:a-g},bl:{x:b-e,y:a+g},br:{x:b+g,y:a+e}}},_getNonTransformedDimensions:function(){var c=this.strokeWidth,b=this.width,a=this.height,e=!0,d=!0;return"line"===this.type&&"butt"===this.strokeLineCap&&(d=b,e=a),d&&(a+=0>a?-c:c),e&&(b+=0>b?-c:c),{x:b,y:a}},_getTransformedDimensions:function(c,
b){"undefined"==typeof c&&(c=this.skewX);"undefined"==typeof b&&(b=this.skewY);var a,e=this._getNonTransformedDimensions();var d=e.x/2;var e=e.y/2,e=[{x:-d,y:-e},{x:d,y:-e},{x:-d,y:e},{x:d,y:e}],f=this._calcDimensionsTransformMatrix(c,b,!1);for(d=0;d<e.length;d++)e[d]=fabric.util.transformPoint(e[d],f);return a=fabric.util.makeBoundingBoxFromPoints(e),{x:a.width,y:a.height}},_calculateCurrentDimensions:function(){var c=this.getViewportTransform(),b=this._getTransformedDimensions(),a=b.x,b=b.y;return a+=
2*this.padding,b+=2*this.padding,fabric.util.transformPoint(new fabric.Point(a,b),c,!0)},drawBorders:function(c){if(!this.hasBorders)return this;var b=this._calculateCurrentDimensions(),a=1/this.borderScaleFactor,e=b.x+a,b=b.y+a;if(c.save(),c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,c.strokeStyle=this.borderColor,c.lineWidth=a,c.strokeRect(-e/2,-b/2,e,b),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls)a=-b/2,c.beginPath(),c.moveTo(0,
a),c.lineTo(0,a-this.rotatingPointOffset),c.closePath(),c.stroke();return c.restore(),this},drawBordersInGroup:function(c,b){if(!this.hasBorders)return this;var a=this._getNonTransformedDimensions(),e=fabric.util.customTransformMatrix(b.scaleX,b.scaleY,b.skewX),d=fabric.util.transformPoint(a,e),a=1/this.borderScaleFactor,e=d.x+a+2*this.padding,d=d.y+a+2*this.padding;return c.save(),c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,c.strokeStyle=this.borderColor,c.lineWidth=a,c.strokeRect(-e/
2,-d/2,e,d),c.restore(),this},drawControls:function(c){if(!this.hasControls)return this;var b=this._calculateCurrentDimensions(),a=b.x,b=b.y,e=this.cornerSize,d=-(a+e)/2,e=-(b+e)/2,f=this.transparentCorners?"strokeRect":"fillRect";return c.save(),c.lineWidth=1,c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,c.strokeStyle=c.fillStyle=this.cornerColor,this._drawControl("tl",c,f,d,e),this._drawControl("tr",c,f,d+a,e),this._drawControl("bl",c,f,d,e+b),this._drawControl("br",c,f,d+a,e+b),this.get("lockUniScaling")||
(this._drawControl("mt",c,f,d+a/2,e),this._drawControl("mb",c,f,d+a/2,e+b),this._drawControl("mr",c,f,d+a,e+b/2),this._drawControl("ml",c,f,d,e+b/2)),this.hasRotatingPoint&&this._drawControl("mtr",c,f,d+a/2,e-this.rotatingPointOffset),c.restore(),this},_drawControl:function(c,b,a,e,d){this.isControlVisible(c)&&(c=this.cornerSize,"undefined"!=typeof G_vmlCanvasManager||this.transparentCorners||b.clearRect(e,d,c,c),b[a](e,d,c,c))},isControlVisible:function(c){return this._getControlsVisibility()[c]},
setControlVisible:function(c,b){return this._getControlsVisibility()[c]=b,this},setControlsVisibility:function(c){c||(c={});for(var b in c)this.setControlVisible(b,c[b]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(d,c){c=c||{};var b=function(){},a=c.onComplete||b,e=c.onChange||b,g=this;return fabric.util.animate({startValue:d.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(a){d.set("left",a);g.renderAll();e()},onComplete:function(){d.setCoords();a()}}),this},fxCenterObjectV:function(d,c){c=c||{};var b=function(){},a=c.onComplete||b,e=c.onChange||b,g=this;return fabric.util.animate({startValue:d.get("top"),
endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(a){d.set("top",a);g.renderAll();e()},onComplete:function(){d.setCoords();a()}}),this},fxRemove:function(d,c){c=c||{};var b=function(){},a=c.onComplete||b,e=c.onChange||b,g=this;return fabric.util.animate({startValue:d.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){d.set("active",!1)},onChange:function(a){d.set("opacity",a);g.renderAll();e()},onComplete:function(){g.remove(d);a()}}),this}});
fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var d=[];for(a in arguments[0])d.push(a);for(var c=0,b=d.length;b>c;c++){var a=d[c];var e=c!==b-1;this._animate(a,arguments[0][a],arguments[1],e)}}else this._animate.apply(this,arguments);return this},_animate:function(d,c,b,a){var e,g=this;c=c.toString();b=b?fabric.util.object.clone(b):{};~d.indexOf(".")&&(e=d.split("."));var f=e?this.get(e[0])[e[1]]:this.get(d);"from"in b||(b.from=
f);c=~c.indexOf("=")?f+parseFloat(c.replace("=","")):parseFloat(c);fabric.util.animate({startValue:b.from,endValue:c,byValue:b.by,easing:b.easing,duration:b.duration,abort:b.abort&&function(){return b.abort.call(g)},onChange:function(c){e?g[e[0]][e[1]]=c:g.set(d,c);a||b.onChange&&b.onChange()},onComplete:function(){a||(g.setCoords(),b.onComplete&&b.onComplete())}})}});
(function(d){function c(a,b){var c=a.origin,e=a.axis1,f=a.axis2,d=a.dimension,g=b.nearest,k=b.center,w=b.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(e),this.get(f));case k:return Math.min(this.get(e),this.get(f))+.5*this.get(d);case w:return Math.max(this.get(e),this.get(f))}}}var b=d.fabric||(d.fabric={}),a=b.util.object.extend,e={x1:1,x2:1,y1:1,y2:1},g=b.StaticCanvas.supports("setLineDash");return b.Line?void b.warn("fabric.Line is already defined"):(b.Line=b.util.createClass(b.Object,
{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){return this.callSuper("_set",a,b),"undefined"!=
typeof e[a]&&this._setWidthHeight(),this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){if(a.beginPath(),b){var c=this.getCenterPoint();a.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&g)c=this.calcLinePoints(),
a.moveTo(c.x1,c.y1),a.lineTo(c.x2,c.y2);a.lineWidth=this.strokeWidth;c=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=c},_renderDashedStroke:function(a){var c=this.calcLinePoints();a.beginPath();b.util.drawDashedLine(a,c.x1,c.y1,c.x2,c.y2,this.strokeDashArray);a.closePath()},toObject:function(b){return a(this.callSuper("toObject",b),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1;return{x1:a*
this.width*.5,x2:a*this.width*-.5,y1:b*this.height*.5,y2:b*this.height*-.5}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(c=this.calcLinePoints()),b.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},complexity:function(){return 1}}),b.Line.ATTRIBUTE_NAMES=
b.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),b.Line.fromElement=function(c,e){var f=b.parseAttributes(c,b.Line.ATTRIBUTE_NAMES);return new b.Line([f.x1||0,f.y1||0,f.x2||0,f.y2||0],a(f,e))},void(b.Line.fromObject=function(a){return new b.Line([a.x1,a.y1,a.x2,a.y2],a)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=Math.PI,a=c.util.object.extend;return c.Circle?void c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*b,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,b){return this.callSuper("_set",a,b),"radius"===a&&this.setRadius(b),this},toObject:function(b){return a(this.callSuper("toObject",
b),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var c=this._createBaseSVGMarkup(),e=0,d=0,l=(this.endAngle-this.startAngle)%(2*b);0===l?(this.group&&"path-group"===this.group.type&&(e=this.left+this.radius,d=this.top+this.radius),c.push("<circle ",'cx="'+e+'" cy="'+d+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')):c.push('<path d="M '+Math.cos(this.startAngle)*
this.radius+" "+Math.sin(this.startAngle)*this.radius," A "+this.radius+" "+this.radius," 0 ",+(l>b?1:0)+" 1"," "+Math.cos(this.endAngle)*this.radius+" "+Math.sin(this.endAngle)*this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},_render:function(a,b){a.beginPath();a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},
getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){return this.radius=a,this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),c.Circle.fromElement=function(b,d){d||(d={});var e=c.parseAttributes(b,c.Circle.ATTRIBUTE_NAMES);if(!("radius"in e&&0<=e.radius))throw Error("value of `r` attribute is required and can not be negative");
e.left=e.left||0;e.top=e.top||0;e=new c.Circle(a(e,d));return e.left-=e.radius,e.top-=e.radius,e},void(c.Circle.fromObject=function(a){return new c.Circle(a)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});return c.Triangle?void c.warn("fabric.Triangle is already defined"):(c.Triangle=c.util.createClass(c.Object,{type:"triangle",initialize:function(b){b=b||{};this.callSuper("initialize",b);this.set("width",b.width||100).set("height",b.height||100)},_render:function(b){var a=this.width/2,c=this.height/2;b.beginPath();b.moveTo(-a,c);b.lineTo(0,-c);b.lineTo(a,c);b.closePath();this._renderFill(b);this._renderStroke(b)},_renderDashedStroke:function(b){var a=this.width/
2,e=this.height/2;b.beginPath();c.util.drawDashedLine(b,-a,e,0,-e,this.strokeDashArray);c.util.drawDashedLine(b,0,-e,a,e,this.strokeDashArray);c.util.drawDashedLine(b,a,e,-a,e,this.strokeDashArray);b.closePath()},toSVG:function(b){var a=this._createBaseSVGMarkup(),c=this.width/2,d=this.height/2,c=[-c+" "+d,"0 "+-d,c+" "+d].join();return a.push("<polygon ",'points="',c,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),b?b(a.join("")):a.join("")},complexity:function(){return 1}}),
void(c.Triangle.fromObject=function(b){return new c.Triangle(b)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=2*Math.PI,a=c.util.object.extend;return c.Ellipse?void c.warn("fabric.Ellipse is already defined."):(c.Ellipse=c.util.createClass(c.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,b){switch(this.callSuper("_set",a,b),a){case "rx":this.rx=b;this.set("width",2*b);break;case "ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*
this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(b){return a(this.callSuper("toObject",b),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,e=0;return this.group&&"path-group"===this.group.type&&(c=this.left+this.rx,e=this.top+this.ry),b.push("<ellipse ",'cx="',c,'" cy="',e,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),
'"/>\n'),a?a(b.join("")):b.join("")},_render:function(a,c){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(c?this.left+this.rx:0,c?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,b,!1);a.restore();this._renderFill(a);this._renderStroke(a)},complexity:function(){return 1}}),c.Ellipse.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),c.Ellipse.fromElement=function(b,d){d||(d={});var e=c.parseAttributes(b,c.Ellipse.ATTRIBUTE_NAMES);e.left=e.left||0;e.top=e.top||0;e=
new c.Ellipse(a(e,d));return e.top-=e.ry,e.left-=e.rx,e},void(c.Ellipse.fromObject=function(a){return new c.Ellipse(a)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;if(c.Rect)return void c.warn("fabric.Rect is already defined");d=c.Object.prototype.stateProperties.concat();d.push("rx","ry","x","y");c.Rect=c.util.createClass(c.Object,{stateProperties:d,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a,b){if(1===this.width&&
1===this.height)return void a.fillRect(0,0,1,1);var c=this.rx?Math.min(this.rx,this.width/2):0,e=this.ry?Math.min(this.ry,this.height/2):0,d=this.width,l=this.height,m=b?this.left:-this.width/2,p=b?this.top:-this.height/2,n=0!==c||0!==e;a.beginPath();a.moveTo(m+c,p);a.lineTo(m+d-c,p);n&&a.bezierCurveTo(m+d-.4477152502*c,p,m+d,p+.4477152502*e,m+d,p+e);a.lineTo(m+d,p+l-e);n&&a.bezierCurveTo(m+d,p+l-.4477152502*e,m+d-.4477152502*c,p+l,m+d-c,p+l);a.lineTo(m+c,p+l);n&&a.bezierCurveTo(m+.4477152502*c,p+
l,m,p+l-.4477152502*e,m,p+l-e);a.lineTo(m,p+e);n&&a.bezierCurveTo(m,p+.4477152502*e,m+.4477152502*c,p,m+c,p);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(a){var b=-this.width/2,d=-this.height/2,f=this.width,k=this.height;a.beginPath();c.util.drawDashedLine(a,b,d,b+f,d,this.strokeDashArray);c.util.drawDashedLine(a,b+f,d,b+f,d+k,this.strokeDashArray);c.util.drawDashedLine(a,b+f,d+k,b,d+k,this.strokeDashArray);c.util.drawDashedLine(a,b,d+k,b,d,this.strokeDashArray);
a.closePath()},toObject:function(a){a=b(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(a),a},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.left,d=this.top;return this.group&&"path-group"===this.group.type||(c=-this.width/2,d=-this.height/2),b.push("<rect ",'x="',c,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),
'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},complexity:function(){return 1}});c.Rect.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));c.Rect.fromElement=function(a,e){if(!a)return null;e=e||{};var d=c.parseAttributes(a,c.Rect.ATTRIBUTE_NAMES);d.left=d.left||0;d.top=d.top||0;d=new c.Rect(b(e?c.util.object.clone(e):{},d));return d.visible=0<d.width&&0<d.height,d};c.Rect.fromObject=function(a){return new c.Rect(a)}})("undefined"!=
typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});return c.Polyline?void c.warn("fabric.Polyline is already defined"):(c.Polyline=c.util.createClass(c.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(b,a){return c.Polygon.prototype.initialize.call(this,b,a)},_calcDimensions:function(){return c.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return c.Polygon.prototype._applyPointOffset.call(this)},toObject:function(b){return c.Polygon.prototype.toObject.call(this,b)},
toSVG:function(b){return c.Polygon.prototype.toSVG.call(this,b)},_render:function(b){c.Polygon.prototype.commonRender.call(this,b)&&(this._renderFill(b),this._renderStroke(b))},_renderDashedStroke:function(b){b.beginPath();for(var a=0,e=this.points.length;e>a;a++){var d=this.points[a];var f=this.points[a+1]||d;c.util.drawDashedLine(b,d.x,d.y,f.x,f.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}}),c.Polyline.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polyline.fromElement=
function(b,a){if(!b)return null;a||(a={});var e=c.parsePointsAttribute(b.getAttribute("points")),d=c.parseAttributes(b,c.Polyline.ATTRIBUTE_NAMES);return new c.Polyline(e,c.util.object.extend(d,a))},void(c.Polyline.fromObject=function(b){return new c.Polyline(b.points,b,!0)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend,a=c.util.array.min,e=c.util.array.max,g=c.util.toFixed;return c.Polygon?void c.warn("fabric.Polygon is already defined"):(c.Polygon=c.util.createClass(c.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.points=a||[];this.callSuper("initialize",b);this._calcDimensions();"top"in b||(this.top=this.minY);"left"in b||(this.left=this.minX)},_calcDimensions:function(){var b=this.points,c=a(b,"x"),d=a(b,
"y"),g=e(b,"x"),b=e(b,"y");this.width=g-c||0;this.height=b-d||0;this.minX=c||0;this.minY=d||0},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2;a.y-=this.minY+this.height/2},this)},toObject:function(a){return b(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),e=0,d=this.points.length;d>e;e++)b.push(g(this.points[e].x,2),",",g(this.points[e].y,2)," ");return c.push("<",this.type," ",'points="',
b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),a?a(c.join("")):c.join("")},_render:function(a){this.commonRender(a)&&(this._renderFill(a),(this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a)))},commonRender:function(a){var b=this.points.length;if(!b||isNaN(this.points[b-1].y))return!1;a.beginPath();this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=
null);a.moveTo(this.points[0].x,this.points[0].y);for(var c=0;b>c;c++){var e=this.points[c];a.lineTo(e.x,e.y)}return!0},_renderDashedStroke:function(a){c.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}}),c.Polygon.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polygon.fromElement=function(a,e){if(!a)return null;e||(e={});var d=c.parsePointsAttribute(a.getAttribute("points")),f=c.parseAttributes(a,c.Polygon.ATTRIBUTE_NAMES);return new c.Polygon(d,
b(f,e))},void(c.Polygon.fromObject=function(a){return new c.Polygon(a.points,a,!0)}))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.array.min,a=c.util.array.max,e=c.util.object.extend,g=Object.prototype.toString,f=c.util.drawArc,k={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};return c.Path?void c.warn("fabric.Path is already defined"):(c.Path=c.util.createClass(c.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.setOptions(b);a||(a=[]);var c="[object Array]"===g.call(a);(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))&&
(c||(this.path=this._parsePath()),this._setPositionDimensions(b),b.sourcePath&&this.setSourcePath(b.sourcePath))},_setPositionDimensions:function(a){var b=this._parseDimensions();this.minX=b.left;this.minY=b.top;this.width=b.width;this.height=b.height;"undefined"==typeof a.left&&(this.left=b.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0));"undefined"==typeof a.top&&(this.top=b.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0));this.pathOffset=
this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(a){var b,c=null,e=0,d=0,g=0,k=0,m=0,l=0,r=-this.pathOffset.x,u=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(r=0,u=0);a.beginPath();for(var y=0,z=this.path.length;z>y;++y){switch(b=this.path[y],b[0]){case "l":g+=b[1];k+=b[2];a.lineTo(g+r,k+u);break;case "L":g=b[1];k=b[2];a.lineTo(g+r,k+u);break;case "h":g+=b[1];a.lineTo(g+r,k+u);break;case "H":g=b[1];a.lineTo(g+r,k+u);break;case "v":k+=b[1];a.lineTo(g+
r,k+u);break;case "V":k=b[1];a.lineTo(g+r,k+u);break;case "m":g+=b[1];k+=b[2];e=g;d=k;a.moveTo(g+r,k+u);break;case "M":g=b[1];k=b[2];e=g;d=k;a.moveTo(g+r,k+u);break;case "c":var x=g+b[5];var A=k+b[6];m=g+b[3];l=k+b[4];a.bezierCurveTo(g+b[1]+r,k+b[2]+u,m+r,l+u,x+r,A+u);g=x;k=A;break;case "C":g=b[5];k=b[6];m=b[3];l=b[4];a.bezierCurveTo(b[1]+r,b[2]+u,m+r,l+u,g+r,k+u);break;case "s":x=g+b[3];A=k+b[4];null===c[0].match(/[CcSs]/)?(m=g,l=k):(m=2*g-m,l=2*k-l);a.bezierCurveTo(m+r,l+u,g+b[1]+r,k+b[2]+u,x+r,
A+u);m=g+b[1];l=k+b[2];g=x;k=A;break;case "S":x=b[3];A=b[4];null===c[0].match(/[CcSs]/)?(m=g,l=k):(m=2*g-m,l=2*k-l);a.bezierCurveTo(m+r,l+u,b[1]+r,b[2]+u,x+r,A+u);g=x;k=A;m=b[1];l=b[2];break;case "q":x=g+b[3];A=k+b[4];m=g+b[1];l=k+b[2];a.quadraticCurveTo(m+r,l+u,x+r,A+u);g=x;k=A;break;case "Q":x=b[3];A=b[4];a.quadraticCurveTo(b[1]+r,b[2]+u,x+r,A+u);g=x;k=A;m=b[1];l=b[2];break;case "t":x=g+b[1];A=k+b[2];null===c[0].match(/[QqTt]/)?(m=g,l=k):(m=2*g-m,l=2*k-l);a.quadraticCurveTo(m+r,l+u,x+r,A+u);g=x;
k=A;break;case "T":x=b[1];A=b[2];null===c[0].match(/[QqTt]/)?(m=g,l=k):(m=2*g-m,l=2*k-l);a.quadraticCurveTo(m+r,l+u,x+r,A+u);g=x;k=A;break;case "a":f(a,g+r,k+u,[b[1],b[2],b[3],b[4],b[5],b[6]+g+r,b[7]+k+u]);g+=b[6];k+=b[7];break;case "A":f(a,g+r,k+u,[b[1],b[2],b[3],b[4],b[5],b[6]+r,b[7]+u]);g=b[6];k=b[7];break;case "z":case "Z":g=e,k=d,a.closePath()}c=b}this._renderFill(a);this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+
" }>"},toObject:function(a){a=e(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(a.sourcePath=this.sourcePath),this.transformMatrix&&(a.transformMatrix=this.transformMatrix),a},toDatalessObject:function(a){a=this.toObject(a);return this.sourcePath&&(a.path=this.sourcePath),delete a.sourcePath,a},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),e="",d=0,f=this.path.length;f>d;d++)b.push(this.path[d].join(" "));
b=b.join(" ");return this.group&&"path-group"===this.group.type||(e=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),c.push("<path ",'d="',b,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),e,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a,b,c,e=[],d=[],f=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,g=0,B=this.path.length;B>g;g++){a=
this.path[g];c=a.slice(1).trim();for(d.length=0;b=f.exec(c);)d.push(b[0]);a=[a.charAt(0)];c=0;for(var v=d.length;v>c;c++)b=parseFloat(d[c]),isNaN(b)||a.push(b);b=a[0];c=k[b.toLowerCase()];v=l[b]||b;if(a.length-1>c)for(var r=1,u=a.length;u>r;r+=c)e.push([b].concat(a.slice(r,r+c))),b=v;else e.push(a)}return e},_parseDimensions:function(){for(var e,d,f,g,k=[],l=[],C=null,B=0,v=0,r=0,u=0,y=0,z=0,x=0,A=this.path.length;A>x;++x){switch(e=this.path[x],e[0]){case "l":r+=e[1];u+=e[2];g=[];break;case "L":r=
e[1];u=e[2];g=[];break;case "h":r+=e[1];g=[];break;case "H":r=e[1];g=[];break;case "v":u+=e[1];g=[];break;case "V":u=e[1];g=[];break;case "m":r+=e[1];u+=e[2];B=r;v=u;g=[];break;case "M":r=e[1];u=e[2];B=r;v=u;g=[];break;case "c":d=r+e[5];f=u+e[6];y=r+e[3];z=u+e[4];g=c.util.getBoundsOfCurve(r,u,r+e[1],u+e[2],y,z,d,f);r=d;u=f;break;case "C":r=e[5];u=e[6];y=e[3];z=e[4];g=c.util.getBoundsOfCurve(r,u,e[1],e[2],y,z,r,u);break;case "s":d=r+e[3];f=u+e[4];null===C[0].match(/[CcSs]/)?(y=r,z=u):(y=2*r-y,z=2*
u-z);g=c.util.getBoundsOfCurve(r,u,y,z,r+e[1],u+e[2],d,f);y=r+e[1];z=u+e[2];r=d;u=f;break;case "S":d=e[3];f=e[4];null===C[0].match(/[CcSs]/)?(y=r,z=u):(y=2*r-y,z=2*u-z);g=c.util.getBoundsOfCurve(r,u,y,z,e[1],e[2],d,f);r=d;u=f;y=e[1];z=e[2];break;case "q":d=r+e[3];f=u+e[4];y=r+e[1];z=u+e[2];g=c.util.getBoundsOfCurve(r,u,y,z,y,z,d,f);r=d;u=f;break;case "Q":y=e[1];z=e[2];g=c.util.getBoundsOfCurve(r,u,y,z,y,z,e[3],e[4]);r=e[3];u=e[4];break;case "t":d=r+e[1];f=u+e[2];null===C[0].match(/[QqTt]/)?(y=r,z=
u):(y=2*r-y,z=2*u-z);g=c.util.getBoundsOfCurve(r,u,y,z,y,z,d,f);r=d;u=f;break;case "T":d=e[1];f=e[2];null===C[0].match(/[QqTt]/)?(y=r,z=u):(y=2*r-y,z=2*u-z);g=c.util.getBoundsOfCurve(r,u,y,z,y,z,d,f);r=d;u=f;break;case "a":g=c.util.getBoundsOfArc(r,u,e[1],e[2],e[3],e[4],e[5],e[6]+r,e[7]+u);r+=e[6];u+=e[7];break;case "A":g=c.util.getBoundsOfArc(r,u,e[1],e[2],e[3],e[4],e[5],e[6],e[7]);r=e[6];u=e[7];break;case "z":case "Z":r=B,u=v}C=e;g.forEach(function(a){k.push(a.x);l.push(a.y)});k.push(r);l.push(u)}e=
b(k)||0;d=b(l)||0;f=a(k)||0;g=a(l)||0;return{left:e,top:d,width:f-e,height:g-d}}}),c.Path.fromObject=function(a,b){"string"==typeof a.path?c.loadSVGFromURL(a.path,function(e){e=e[0];var d=a.path;delete a.path;c.util.object.extend(e,a);e.setSourcePath(d);b(e)}):b(new c.Path(a.path,a))},c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]),c.Path.fromElement=function(a,b,d){a=c.parseAttributes(a,c.Path.ATTRIBUTE_NAMES);b&&b(new c.Path(a.d,e(a,d)))},void(c.Path.async=!0))})("undefined"!=typeof exports?
exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend,a=c.util.array.invoke,e=c.Object.prototype.toObject;return c.PathGroup?void c.warn("fabric.PathGroup is already defined"):(c.PathGroup=c.util.createClass(c.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;b.toBeParsed&&(this.parseDimensionsFromPaths(b),delete b.toBeParsed);this.setOptions(b);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},parseDimensionsFromPaths:function(a){for(var b,
e,d,g=[],p=[],n=this.paths.length;n--;){b=this.paths[n];e=b.height+b.strokeWidth;d=b.width+b.strokeWidth;b=[{x:b.left,y:b.top},{x:b.left+d,y:b.top},{x:b.left,y:b.top+e},{x:b.left+d,y:b.top+e}];d=this.paths[n].transformMatrix;for(var q=0;q<b.length;q++)e=b[q],d&&(e=c.util.transformPoint(e,d,!1)),g.push(e.x),p.push(e.y)}a.width=Math.max.apply(null,g);a.height=Math.max.apply(null,p)},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);
this._setShadow(a);this.clipTo&&c.util.clipContext(this,a);a.translate(-this.width/2,-this.height/2);for(var b=0,e=this.paths.length;e>b;++b)this.paths[b].render(a,!0);this.clipTo&&a.restore();a.restore()}},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(c){c=b(e.call(this,c),{paths:a(this.getObjects(),"toObject",c)});return this.sourcePath&&(c.sourcePath=this.sourcePath),c},toDatalessObject:function(a){a=
this.toObject(a);return this.sourcePath&&(a.paths=this.sourcePath),a},toSVG:function(a){var b=this.getObjects(),c=this.getPointByOrigin("left","top"),e="translate("+c.x+" "+c.y+")",c=this._createBaseSVGMarkup();c.push("<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),e,this.getSvgTransform(),'" ',">\n");for(var e=0,d=b.length;d>e;e++)c.push("\t",b[e].toSVG(a));return c.push("</g>\n"),a?a(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+
"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill")||"";return"string"!=typeof a?!1:(a=a.toLowerCase(),this.getObjects().every(function(b){b=b.get("fill")||"";return"string"==typeof b&&b.toLowerCase()===a}))},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),c.PathGroup.fromObject=function(a,b){"string"==typeof a.paths?c.loadSVGFromURL(a.paths,
function(e){var d=a.paths;delete a.paths;e=c.util.groupSVGElements(e,a,d);b(e)}):c.util.enlivenObjects(a.paths,function(e){delete a.paths;b(new c.PathGroup(e,a))})},void(c.PathGroup.async=!0))})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend,a=c.util.array.min,e=c.util.array.max,g=c.util.array.invoke;if(!c.Group){var f={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};c.Group=c.util.createClass(c.Object,c.Collection,{type:"group",strokeWidth:0,initialize:function(a,b,c){b=b||{};this._objects=[];c&&this.callSuper("initialize",b);this._objects=a||[];for(a=this._objects.length;a--;)this._objects[a].group=this;this.originalState=
{};b.originX&&(this.originX=b.originX);b.originY&&(this.originY=b.originY);c?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",b));this.setCoords();this.saveCoords()},_updateObjectsCoords:function(a){for(var b=this._objects.length;b--;)this._updateObjectCoords(this._objects[b],a)},_updateObjectCoords:function(a,b){if(a.__origHasControls=a.hasControls,a.hasControls=!1,!b){var c=a.getLeft(),e=a.getTop(),d=this.getCenterPoint();a.set({originalLeft:c,
originalTop:e,left:c-d.x,top:e-d.y});a.setCoords()}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){return this._restoreObjectsState(),c.util.resetObjectTransform(this),a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){return this._restoreObjectsState(),
c.util.resetObjectTransform(this),this.forEachObject(this._setObjectActive,this),this.remove(a),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(a){a.group=this;a._set("canvas",this.canvas)},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){var c=this._objects.length;
if(this.delegatedProperties[a]||"canvas"===a)for(;c--;)this._objects[c].set(a,b);else for(;c--;)this._objects[c].setOnGroup(a,b);this.callSuper("_set",a,b)},toObject:function(a){return b(this.callSuper("toObject",a),{objects:g(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&c.util.clipContext(this,a);for(var b=0,e=this._objects.length;e>b;b++)this._renderObject(this._objects[b],
a);this.clipTo&&a.restore();a.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,e=this._objects.length;e>c;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){if(a.visible){var c=a.hasRotatingPoint;a.hasRotatingPoint=!1;a.render(b);a.hasRotatingPoint=c}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(a){var b=a.calcTransformMatrix(),b=c.util.qrDecompose(b),e=new c.Point(b.translateX,
b.translateY);return a.scaleX=b.scaleX,a.scaleY=b.scaleY,a.skewX=b.skewX,a.skewY=b.skewY,a.angle=b.angle,a.flipX=!1,a.flipY=!1,a.setPositionByOrigin(e,"center","center"),a},_restoreObjectState:function(a){return this.realizeTransform(a),a.setCoords(),a.hasControls=a.__origHasControls,delete a.__origHasControls,a.set("active",!1),delete a.group,this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),
this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(a){a.setCoords()}),this},_calcBounds:function(a){for(var b,c,e,d=[],f=[],g=["tr","br","bl","tl"],k=0,C=this._objects.length,B=g.length;C>k;++k)for(b=this._objects[k],b.setCoords(),e=0;B>e;e++)c=g[e],d.push(b.oCoords[c].x),f.push(b.oCoords[c].y);this.set(this._getBounds(d,f,a))},_getBounds:function(b,d,f){var g=c.util.invertTransform(this.getViewportTransform()),
k=c.util.transformPoint(new c.Point(a(b),a(d)),g);b=c.util.transformPoint(new c.Point(e(b),e(d)),g);b={width:b.x-k.x||0,height:b.y-k.y||0};return f||(b.left=k.x||0,b.top=k.y||0,"center"===this.originX&&(b.left+=b.width/2),"right"===this.originX&&(b.left+=b.width),"center"===this.originY&&(b.top+=b.height/2),"bottom"===this.originY&&(b.top+=b.height)),b},toSVG:function(a){var b=this._createBaseSVGMarkup();b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),
'">\n');for(var c=0,e=this._objects.length;e>c;c++)b.push("\t",this._objects[c].toSVG(a));return b.push("</g>\n"),a?a(b.join("")):b.join("")},get:function(a){if(a in f){if(this[a])return this[a];for(var b=0,c=this._objects.length;c>b;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});c.Group.fromObject=function(a,b){c.util.enlivenObjects(a.objects,function(e){delete a.objects;b&&b(new c.Group(e,a,!0))})};c.Group.async=
!0}})("undefined"!=typeof exports?exports:this);
(function(d){var c=fabric.util.object.extend;return d.fabric||(d.fabric={}),d.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,initialize:function(b,a){a||(a={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",a);this._initElement(b,a)},getElement:function(){return this._element},setElement:function(b,
a,c){return this._element=b,this._originalElement=b,this._initConfig(c),0!==this.filters.length?this.applyFilters(a):a&&a(),this},setCrossOrigin:function(b){return this.crossOrigin=b,this._element.crossOrigin=b,this},getOriginalSize:function(){var b=this.getElement();return{width:b.width,height:b.height}},_stroke:function(b){b.save();this._setStrokeStyles(b);b.beginPath();b.strokeRect(-this.width/2,-this.height/2,this.width,this.height);b.closePath();b.restore()},_renderDashedStroke:function(b){var a=
-this.width/2,c=-this.height/2,d=this.width,f=this.height;b.save();this._setStrokeStyles(b);b.beginPath();fabric.util.drawDashedLine(b,a,c,a+d,c,this.strokeDashArray);fabric.util.drawDashedLine(b,a+d,c,a+d,c+f,this.strokeDashArray);fabric.util.drawDashedLine(b,a+d,c+f,a,c+f,this.strokeDashArray);fabric.util.drawDashedLine(b,a,c+f,a,c,this.strokeDashArray);b.closePath();b.restore()},toObject:function(b){var a=[];this.filters.forEach(function(b){b&&a.push(b.toObject())});b=c(this.callSuper("toObject",
b),{src:this._originalElement.src||this._originalElement._src,filters:a,crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice});return 0<this.resizeFilters.length&&(b.resizeFilters=this.resizeFilters.map(function(a){return a&&a.toObject()})),this.includeDefaultValues||this._removeDefaultValues(b),b},toSVG:function(b){var a=this._createBaseSVGMarkup(),c=-this.width/2,d=-this.height/2,f="none";if(this.group&&"path-group"===this.group.type&&(c=this.left,d=this.top),
"none"!==this.alignX&&"none"!==this.alignY&&(f="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),a.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',c,'" y="',d,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',f,'"',"></image>\n"),this.stroke||this.strokeDashArray)f=this.fill,this.fill=null,a.push("<rect ",'x="',c,'" y="',d,'" width="',this.width,'" height="',
this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f;return a.push("</g>\n"),b?b(a.join("")):a.join("")},getSrc:function(){return this.getElement()?this.getElement().src||this.getElement()._src:void 0},setSrc:function(b,a,c){fabric.util.loadImage(b,function(b){return this.setElement(b,a,c)},this,c&&c.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(b,a){this.constructor.fromObject(this.toObject(a),b)},applyFilters:function(b,a,c,d){if(a=
a||this.filters,c=c||this._originalElement){var e=c,g=fabric.util.createCanvasElement(),l=fabric.util.createImage(),m=this;return g.width=e.width,g.height=e.height,g.getContext("2d").drawImage(e,0,0,e.width,e.height),0===a.length?(this._element=c,b&&b(),g):(a.forEach(function(a){a&&a.applyTo(g,a.scaleX||m.scaleX,a.scaleY||m.scaleY);!d&&a&&"Resize"===a.type&&(m.width*=a.scaleX,m.height*=a.scaleY)}),l.width=g.width,l.height=g.height,fabric.isLikelyNode?(l.src=g.toBuffer(void 0,fabric.Image.pngCompression),
m._element=l,!d&&(m._filteredEl=l),b&&b()):(l.onload=function(){m._element=l;!d&&(m._filteredEl=l);b&&b();l.onload=g=e=null},l.src=g.toDataURL("image/png")),g)}},_render:function(b,a){var c,d=this._findMargins();var f=a?this.left:-this.width/2;var k=a?this.top:-this.height/2;"slice"===this.meetOrSlice&&(b.beginPath(),b.rect(f,k,this.width,this.height),b.clip());!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,c=this.applyFilters(null,
this.resizeFilters,this._filteredEl||this._originalElement,!0)):c=this._element;c&&b.drawImage(c,f+d.marginX,k+d.marginY,d.width,d.height);this._renderStroke(b)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var b,a,c=this.width,d=this.height,f=0,k=0;return("none"!==this.alignX||"none"!==this.alignY)&&(b=[this.width/this._element.width,this.height/this._element.height],a="meet"===this.meetOrSlice?Math.min.apply(null,b):Math.max.apply(null,
b),c=this._element.width*a,d=this._element.height*a,"Mid"===this.alignX&&(f=(this.width-c)/2),"Max"===this.alignX&&(f=this.width-c),"Mid"===this.alignY&&(k=(this.height-d)/2),"Max"===this.alignY&&(k=this.height-d)),{width:c,height:d,marginX:f,marginY:k}},_resetWidthHeight:function(){var b=this.getElement();this.set("width",b.width);this.set("height",b.height)},_initElement:function(b,a){this.setElement(fabric.util.getById(b),null,a);fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},
_initConfig:function(b){b||(b={});this.setOptions(b);this._setWidthHeight(b);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(b,a){b&&b.length?fabric.util.enlivenObjects(b,function(b){a&&a(b)},"fabric.Image.filters"):a&&a()},_setWidthHeight:function(b){this.width="width"in b?b.width:this.getElement()?this.getElement().width||0:0;this.height="height"in b?b.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS=
"canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(b,a){fabric.util.loadImage(b.src,function(c){fabric.Image.prototype._initFilters.call(b,b.filters,function(e){b.filters=e||[];fabric.Image.prototype._initFilters.call(b,b.resizeFilters,function(e){b.resizeFilters=e||[];e=new fabric.Image(c,b);a&&a(e)})})},null,b.crossOrigin)},fabric.Image.fromURL=function(b,a,c){fabric.util.loadImage(b,function(b){a&&a(new fabric.Image(b,c))},null,c&&c.crossOrigin)},
fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(b,a,e){var d;b=fabric.parseAttributes(b,fabric.Image.ATTRIBUTE_NAMES);b.preserveAspectRatio&&(d=fabric.util.parsePreserveAspectRatioAttribute(b.preserveAspectRatio),c(b,d));fabric.Image.fromURL(b["xlink:href"],a,c(e?fabric.util.object.clone(e):{},b))},fabric.Image.async=!0,void(fabric.Image.pngCompression=1))})("undefined"!=typeof exports?exports:
this);
fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var d=this.getAngle()%360;return 0<d?90*Math.round((d-1)/90):90*Math.round(d/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(d){d=d||{};var c=function(){},b=d.onComplete||c,a=d.onChange||c,e=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(b){e.setAngle(b);a()},
onComplete:function(){e.setCoords();b()},onStart:function(){e.set("active",!1)}}),this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(d){return d.straighten(),this.renderAll(),this},fxStraightenObject:function(d){return d.fxStraighten({onChange:this.renderAll.bind(this)}),this}});fabric.Image.filters=fabric.Image.filters||{};
fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(d){d&&this.setOptions(d)},setOptions:function(d){for(var c in d)this[c]=d[c]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Brightness=c.util.createClass(c.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{};this.brightness=a.brightness||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,d=this.brightness,k=0,l=c.length;l>k;k+=4)c[k]+=d,c[k+1]+=d,c[k+2]+=d;b.putImageData(a,0,0)},toObject:function(){return b(this.callSuper("toObject"),{brightness:this.brightness})}});
c.Image.filters.Brightness.fromObject=function(a){return new c.Image.filters.Brightness(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Convolute=c.util.createClass(c.Image.filters.BaseFilter,{type:"Convolute",initialize:function(a){a=a||{};this.opaque=a.opaque;this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(a){var b,c,d,k,l,m=this.matrix,p=a.getContext("2d");var n=p.getImageData(0,0,a.width,a.height);a=Math.round(Math.sqrt(m.length));for(var q=Math.floor(a/2),t=n.data,w=n.width,C=n.height,B=p.createImageData(w,C),v=B.data,r=this.opaque?
1:0,u=0;C>u;u++)for(var y=0;w>y;y++){var z=4*(u*w+y);for(var x=d=c=b=n=0;a>x;x++)for(var A=0;a>A;A++){var F=u+x-q;var D=y+A-q;0>F||F>C||0>D||D>w||(k=4*(F*w+D),l=m[x*a+A],n+=t[k]*l,b+=t[k+1]*l,c+=t[k+2]*l,d+=t[k+3]*l)}v[z]=n;v[z+1]=b;v[z+2]=c;v[z+3]=d+r*(255-d)}p.putImageData(B,0,0)},toObject:function(){return b(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});c.Image.filters.Convolute.fromObject=function(a){return new c.Image.filters.Convolute(a)}})("undefined"!=typeof exports?
exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.GradientTransparency=c.util.createClass(c.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,d=this.threshold,k=c.length,l=0,m=c.length;m>l;l+=4)c[l+3]=d+255*(k-l)/k;b.putImageData(a,0,0)},toObject:function(){return b(this.callSuper("toObject"),{threshold:this.threshold})}});
c.Image.filters.GradientTransparency.fromObject=function(a){return new c.Image.filters.GradientTransparency(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Grayscale=c.util.createClass(c.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(b){for(var a=b.getContext("2d"),c=a.getImageData(0,0,b.width,b.height),d=c.data,f=c.width*c.height*4,k=0;f>k;)b=(d[k]+d[k+1]+d[k+2])/3,d[k]=b,d[k+1]=b,d[k+2]=b,k+=4;a.putImageData(c,0,0)}});c.Image.filters.Grayscale.fromObject=function(){return new c.Image.filters.Grayscale}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Invert=c.util.createClass(c.Image.filters.BaseFilter,{type:"Invert",applyTo:function(b){var a=b.getContext("2d"),c=a.getImageData(0,0,b.width,b.height),d=c.data,f=d.length;for(b=0;f>b;b+=4)d[b]=255-d[b],d[b+1]=255-d[b+1],d[b+2]=255-d[b+2];a.putImageData(c,0,0)}});c.Image.filters.Invert.fromObject=function(){return new c.Image.filters.Invert}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Mask=c.util.createClass(c.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{};this.mask=a.mask;this.channel=-1<[0,1,2,3].indexOf(a.channel)?a.channel:0},applyTo:function(a){if(this.mask){var b=a.getContext("2d"),d=b.getImageData(0,0,a.width,a.height),f=d.data,k=this.mask.getElement(),l=c.util.createCanvasElement(),m=this.channel,p=d.width*d.height*4;l.width=a.width;l.height=a.height;l.getContext("2d").drawImage(k,
0,0,a.width,a.height);k=l.getContext("2d").getImageData(0,0,a.width,a.height).data;for(a=0;p>a;a+=4)f[a+3]=k[a+m];b.putImageData(d,0,0)}},toObject:function(){return b(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});c.Image.filters.Mask.fromObject=function(a,b){c.util.loadImage(a.mask.src,function(e){a.mask=new c.Image(e,a.mask);b&&b(new c.Image.filters.Mask(a))})};c.Image.filters.Mask.async=!0})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Noise=c.util.createClass(c.Image.filters.BaseFilter,{type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||0},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,k=this.noise,l=0,m=d.length;m>l;l+=4)a=(.5-Math.random())*k,d[l]+=a,d[l+1]+=a,d[l+2]+=a;b.putImageData(c,0,0)},toObject:function(){return b(this.callSuper("toObject"),{noise:this.noise})}});c.Image.filters.Noise.fromObject=
function(a){return new c.Image.filters.Noise(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Pixelate=c.util.createClass(c.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{};this.blocksize=a.blocksize||4},applyTo:function(a){var b,c,d=a.getContext("2d"),k=d.getImageData(0,0,a.width,a.height),l=k.data,m=k.height,p=k.width;for(b=0;m>b;b+=this.blocksize)for(c=0;p>c;c+=this.blocksize){a=4*b*p+4*c;var n=l[a];var q=l[a+1];var t=l[a+2];var w=l[a+3];for(var C=b,B=b+this.blocksize;B>C;C++)for(var v=
c,r=c+this.blocksize;r>v;v++)a=4*C*p+4*v,l[a]=n,l[a+1]=q,l[a+2]=t,l[a+3]=w}d.putImageData(k,0,0)},toObject:function(){return b(this.callSuper("toObject"),{blocksize:this.blocksize})}});c.Image.filters.Pixelate.fromObject=function(a){return new c.Image.filters.Pixelate(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.RemoveWhite=c.util.createClass(c.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(a){for(var b,c,d=a.getContext("2d"),k=d.getImageData(0,0,a.width,a.height),l=k.data,m=this.distance,p=255-this.threshold,n=Math.abs,q=0,t=l.length;t>q;q+=4)a=l[q],b=l[q+1],c=l[q+2],a>p&&b>p&&c>p&&n(a-b)<m&&n(a-c)<m&&n(b-c)<m&&(l[q+3]=
1);d.putImageData(k,0,0)},toObject:function(){return b(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});c.Image.filters.RemoveWhite.fromObject=function(a){return new c.Image.filters.RemoveWhite(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Sepia=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(b){var a=b.getContext("2d"),c=a.getImageData(0,0,b.width,b.height),d=c.data,f=d.length;for(b=0;f>b;b+=4){var k=.3*d[b]+.59*d[b+1]+.11*d[b+2];d[b]=k+100;d[b+1]=k+50;d[b+2]=k+255}a.putImageData(c,0,0)}});c.Image.filters.Sepia.fromObject=function(){return new c.Image.filters.Sepia}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={});c.Image.filters.Sepia2=c.util.createClass(c.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(b){var a=b.getContext("2d"),c=a.getImageData(0,0,b.width,b.height),d=c.data,f=d.length;for(b=0;f>b;b+=4){var k=d[b];var l=d[b+1];var m=d[b+2];d[b]=(.393*k+.769*l+.189*m)/1.351;d[b+1]=(.349*k+.686*l+.168*m)/1.203;d[b+2]=(.272*k+.534*l+.131*m)/2.14}a.putImageData(c,0,0)}});c.Image.filters.Sepia2.fromObject=function(){return new c.Image.filters.Sepia2}})("undefined"!=
typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Tint=c.util.createClass(c.Image.filters.BaseFilter,{type:"Tint",initialize:function(a){a=a||{};this.color=a.color||"#000000";this.opacity="undefined"!=typeof a.opacity?a.opacity:(new c.Color(this.color)).getAlpha()},applyTo:function(a){var b=a.getContext("2d"),d=b.getImageData(0,0,a.width,a.height),f=d.data,k=f.length;var l=(new c.Color(this.color)).getSource();a=l[0]*this.opacity;var m=l[1]*this.opacity;var p=l[2]*
this.opacity;var n=1-this.opacity;for(l=0;k>l;l+=4){var q=f[l];var t=f[l+1];var w=f[l+2];f[l]=a+q*n;f[l+1]=m+t*n;f[l+2]=p+w*n}b.putImageData(d,0,0)},toObject:function(){return b(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});c.Image.filters.Tint.fromObject=function(a){return new c.Image.filters.Tint(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend;c.Image.filters.Multiply=c.util.createClass(c.Image.filters.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{};this.color=a.color||"#000000"},applyTo:function(a){var b=a.getContext("2d"),d=b.getImageData(0,0,a.width,a.height),f=d.data,k=f.length;var l=(new c.Color(this.color)).getSource();for(a=0;k>a;a+=4)f[a]*=l[0]/255,f[a+1]*=l[1]/255,f[a+2]*=l[2]/255;b.putImageData(d,0,0)},toObject:function(){return b(this.callSuper("toObject"),
{color:this.color})}});c.Image.filters.Multiply.fromObject=function(a){return new c.Image.filters.Multiply(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric;c.Image.filters.Blend=c.util.createClass({type:"Blend",initialize:function(b){b=b||{};this.color=b.color||"#000";this.image=b.image||!1;this.mode=b.mode||"multiply";this.alpha=b.alpha||1},applyTo:function(b){var a,d,g,f=b.getContext("2d");b=f.getImageData(0,0,b.width,b.height);var k=b.data,l=!1;if(this.image){l=!0;var m=c.util.createCanvasElement();m.width=this.image.width;m.height=this.image.height;m=new c.StaticCanvas(m);m.add(this.image);m=m.getContext("2d").getImageData(0,
0,m.width,m.height).data}else{m=(new c.Color(this.color)).getSource();var p=m[0]*this.alpha;var n=m[1]*this.alpha;var q=m[2]*this.alpha}for(var t=0,w=k.length;w>t;t+=4)switch(a=k[t],d=k[t+1],g=k[t+2],l&&(p=m[t]*this.alpha,n=m[t+1]*this.alpha,q=m[t+2]*this.alpha),this.mode){case "multiply":k[t]=a*p/255;k[t+1]=d*n/255;k[t+2]=g*q/255;break;case "screen":k[t]=1-(1-a)*(1-p);k[t+1]=1-(1-d)*(1-n);k[t+2]=1-(1-g)*(1-q);break;case "add":k[t]=Math.min(255,a+p);k[t+1]=Math.min(255,d+n);k[t+2]=Math.min(255,g+
q);break;case "diff":case "difference":k[t]=Math.abs(a-p);k[t+1]=Math.abs(d-n);k[t+2]=Math.abs(g-q);break;case "subtract":a-=p;d-=n;g-=q;k[t]=0>a?0:a;k[t+1]=0>d?0:d;k[t+2]=0>g?0:g;break;case "darken":k[t]=Math.min(a,p);k[t+1]=Math.min(d,n);k[t+2]=Math.min(g,q);break;case "lighten":k[t]=Math.max(a,p),k[t+1]=Math.max(d,n),k[t+2]=Math.max(g,q)}f.putImageData(b,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});c.Image.filters.Blend.fromObject=function(b){return new c.Image.filters.Blend(b)}})("undefined"!=
typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=Math.pow,a=Math.floor,e=Math.sqrt,g=Math.abs,f=Math.max,k=Math.round,l=Math.sin,m=Math.ceil;c.Image.filters.Resize=c.util.createClass(c.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){this.rcpScaleX=1/b;this.rcpScaleY=1/c;var d,e=a.width,f=a.height;b=k(e*b);c=k(f*c);"sliceHack"===this.resizeType&&(d=this.sliceByTwo(a,e,f,b,c));"hermite"===this.resizeType&&(d=this.hermiteFastResize(a,
e,f,b,c));"bilinear"===this.resizeType&&(d=this.bilinearFiltering(a,e,f,b,c));"lanczos"===this.resizeType&&(d=this.lanczosResize(a,e,f,b,c));a.width=b;a.height=c;a.getContext("2d").putImageData(d,0,0)},sliceByTwo:function(b,d,e,g,k){var l=b.getContext("2d"),m=.5,p=.5,n=1,q=1,t=!1,w=!1,x=d,A=e,F=c.util.createCanvasElement(),D=F.getContext("2d");g=a(g);k=a(k);F.width=f(g,d);F.height=f(k,e);g>d&&(m=2,n=-1);k>e&&(p=2,q=-1);var E=l.getImageData(0,0,d,e);b.width=f(g,d);b.height=f(k,e);for(l.putImageData(E,
0,0);!t||!w;)d=x,e=A,g*n<a(x*m*n)?x=a(x*m):(x=g,t=!0),k*q<a(A*p*q)?A=a(A*p):(A=k,w=!0),E=l.getImageData(0,0,d,e),D.putImageData(E,0,0),l.clearRect(0,0,x,A),l.drawImage(F,0,0,d,e,0,0,x,A);return l.getImageData(0,0,g,k)},lanczosResize:function(c,d,f,k,w){var p,n,q;function t(c){var l,m,r,u,v,C,B,M,Q;n=(c+.5)*F;p=a(n);for(l=0;w>l;l++){q=(l+.5)*D;L=a(q);var S=M=B=C=v=0;for(m=p-I;m<=p+I;m++)if(!(0>m||m>=d)){var O=a(1E3*g(m-n));H[O]||(H[O]={});for(var P=L-J;P<=L+J;P++)0>P||P>=f||(Q=a(1E3*g(P-q)),H[O][Q]||
(H[O][Q]=A(e(b(O*E,2)+b(Q*G,2))/1E3)),r=H[O][Q],0<r&&(u=4*(P*d+m),v+=r,C+=r*z[u],B+=r*z[u+1],M+=r*z[u+2],S+=r*z[u+3]))}u=4*(l*k+c);x[u]=C/v;x[u+1]=B/v;x[u+2]=M/v;x[u+3]=S/v}return++c<k?t(c):y}c=c.getContext("2d");var u=c.getImageData(0,0,d,f),y=c.getImageData(0,0,k,w),z=u.data,x=y.data,A=function(a){return function(b){if(b>a)return 0;if(b*=Math.PI,1E-16>g(b))return 1;var c=b/a;return l(b)*l(c)/b/c}}(this.lanczosLobes),F=this.rcpScaleX,D=this.rcpScaleY,E=2/this.rcpScaleX,G=2/this.rcpScaleY,I=m(F*this.lanczosLobes/
2),J=m(D*this.lanczosLobes/2),H={};var L=p=q=n=void 0;return t(0)},bilinearFiltering:function(b,c,d,e,f){var g,k=0,l=this.rcpScaleX,m=this.rcpScaleY;var p=b.getContext("2d");b=4*(c-1);d=p.getImageData(0,0,c,d).data;var n=p.getImageData(0,0,e,f),q=n.data;for(p=0;f>p;p++)for(g=0;e>g;g++){var t=a(l*g);var w=a(m*p);var F=l*g-t;var D=m*p-w;w=4*(w*c+t);for(t=0;4>t;t++){var E=d[w+t];var G=d[w+4+t];var I=d[w+b+t];var J=d[w+b+4+t];E=E*(1-F)*(1-D)+G*F*(1-D)+I*D*(1-F)+J*F*D;q[k++]=E}}return n},hermiteFastResize:function(b,
c,d,f,k){var l=this.rcpScaleX,p=this.rcpScaleY,n=m(l/2),q=m(p/2);b=b.getContext("2d");d=b.getImageData(0,0,c,d).data;b=b.getImageData(0,0,f,k);for(var t=b.data,w=0;k>w;w++)for(var z=0;f>z;z++){for(var x=4*(z+w*f),A=0,F=0,D=0,E=0,G=0,I=0,J=0,H=(w+.5)*p,L=a(w*p);(w+1)*p>L;L++)for(var M=g(H-(L+.5))/q,T=(z+.5)*l,M=M*M,R=a(z*l);(z+1)*l>R;R++){var K=g(T-(R+.5))/n,N=e(M+K*K);1<N&&-1>N||(A=2*N*N*N-3*N*N+1,0<A&&(K=4*(R+L*c),J+=A*d[K+3],D+=A,255>d[K+3]&&(A=A*d[K+3]/250),E+=A*d[K],G+=A*d[K+1],I+=A*d[K+2],F+=
A))}t[x]=E/F;t[x+1]=G/F;t[x+2]=I/F;t[x+3]=J/D}return b},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});c.Image.filters.Resize.fromObject=function(a){return new c.Image.filters.Resize(a)}})("undefined"!=typeof exports?exports:this);
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.extend,a=c.util.object.clone,e=c.util.toFixed,g=c.StaticCanvas.supports("setLineDash"),f=c.Object.NUM_FRACTION_DIGITS;if(c.Text)return void c.warn("fabric.Text is already defined");d=c.Object.prototype.stateProperties.concat();d.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor");c.Text=c.util.createClass(c.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,
fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:d,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},
_initDimensions:function(a){this.__skipDimension||(a||(a=c.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this._cacheLinesWidth="justify"!==this.textAlign,this.width=this._getTextWidth(a),this._cacheLinesWidth=!0,this.height=this._getTextHeight(a))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&c.util.clipContext(this,
a);this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextBackground(a);this._setStrokeStyles(a);this._setFillStyles(a);this._renderText(a);this._renderTextDecoration(a);this.clipTo&&a.restore()},_renderText:function(a){this._translateForTextAlign(a);this._renderTextFill(a);this._renderTextStroke(a);this._translateForTextAlign(a,!0)},_translateForTextAlign:function(a,b){if("left"!==this.textAlign&&"justify"!==this.textAlign){var c=b?-1:1;a.translate("center"===this.textAlign?
c*this.width/2:c*this.width,0)}},_setTextStyles:function(a){a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(a){for(var b=this._getLineWidth(a,0),c=1,d=this._textLines.length;d>c;c++){var e=this._getLineWidth(a,c);e>b&&(b=e)}return b},_renderChars:function(a,b,c,d,e){var f=a.slice(0,-4);if(this[f].toLive){var g=-this.width/2+this[f].offsetX||
0,k=-this.height/2+this[f].offsetY||0;b.save();b.translate(g,k);d-=g;e-=k}b[a](c,d,e);this[f].toLive&&b.restore()},_renderTextLine:function(a,b,c,d,e,f){e-=this.fontSize*this._fontSizeFraction;var g=this._getLineWidth(b,f);if("justify"!==this.textAlign||this.width<g)return void this._renderChars(a,b,c,d,e,f);var g=c.split(/\s+/),k=0;var l=this._getWidthOfWords(b,c,f,0);l=this.width-l;for(var m=g.length-1,m=0<m?l/m:0,p=0,n=0,q=g.length;q>n;n++){for(;" "===c[k]&&k<c.length;)k++;l=g[n];this._renderChars(a,
b,l,d+p,e,f,k);p+=this._getWidthOfWords(b,l,f,k)+m;k+=l.length}},_getWidthOfWords:function(a,b){return a.measureText(b.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a){if(this.fill||this._skipFillStrokeCheck)for(var b=0,c=0,d=this._textLines.length;d>c;c++){var e=this._getHeightOfLine(a,c),f=e/this.lineHeight;this._renderTextLine("fillText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+
b+f,c);b+=e}},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var b=0;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a);a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g&&a.setLineDash(this.strokeDashArray));a.beginPath();for(var c=0,d=this._textLines.length;d>c;c++){var e=this._getHeightOfLine(a,c),f=e/this.lineHeight;this._renderTextLine("strokeText",
a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+f,c);b+=e}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height))},_renderTextLinesBackground:function(a){if(this.textBackgroundColor){var b,
c,d=0,e=this._getHeightOfLine();a.fillStyle=this.textBackgroundColor;for(var f=0,g=this._textLines.length;g>f;f++)""!==this._textLines[f]&&(b="justify"===this.textAlign?this.width:this._getLineWidth(a,f),c=this._getLineLeftOffset(b),a.fillRect(this._getLeftOffset()+c,this._getTopOffset()+d,b,this.fontSize*this._fontSizeMult)),d+=e}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=
[]},_shouldClearCache:function(){var a=!1;if(this._forceClearCache)return this._forceClearCache=!1,!0;for(var b in this._dimensionAffectingProps)this["__"+b]!==this[b]&&(this["__"+b]=this[b],a=!0);return a},_getLineWidth:function(a,b){if(this.__lineWidths[b])return this.__lineWidths[b];var c,d,e=this._textLines[b];return""===e?c=0:"justify"===this.textAlign&&this._cacheLinesWidth?(d=e.split(/\s+/),c=1<d.length?this.width:a.measureText(e).width):c=a.measureText(e).width,this._cacheLinesWidth&&(this.__lineWidths[b]=
c),c},_renderTextDecoration:function(a){if(this.textDecoration){var b=this.height/2;var c=[];-1<this.textDecoration.indexOf("underline")&&c.push(.85);-1<this.textDecoration.indexOf("line-through")&&c.push(.43);-1<this.textDecoration.indexOf("overline")&&c.push(-.12);if(0<c.length){var d,e,f=0;var g=0;for(d=this._textLines.length;d>g;g++){var k=this._getLineWidth(a,g);var C=this._getLineLeftOffset(k);var B=this._getHeightOfLine(a,g);var v=0;for(e=c.length;e>v;v++)a.fillRect(this._getLeftOffset()+C,
f+(this._fontSizeMult-1+c[v])*this.fontSize-b,k,this.fontSize/15);f+=B}}}},_getFontDeclaration:function(){return[c.isLikelyNode?this.fontWeight:this.fontStyle,c.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",c.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(a.save(),this._setTextStyles(a),this._shouldClearCache()&&this._initDimensions(a),b||this.transform(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.group&&
"path-group"===this.group.type&&a.translate(this.left,this.top),this._render(a),a.restore())},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(a){a=b(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});return this.includeDefaultValues||
this._removeDefaultValues(a),a},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this._getSVGLeftTopOffsets(this.ctx),c=this._getSVGTextAndBg(c.textTop,c.textLeft);return this._wrapSVGTextAndBg(b,c),a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){a=this._getHeightOfLine(a,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:a}},_wrapSVGTextAndBg:function(a,b){a.push('\t<g transform="',
this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',b.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >\n',b.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(a,
b){var c=[],d=[],e=0;this._setSVGBg(d);for(var f=0,g=this._textLines.length;g>f;f++)this.textBackgroundColor&&this._setSVGTextLineBg(d,f,b,a,e),this._setSVGTextLineText(f,c,e,b,a,d),e+=this._getHeightOfLine(this.ctx,f);return{textSpans:c,textBgRects:d}},_setSVGTextLineText:function(a,b,d,g,n){d=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-n+d-this.height/2;return"justify"===this.textAlign?void this._setSVGTextLineJustifed(a,b,d,g):void b.push('\t\t\t<tspan x="',e(g+this._getLineLeftOffset(this._getLineWidth(this.ctx,
a)),f),'" ','y="',e(d,f),'" ',this._getFillAttributes(this.fill),">",c.util.string.escapeXml(this._textLines[a]),"</tspan>\n")},_setSVGTextLineJustifed:function(a,b,d,g){var k=c.util.createCanvasElement().getContext("2d");this._setTextStyles(k);var l=this._textLines[a];var m=l.split(/\s+/);l=this._getWidthOfWords(k,l);l=this.width-l;var p=m.length-1,p=0<p?l/p:0,C=this._getFillAttributes(this.fill);g+=this._getLineLeftOffset(this._getLineWidth(k,a));a=0;for(var B=m.length;B>a;a++)l=m[a],b.push('\t\t\t<tspan x="',
e(g,f),'" ','y="',e(d,f),'" ',C,">",c.util.string.escapeXml(l),"</tspan>\n"),g+=this._getWidthOfWords(k,l)+p},_setSVGTextLineBg:function(a,b,c,d,g){a.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',e(c+this._getLineLeftOffset(this._getLineWidth(this.ctx,b)),f),'" y="',e(g-this.height/2,f),'" width="',e(this._getLineWidth(this.ctx,b),f),'" height="',e(this._getHeightOfLine(this.ctx,b)/this.lineHeight,f),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&a.push("\t\t<rect ",
this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,f),'" y="',e(-this.height/2,f),'" width="',e(this.width,f),'" height="',e(this.height,f),'"></rect>\n')},_getFillAttributes:function(a){var b=a&&"string"==typeof a?new c.Color(a):"";return b&&b.getSource()&&1!==b.getAlpha()?'opacity="'+b.getAlpha()+'" fill="'+b.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}});
c.Text.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" "));c.Text.DEFAULT_SVG_FONT_SIZE=16;c.Text.fromElement=function(a,b){if(!a)return null;var d=c.parseAttributes(a,c.Text.ATTRIBUTE_NAMES);b=c.util.object.extend(b?c.util.object.clone(b):{},d);b.top=b.top||0;b.left=b.left||0;"dx"in d&&(b.left+=d.dx);"dy"in d&&(b.top+=d.dy);"fontSize"in b||(b.fontSize=c.Text.DEFAULT_SVG_FONT_SIZE);b.originX||(b.originX="left");
d="";"textContent"in a?d=a.textContent:"firstChild"in a&&null!==a.firstChild&&"data"in a.firstChild&&null!==a.firstChild.data&&(d=a.firstChild.data);var d=d.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),d=new c.Text(d,b),e=0;return"left"===d.originX&&(e=d.getWidth()/2),"right"===d.originX&&(e=-d.getWidth()/2),d.set({left:d.getLeft()+e,top:d.getTop()-d.getHeight()/2+d.fontSize*(.18+d._fontSizeFraction)}),d};c.Text.fromObject=function(b){return new c.Text(b.text,a(b))};c.util.createAccessors(c.Text)})("undefined"!=
typeof exports?exports:this);
(function(){var d=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1E3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!1,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},__widthOfSpace:[],
initialize:function(c,b){this.styles=b?b.styles||{}:{};this.callSuper("initialize",c,b);this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache");this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var c=this.styles,b;for(b in c)for(var a in c[b])for(var d in c[b][a])return!1;return!0},setSelectionStart:function(c){c=Math.max(c,0);this.selectionStart!==c&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=
c);this._updateTextarea()},setSelectionEnd:function(c){c=Math.min(c,this.text.length);this.selectionEnd!==c&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=c);this._updateTextarea()},getSelectionStyles:function(c,b){if(2===arguments.length){for(var a=[],d=c;b>d;d++)a.push(this.getSelectionStyles(d));return a}a=this.get2DCursorLocation(c);return this._getStyleDeclaration(a.lineIndex,a.charIndex)||{}},setSelectionStyles:function(c){if(this.selectionStart===
this.selectionEnd)this._extendStyles(this.selectionStart,c);else for(var b=this.selectionStart;b<this.selectionEnd;b++)this._extendStyles(b,c);return this._forceClearCache=!0,this},_extendStyles:function(c,b){var a=this.get2DCursorLocation(c);this._getLineStyle(a.lineIndex)||this._setLineStyle(a.lineIndex,{});this._getStyleDeclaration(a.lineIndex,a.charIndex)||this._setStyleDeclaration(a.lineIndex,a.charIndex,{});fabric.util.object.extend(this._getStyleDeclaration(a.lineIndex,a.charIndex),b)},_render:function(c){this.callSuper("_render",
c);this.ctx=c;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var c,b,a=this.text.split("");this.canvas.contextTop?(b=this.canvas.contextTop,b.save(),b.transform.apply(b,this.canvas.viewportTransform),this.transform(b),this.transformMatrix&&b.transform.apply(b,this.transformMatrix)):(b=this.ctx,b.save());this.selectionStart===this.selectionEnd?(c=this._getCursorBoundaries(a,"cursor"),this.renderCursor(c,b)):(c=this._getCursorBoundaries(a,"selection"),
this.renderSelection(a,c,b));b.restore()}},get2DCursorLocation:function(c){"undefined"==typeof c&&(c=this.selectionStart);for(var b=this._textLines.length,a=0;b>a;a++){if(c<=this._textLines[a].length)return{lineIndex:a,charIndex:c};c-=this._textLines[a].length+1}return{lineIndex:a-1,charIndex:this._textLines[a-1].length<c?this._textLines[a-1].length:c}},getCurrentCharStyle:function(c,b){var a=this._getStyleDeclaration(c,0===b?0:b-1);return{fontSize:a&&a.fontSize||this.fontSize,fill:a&&a.fill||this.fill,
textBackgroundColor:a&&a.textBackgroundColor||this.textBackgroundColor,textDecoration:a&&a.textDecoration||this.textDecoration,fontFamily:a&&a.fontFamily||this.fontFamily,fontWeight:a&&a.fontWeight||this.fontWeight,fontStyle:a&&a.fontStyle||this.fontStyle,stroke:a&&a.stroke||this.stroke,strokeWidth:a&&a.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(c,b){var a=this._getStyleDeclaration(c,0===b?0:b-1);return a&&a.fontSize?a.fontSize:this.fontSize},getCurrentCharColor:function(c,b){var a=
this._getStyleDeclaration(c,0===b?0:b-1);return a&&a.fill?a.fill:this.cursorColor},_getCursorBoundaries:function(c,b){var a=Math.round(this._getLeftOffset()),d=this._getTopOffset(),g=this._getCursorBoundariesOffsets(c,b);return{left:a,top:d,leftOffset:g.left+g.lineLeft,topOffset:g.top}},_getCursorBoundariesOffsets:function(c,b){for(var a=0,d=0,g=0,f=0,k=0,l=0;l<this.selectionStart;l++)"\n"===c[l]?(k=0,f+=this._getHeightOfLine(this.ctx,d),d++,g=0):(k+=this._getWidthOfChar(this.ctx,c[l],d,g),g++),a=
this._getLineLeftOffset(this._getLineWidth(this.ctx,d));return"cursor"===b&&(f+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,d)/this.lineHeight-this.getCurrentCharFontSize(d,g)*(1-this._fontSizeFraction)),{top:f,left:k,lineLeft:a}},renderCursor:function(c,b){var a=this.get2DCursorLocation(),d=a.lineIndex,a=a.charIndex,g=this.getCurrentCharFontSize(d,a),f=0===d&&0===a?this._getLineLeftOffset(this._getLineWidth(b,d)):c.leftOffset;b.fillStyle=this.getCurrentCharColor(d,a);b.globalAlpha=
this.__isMousedown?1:this._currentCursorOpacity;b.fillRect(c.left+f,c.top+c.topOffset,this.cursorWidth/this.scaleX,g)},renderSelection:function(c,b,a){a.fillStyle=this.selectionColor;c=this.get2DCursorLocation(this.selectionStart);for(var d=this.get2DCursorLocation(this.selectionEnd),g=c.lineIndex,f=d.lineIndex,k=g;f>=k;k++){var l=this._getLineLeftOffset(this._getLineWidth(a,k))||0,m=this._getHeightOfLine(this.ctx,k),p=0,n=this._textLines[k];if(k===g)for(var q=0,t=n.length;t>q;q++)q>=c.charIndex&&
(k!==f||q<d.charIndex)&&(p+=this._getWidthOfChar(a,n[q],k,q)),q<c.charIndex&&(l+=this._getWidthOfChar(a,n[q],k,q));else if(k>g&&f>k)p+=this._getLineWidth(a,k)||5;else if(k===f)for(q=0,t=d.charIndex;t>q;q++)p+=this._getWidthOfChar(a,n[q],k,q);a.fillRect(b.left+l,b.top+b.topOffset,p,m);b.topOffset+=m}},_renderChars:function(c,b,a,d,g,f,k){if(this.isEmptyStyles())return this._renderCharsFast(c,b,a,d,g);k=k||0;this.skipTextAlign=!0;d-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:
0;var e=this._getHeightOfLine(b,f);var m=this._getLineLeftOffset(this._getLineWidth(b,f));var p="";d+=m||0;b.save();g-=e/this.lineHeight*this._fontSizeFraction;for(var n=k,q=a.length+k;q>=n;n++){var t=t||this.getCurrentCharStyle(f,n);m=this.getCurrentCharStyle(f,n+1);(this._hasStyleChanged(t,m)||n===q)&&(this._renderChar(c,b,f,n-1,p,d,g,e),p="",t=m);p+=a[n-k]}b.restore()},_renderCharsFast:function(c,b,a,d,g){this.skipTextAlign=!1;"fillText"===c&&this.fill&&this.callSuper("_renderChars",c,b,a,d,g);
"strokeText"===c&&(this.stroke&&0<this.strokeWidth||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",c,b,a,d,g)},_renderChar:function(c,b,a,d,g,f,k,l){var e,p,n,q,t,w=this._getStyleDeclaration(a,d);w?(e=this._getHeightOfChar(b,g,a,d),n=w.stroke,p=w.fill,t=w.textDecoration):e=this.fontSize;n=(n||this.stroke)&&"strokeText"===c;p=(p||this.fill)&&"fillText"===c;w&&b.save();c=this._applyCharStylesGetWidth(b,g,a,d,w||{});t=t||this.textDecoration;p&&b.fillText(g,f,k);n&&b.strokeText(g,f,k);(t||""!==
t)&&(q=this._fontSizeFraction*l/this.lineHeight,this._renderCharDecoration(b,t,f,k,q,c,e));w&&b.restore();b.translate(c,0)},_hasStyleChanged:function(c,b){return c.fill!==b.fill||c.fontSize!==b.fontSize||c.textBackgroundColor!==b.textBackgroundColor||c.textDecoration!==b.textDecoration||c.fontFamily!==b.fontFamily||c.fontWeight!==b.fontWeight||c.fontStyle!==b.fontStyle||c.stroke!==b.stroke||c.strokeWidth!==b.strokeWidth},_renderCharDecoration:function(c,b,a,d,g,f,k){if(b){g=k/15;var e={underline:d+
k/10,"line-through":d-k*(this._fontSizeFraction+this._fontSizeMult-1)+g,overline:d-(this._fontSizeMult-this._fontSizeFraction)*k},m=["underline","line-through","overline"];for(d=0;d<m.length;d++)k=m[d],-1<b.indexOf(k)&&c.fillRect(a,e[k],f,g)}},_renderTextLine:function(c,b,a,d,g,f){this.isEmptyStyles()||(g+=this.fontSize*(this._fontSizeFraction+.03));this.callSuper("_renderTextLine",c,b,a,d,g,f)},_renderTextDecoration:function(c){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",c):
void 0},_renderTextLinesBackground:function(c){if(this.textBackgroundColor||this.styles){c.save();this.textBackgroundColor&&(c.fillStyle=this.textBackgroundColor);for(var b=0,a=0,d=this._textLines.length;d>a;a++){var g=this._getHeightOfLine(c,a);if(""!==this._textLines[a]){var f=this._getLineWidth(c,a),k=this._getLineLeftOffset(f);if(this.textBackgroundColor&&(c.fillStyle=this.textBackgroundColor,c.fillRect(this._getLeftOffset()+k,this._getTopOffset()+b,f,g/this.lineHeight)),this._getLineStyle(a))for(var f=
0,l=this._textLines[a].length;l>f;f++){var m=this._getStyleDeclaration(a,f);if(m&&m.textBackgroundColor){var p=this._textLines[a][f];c.fillStyle=m.textBackgroundColor;c.fillRect(this._getLeftOffset()+k+this._getWidthOfCharsAt(c,a,f),this._getTopOffset()+b,this._getWidthOfChar(c,p,a,f)+1,g/this.lineHeight)}}}b+=g}c.restore()}},_getCacheProp:function(c,b){return c+b.fontFamily+b.fontSize+b.fontWeight+b.fontStyle+b.shadow},_applyCharStylesGetWidth:function(c,b,a,e,g){var f;a=this._getStyleDeclaration(a,
e);g=g||d(a);this._applyFontStyles(g);e=this._getCacheProp(b,g);if(!a&&this._charWidthsCache[e]&&this.caching)return this._charWidthsCache[e];"string"==typeof g.shadow&&(g.shadow=new fabric.Shadow(g.shadow));a=g.fill||this.fill;return c.fillStyle=a.toLive?a.toLive(c,this):a,g.stroke&&(c.strokeStyle=g.stroke&&g.stroke.toLive?g.stroke.toLive(c,this):g.stroke),c.lineWidth=g.strokeWidth||this.strokeWidth,c.font=this._getFontDeclaration.call(g),this._setShadow.call(g,c),this.caching&&this._charWidthsCache[e]||
(f=c.measureText(b).width,this.caching&&(this._charWidthsCache[e]=f)),this._charWidthsCache[e]},_applyFontStyles:function(c){c.fontFamily||(c.fontFamily=this.fontFamily);c.fontSize||(c.fontSize=this.fontSize);c.fontWeight||(c.fontWeight=this.fontWeight);c.fontStyle||(c.fontStyle=this.fontStyle)},_getStyleDeclaration:function(c,b,a){return a?this.styles[c]&&this.styles[c][b]?d(this.styles[c][b]):{}:this.styles[c]&&this.styles[c][b]?this.styles[c][b]:null},_setStyleDeclaration:function(c,b,a){this.styles[c][b]=
a},_deleteStyleDeclaration:function(c,b){delete this.styles[c][b]},_getLineStyle:function(c){return this.styles[c]},_setLineStyle:function(c,b){this.styles[c]=b},_deleteLineStyle:function(c){delete this.styles[c]},_getWidthOfChar:function(c,b,a,d){if("justify"===this.textAlign&&this._reSpacesAndTabs.test(b))return this._getWidthOfSpace(c,a);var e=this._getStyleDeclaration(a,d,!0);this._applyFontStyles(e);e=this._getCacheProp(b,e);if(this._charWidthsCache[e]&&this.caching)return this._charWidthsCache[e];
if(c)return c.save(),b=this._applyCharStylesGetWidth(c,b,a,d),c.restore(),b},_getHeightOfChar:function(c,b,a){return(c=this._getStyleDeclaration(b,a))&&c.fontSize?c.fontSize:this.fontSize},_getWidthOfCharsAt:function(c,b,a){var d,g=0;for(d=0;a>d;d++){var f=this._textLines[b][d];g+=this._getWidthOfChar(c,f,b,d)}return g},_getLineWidth:function(c,b){return this.__lineWidths[b]?this.__lineWidths[b]:(this.__lineWidths[b]=this._getWidthOfCharsAt(c,b,this._textLines[b].length),this.__lineWidths[b])},_getWidthOfSpace:function(c,
b){if(this.__widthOfSpace[b])return this.__widthOfSpace[b];var a=this._textLines[b],d=this._getWidthOfWords(c,a,b,0),d=this.width-d,a=a.length-a.replace(this._reSpacesAndTabs,"").length,a=d/a;return this.__widthOfSpace[b]=a,a},_getWidthOfWords:function(c,b,a,d){for(var e=0,f=0;f<b.length;f++){var k=b[f];k.match(/\s/)||(e+=this._getWidthOfChar(c,k,a,f+d))}return e},_getHeightOfLine:function(c,b){if(this.__lineHeights[b])return this.__lineHeights[b];for(var a=this._textLines[b],d=this._getHeightOfChar(c,
b,0),g=1,a=a.length;a>g;g++){var f=this._getHeightOfChar(c,b,g);f>d&&(d=f)}return this.__lineHeights[b]=d*this.lineHeight*this._fontSizeMult,this.__lineHeights[b]},_getTextHeight:function(c){for(var b=0,a=0,d=this._textLines.length;d>a;a++)b+=this._getHeightOfLine(c,a);return b},_renderTextBoxBackground:function(c){this.backgroundColor&&(c.save(),c.fillStyle=this.backgroundColor,c.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),c.restore())},toObject:function(c){var b,
a,e={};for(b in this.styles){var g=this.styles[b];e[b]={};for(a in g)e[b][a]=d(g[a])}return fabric.util.object.extend(this.callSuper("toObject",c),{styles:e})}});fabric.IText.fromObject=function(c){return new fabric.IText(c.text,d(c))}})();
(function(){var d=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var c=this;setTimeout(function(){c.selected=!0},100)})},initAddedHandler:function(){var c=this;this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers());
c.canvas&&(c.canvas._iTextInstances=c.canvas._iTextInstances||[],c.canvas._iTextInstances.push(c))})},initRemovedHandler:function(){var c=this;this.on("removed",function(){c.canvas&&(c.canvas._iTextInstances=c.canvas._iTextInstances||[],fabric.util.removeFromArray(c.canvas._iTextInstances,c))})},_initCanvasHandlers:function(){var c=this;this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers(c.canvas)});this.canvas.on("mouse:up",function(){c.canvas._iTextInstances&&
c.canvas._iTextInstances.forEach(function(b){b.__isMousedown=!1})});this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers(c.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(c,b,a,d){var e;return e={isAborted:!1,abort:function(){this.isAborted=!0}},c.animate("_currentCursorOpacity",b,{duration:a,onComplete:function(){e.isAborted||c[d]()},onChange:function(){c.canvas&&(c.canvas.clearContext(c.canvas.contextTop||
c.ctx),c.renderCursorOrSelection())},abort:function(){return e.isAborted}}),e},_onTickComplete:function(){var c=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){c._currentTickCompleteState=c._animateCursor(c,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(c){var b=this;c=c?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);
this._currentCursorOpacity=1;this.canvas&&(this.canvas.clearContext(this.canvas.contextTop||this.ctx),this.renderCursorOrSelection());this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){b._tick()},c)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=
0;this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0);this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(c){var b=0,a=c-1;if(this._reSpace.test(this.text.charAt(a)))for(;this._reSpace.test(this.text.charAt(a));)b++,a--;for(;/\S/.test(this.text.charAt(a))&&-1<a;)b++,a--;return c-b},findWordBoundaryRight:function(c){var b=0,
a=c;if(this._reSpace.test(this.text.charAt(a)))for(;this._reSpace.test(this.text.charAt(a));)b++,a++;for(;/\S/.test(this.text.charAt(a))&&a<this.text.length;)b++,a++;return c+b},findLineBoundaryLeft:function(c){for(var b=0,a=c-1;!/\n/.test(this.text.charAt(a))&&-1<a;)b++,a--;return c-b},findLineBoundaryRight:function(c){for(var b=0,a=c;!/\n/.test(this.text.charAt(a))&&a<this.text.length;)b++,a++;return c+b},getNumNewLinesInSelectedText:function(){for(var c=this.getSelectedText(),b=0,a=0,d=c.length;d>
a;a++)"\n"===c[a]&&b++;return b},searchWordBoundary:function(c,b){for(var a=this._reSpace.test(this.text.charAt(c))?c-1:c,d=this.text.charAt(a),g=/[ \n\.,;!\?\-]/;!g.test(d)&&0<a&&a<this.text.length;)a+=b,d=this.text.charAt(a);return g.test(d)&&"\n"!==d&&(a+=1===b?0:1),a},selectWord:function(c){var b=this.searchWordBoundary(c,-1);c=this.searchWordBoundary(c,1);this.setSelectionStart(b);this.setSelectionEnd(c)},selectLine:function(c){var b=this.findLineBoundaryLeft(c);c=this.findLineBoundaryRight(c);
this.setSelectionStart(b);this.setSelectionEnd(c)},enterEditing:function(){return!this.isEditing&&this.editable?(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.renderAll(),this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this):this):void 0},exitEditingOnOthers:function(c){c._iTextInstances&&
c._iTextInstances.forEach(function(b){b.selected=!1;b.isEditing&&b.exitEditing()})},initMouseMoveHandler:function(){var c=this;this.canvas.on("mouse:move",function(b){c.__isMousedown&&c.isEditing&&(b=c.getSelectionStartFromPointer(b.e),b>=c.__selectionStartOnMouseDown?(c.setSelectionStart(c.__selectionStartOnMouseDown),c.setSelectionEnd(b)):(c.setSelectionStart(b),c.setSelectionEnd(c.__selectionStartOnMouseDown)))})},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=
this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,
hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=
this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){for(var c in this.styles)this._textLines[c]||
delete this.styles[c]},_removeCharsFromTo:function(c,b){for(;b!==c;)this._removeSingleCharAndStyle(c+1),b--;this.setSelectionStart(c)},_removeSingleCharAndStyle:function(c){var b="\n"===this.text[c-1];this.removeStyleObject(b,b?c:c-1);this.text=this.text.slice(0,c-1)+this.text.slice(c);this._textLines=this._splitTextIntoLines()},insertChars:function(c,b){var a;if(1<this.selectionEnd-this.selectionStart&&(this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart)),
!b&&this.isEmptyStyles())return void this.insertChar(c,!1);for(var d=0,g=c.length;g>d;d++)b&&(a=fabric.copiedTextStyle[d]),this.insertChar(c[d],g-1>d,a)},insertChar:function(c,b,a){var d="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+c+this.text.slice(this.selectionEnd);this._textLines=this._splitTextIntoLines();this.insertStyleObjects(c,d,a);this.selectionEnd=this.selectionStart+=c.length;b||(this._updateTextarea(),this.canvas&&this.canvas.renderAll(),this.setCoords(),
this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}))},insertNewlineStyleObject:function(c,b,a){this.shiftLineStyles(c,1);this.styles[c+1]||(this.styles[c+1]={});var e={},g={};if(this.styles[c]&&this.styles[c][b-1]&&(e=this.styles[c][b-1]),a)g[0]=d(e);else for(var f in this.styles[c])parseInt(f,10)>=b&&(g[parseInt(f,10)-b]=this.styles[c][f],delete this.styles[c][f]);this.styles[c+1]=g;this._forceClearCache=!0},insertCharStyleObject:function(c,b,a){var e=this.styles[c],
g=d(e);0!==b||a||(b=1);for(var f in g){var k=parseInt(f,10);k>=b&&(e[k+1]=g[k],g[k-1]||delete e[k])}this.styles[c][b]=a||d(e[b-1]);this._forceClearCache=!0},insertStyleObjects:function(c,b,a){var d=this.get2DCursorLocation(),g=d.lineIndex,d=d.charIndex;this._getLineStyle(g)||this._setLineStyle(g,{});"\n"===c?this.insertNewlineStyleObject(g,d,b):this.insertCharStyleObject(g,d,a)},shiftLineStyles:function(c,b){var a=d(this.styles),e;for(e in this.styles){var g=parseInt(e,10);g>c&&(this.styles[g+b]=
a[g],a[g-b]||delete this.styles[g])}},removeStyleObject:function(c,b){var a=this.get2DCursorLocation(b);this._removeStyleObject(c,a,a.lineIndex,a.charIndex)},_getTextOnPreviousLine:function(c){return this._textLines[c-1]},_removeStyleObject:function(c,b,a,e){if(c){var g=this._getTextOnPreviousLine(b.lineIndex),g=g?g.length:0;this.styles[a-1]||(this.styles[a-1]={});for(e in this.styles[a])this.styles[a-1][parseInt(e,10)+g]=this.styles[a][e];this.shiftLineStyles(b.lineIndex,-1)}else for(g in(b=this.styles[a])&&
delete b[e],a=d(b),a)c=parseInt(g,10),c>=e&&0!==c&&(b[c-1]=a[c],delete b[c])},insertNewline:function(){this.insertChars("\n")}})})();
fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(d){this.__newClickTime=+new Date;var c=this.canvas.getPointer(d.e);this.isTripleClick(c)?(this.fire("tripleclick",d),this._stopEvent(d.e)):this.isDoubleClick(c)&&(this.fire("dblclick",d),this._stopEvent(d.e));this.__lastLastClickTime=this.__lastClickTime;
this.__lastClickTime=this.__newClickTime;this.__lastPointer=c;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(d){return 500>this.__newClickTime-this.__lastClickTime&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y&&this.__lastIsEditing},isTripleClick:function(d){return 500>this.__newClickTime-this.__lastClickTime&&500>this.__lastClickTime-this.__lastLastClickTime&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y},_stopEvent:function(d){d.preventDefault&&
d.preventDefault();d.stopPropagation&&d.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(d){this.selectWord(this.getSelectionStartFromPointer(d.e))});this.on("tripleclick",function(d){this.selectLine(this.getSelectionStartFromPointer(d.e))})},initMousedownHandler:function(){this.on("mousedown",function(d){if(this.editable){var c=this.canvas.getPointer(d.e);
this.__mousedownX=c.x;this.__mousedownY=c.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(d.e);this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))}})},_isObjectMoved:function(d){d=this.canvas.getPointer(d);return this.__mousedownX!==d.x||this.__mousedownY!==d.y},initMouseupHandler:function(){this.on("mouseup",function(d){this.__isMousedown=!1;this.editable&&
!this._isObjectMoved(d.e)&&(this.__lastSelected&&!this.__corner&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(d){var c=this.getSelectionStartFromPointer(d);d.shiftKey?c<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(c)):this.setSelectionEnd(c):(this.setSelectionStart(c),this.setSelectionEnd(c))},getSelectionStartFromPointer:function(d){for(var c=this.getLocalPointer(d),b=0,a,e=0,g=0,f=0,k=this._textLines.length;k>
f;f++){d=this._textLines[f];e+=this._getHeightOfLine(this.ctx,f)*this.scaleY;a=this._getLineWidth(this.ctx,f);a=this._getLineLeftOffset(a)*this.scaleX;this.flipX&&(this._textLines[f]=d.reverse().join(""));for(var l=0,m=d.length;m>l;l++){if(b=a,a+=this._getWidthOfChar(this.ctx,d[l],f,this.flipX?m-l:l)*this.scaleX,!(e<=c.y||a<=c.x))return this._getNewSelectionStartFromOffset(c,b,a,g+f,m);g++}if(c.y<e)return this._getNewSelectionStartFromOffset(c,b,a,g+f-1,m)}return this.text.length},_getNewSelectionStartFromOffset:function(d,
c,b,a,e){d=a+(b-d.x>d.x-c?0:1);return this.flipX&&(d=e-d),d>this.text.length&&(d=this.text.length),d}});
fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,
"input",this.onInput.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",
37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(d){if(this.isEditing){if(d.keyCode in this._keysMap)this[this._keysMap[d.keyCode]](d);else{if(!(d.keyCode in this._ctrlKeysMap&&(d.ctrlKey||d.metaKey)))return;this[this._ctrlKeysMap[d.keyCode]](d)}d.stopImmediatePropagation();d.preventDefault();this.canvas&&this.canvas.renderAll()}},
onInput:function(d){if(this.isEditing){var c=this.selectionStart||0,c=this.hiddenTextarea.value.slice(c,c+(this.hiddenTextarea.value.length-this.text.length+(this.selectionEnd||0)-c));this.insertChars(c);d.stopPropagation()}},forwardDelete:function(d){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(d)}this.removeChars(d)},copy:function(d){var c=this.getSelectedText();(d=this._getClipboardData(d))&&d.setData("text",c);fabric.copiedText=
c;fabric.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(d){var c=null,b=this._getClipboardData(d),a=!0;b?(c=b.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===c||(a=!1)):c=fabric.copiedText;c&&this.insertChars(c,a);d.stopImmediatePropagation();d.preventDefault()},cut:function(d){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(d))},_getClipboardData:function(d){return d&&(d.clipboardData||fabric.window.clipboardData)},
getDownCursorOffset:function(d,c){var b=c?this.selectionEnd:this.selectionStart;var a=this.get2DCursorLocation(b),e=a.lineIndex,g=this._textLines[e].slice(0,a.charIndex),f=this._textLines[e].slice(a.charIndex),k=this._textLines[e+1]||"";if(e===this._textLines.length-1||d.metaKey||34===d.keyCode)return this.text.length-b;b=this._getLineWidth(this.ctx,e);for(var l=this._getLineLeftOffset(b),m=0,p=g.length;p>m;m++)b=g[m],l+=this._getWidthOfChar(this.ctx,b,e,m);a=this._getIndexOnNextLine(a,k,l);return f.length+
1+a},_getIndexOnNextLine:function(d,c,b){d=d.lineIndex+1;for(var a=this._getLineWidth(this.ctx,d),a=this._getLineLeftOffset(a),e=0,g=0,f=c.length;f>g;g++){var k=this._getWidthOfChar(this.ctx,c[g],d,g);if(a+=k,a>b){var l=!0;e=Math.abs(a-k-b)>Math.abs(a-b)?g+1:g;break}}return l||(e=c.length),e},moveCursorDown:function(d){this.abortCursorAnimation();this._currentCursorOpacity=1;var c=this.getDownCursorOffset(d,"right"===this._selectionDirection);d.shiftKey?this.moveCursorDownWithShift(c):this.moveCursorDownWithoutShift(c);
this.initDelayedCursor()},moveCursorDownWithoutShift:function(d){this._selectionDirection="right";this.setSelectionStart(this.selectionStart+d);this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var d=this.selectionEnd;this.setSelectionEnd(this.selectionStart);this.setSelectionStart(d)},moveCursorDownWithShift:function(d){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right");"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd+d):this.setSelectionStart(this.selectionStart+
d);this.selectionEnd<this.selectionStart&&"left"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="right");this.selectionEnd>this.text.length&&this.setSelectionEnd(this.text.length)},getUpCursorOffset:function(d,c){var b=c?this.selectionEnd:this.selectionStart,a=this.get2DCursorLocation(b),e=a.lineIndex;if(0===e||d.metaKey||33===d.keyCode)return b;var b=this._textLines[e].slice(0,a.charIndex),g=this._textLines[e-1]||"";var f=this._getLineWidth(this.ctx,a.lineIndex);
for(var k=this._getLineLeftOffset(f),l=0,m=b.length;m>l;l++)f=b[l],k+=this._getWidthOfChar(this.ctx,f,e,l);a=this._getIndexOnPrevLine(a,g,k);return g.length-a+b.length},_getIndexOnPrevLine:function(d,c,b){d=d.lineIndex-1;for(var a=this._getLineWidth(this.ctx,d),a=this._getLineLeftOffset(a),e=0,g=0,f=c.length;f>g;g++){var k=this._getWidthOfChar(this.ctx,c[g],d,g);if(a+=k,a>b){var l=!0;e=Math.abs(a-k-b)>Math.abs(a-b)?g:g-1;break}}return l||(e=c.length-1),e},moveCursorUp:function(d){this.abortCursorAnimation();
this._currentCursorOpacity=1;var c=this.getUpCursorOffset(d,"right"===this._selectionDirection);d.shiftKey?this.moveCursorUpWithShift(c):this.moveCursorUpWithoutShift(c);this.initDelayedCursor()},moveCursorUpWithShift:function(d){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left");"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd-d):this.setSelectionStart(this.selectionStart-d);this.selectionEnd<this.selectionStart&&"right"===this._selectionDirection&&
(this.swapSelectionPoints(),this._selectionDirection="left")},moveCursorUpWithoutShift:function(d){this.selectionStart===this.selectionEnd&&this.setSelectionStart(this.selectionStart-d);this.setSelectionEnd(this.selectionStart);this._selectionDirection="left"},moveCursorLeft:function(d){0===this.selectionStart&&0===this.selectionEnd||(this.abortCursorAnimation(),this._currentCursorOpacity=1,d.shiftKey?this.moveCursorLeftWithShift(d):this.moveCursorLeftWithoutShift(d),this.initDelayedCursor())},_move:function(d,
c,b){var a="selectionStart"===c?"setSelectionStart":"setSelectionEnd";d.altKey?this[a](this["findWordBoundary"+b](this[c])):d.metaKey||35===d.keyCode||36===d.keyCode?this[a](this["findLineBoundary"+b](this[c])):this[a](this[c]+("Left"===b?-1:1))},_moveLeft:function(d,c){this._move(d,c,"Left")},_moveRight:function(d,c){this._move(d,c,"Right")},moveCursorLeftWithoutShift:function(d){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(d,"selectionStart");this.setSelectionEnd(this.selectionStart)},
moveCursorLeftWithShift:function(d){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(d,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(d,"selectionStart"))},moveCursorRight:function(d){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,d.shiftKey?this.moveCursorRightWithShift(d):this.moveCursorRightWithoutShift(d),this.initDelayedCursor())},moveCursorRightWithShift:function(d){"left"===
this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(d,"selectionStart"):(this._selectionDirection="right",this._moveRight(d,"selectionEnd"))},moveCursorRightWithoutShift:function(d){this._selectionDirection="right";this.selectionStart===this.selectionEnd?(this._moveRight(d,"selectionStart"),this.setSelectionEnd(this.selectionStart)):(this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText()),this.setSelectionStart(this.selectionEnd))},removeChars:function(d){this.selectionStart===
this.selectionEnd?this._removeCharsNearCursor(d):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.setSelectionEnd(this.selectionStart);this._removeExtraneousStyles();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(d){0!==this.selectionStart&&(d.metaKey?(d=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(d,this.selectionStart),this.setSelectionStart(d)):
d.altKey?(d=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(d,this.selectionStart),this.setSelectionStart(d)):(this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)))}});
(function(){var d=fabric.util.toFixed,c=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(b,a,c,d,f,k){this.styles[b]?this._setSVGTextLineChars(b,a,c,d,k):fabric.Text.prototype._setSVGTextLineText.call(this,b,a,c,d,f)},_setSVGTextLineChars:function(b,a,c,d,f){c=this._textLines[b];d=0;for(var e=this._getLineLeftOffset(this._getLineWidth(this.ctx,b))-this.width/2,g=this._getSVGLineTopOffset(b),m=this._getHeightOfLine(this.ctx,b),p=0,n=c.length;n>
p;p++){var q=this.styles[b][p]||{};a.push(this._createTextCharSpan(c[p],q,e,g.lineTop+g.offset,d));var t=this._getWidthOfChar(this.ctx,c[p],b,p);q.textBackgroundColor&&f.push(this._createTextCharBg(q,e,g.lineTop,m,t,d));d+=t}},_getSVGLineTopOffset:function(b){for(var a=0,c=0,d=0;b>d;d++)a+=this._getHeightOfLine(this.ctx,d);return c=this._getHeightOfLine(this.ctx,d),{lineTop:a,offset:(this._fontSizeMult-this._fontSizeFraction)*c/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(b,a,
e,g,f,k){return['<rect fill="',b.textBackgroundColor,'" x="',d(a+k,c),'" y="',d(e-this.height/2,c),'" width="',d(f,c),'" height="',d(g/this.lineHeight,c),'"></rect>'].join("")},_createTextCharSpan:function(b,a,e,g,f){var k=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},a));return['<tspan x="',d(e+f,c),'" y="',d(g-this.height/2,c),'" ',a.fontFamily?'font-family="'+a.fontFamily.replace(/"/g,
"'")+'" ':"",a.fontSize?'font-size="'+a.fontSize+'" ':"",a.fontStyle?'font-style="'+a.fontStyle+'" ':"",a.fontWeight?'font-weight="'+a.fontWeight+'" ':"",a.textDecoration?'text-decoration="'+a.textDecoration+'" ':"",'style="',k,'">',fabric.util.string.escapeXml(b),"</tspan>"].join("")}})})();
(function(d){var c=d.fabric||(d.fabric={}),b=c.util.object.clone;c.Textbox=c.util.createClass(c.IText,c.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:0,__cachedLines:null,initialize:function(a,b){this.ctx=c.util.createCanvasElement().getContext("2d");this.callSuper("initialize",a,b);this.set({lockUniScaling:!1,lockScalingY:!0,lockScalingFlip:!0,hasBorders:!0});this.setControlsVisibility(c.Textbox.getTextboxControlVisibility());this._dimensionAffectingProps.width=!0},_initDimensions:function(a){this.__skipDimension||
(a||(a=c.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(a))},_generateStyleMap:function(){for(var a=0,b=0,c=0,d={},k=0;k<this._textLines.length;k++)"\n"===this.text[c]?(b=0,c++,a++):" "===this.text[c]&&(b++,c++),d[k]={line:a,offset:b},c+=this._textLines[k].length,b+=this._textLines[k].length;
return d},_getStyleDeclaration:function(a,b,c){if(this._styleMap){var d=this._styleMap[a];if(!d)return c?{}:null;a=d.line;b=d.offset+b}return this.callSuper("_getStyleDeclaration",a,b,c)},_setStyleDeclaration:function(a,b,c){var d=this._styleMap[a];a=d.line;b=d.offset+b;this.styles[a][b]=c},_deleteStyleDeclaration:function(a,b){var c=this._styleMap[a];a=c.line;b=c.offset+b;delete this.styles[a][b]},_getLineStyle:function(a){return this.styles[this._styleMap[a].line]},_setLineStyle:function(a,b){this.styles[this._styleMap[a].line]=
b},_deleteLineStyle:function(a){delete this.styles[this._styleMap[a].line]},_wrapText:function(a,b){var c,d=b.split(this._reNewline),e=[];for(c=0;c<d.length;c++)e=e.concat(this._wrapLine(a,d[c],c));return e},_measureText:function(a,b,c,d){var e=0;d=d||0;for(var f=0,g=b.length;g>f;f++)e+=this._getWidthOfChar(a,b[f],c,f+d);return e},_wrapLine:function(a,b,c){var d=0,e=[],g="";b=b.split(" ");for(var m,p=0,n,q=0,t=0,w=0;w<b.length;w++)m=b[w],n=this._measureText(a,m,c,p),p+=m.length,d+=q+n,d>=this.width&&
""!==g&&(e.push(g),g="",d=n),""===g&&1!==w||(g+=" "),g+=m,q=this._measureText(a," ",c,p),p++,n>t&&(t=n);return w&&e.push(g),t>this.dynamicMinWidth&&(this.dynamicMinWidth=t),e},_splitTextIntoLines:function(){var a=this.textAlign;this.ctx.save();this._setTextStyles(this.ctx);this.textAlign="left";var b=this._wrapText(this.ctx,this.text);return this.textAlign=a,this.ctx.restore(),this._textLines=b,this._styleMap=this._generateStyleMap(),b},setOnGroup:function(a,b){"scaleX"===a&&(this.set("scaleX",Math.abs(1/
b)),this.set("width",this.get("width")*b/("undefined"==typeof this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=b)},get2DCursorLocation:function(a){"undefined"==typeof a&&(a=this.selectionStart);for(var b=this._textLines.length,c=0,d=0;b>d;d++){var k=this._textLines[d].length;if(c+k>=a)return{lineIndex:d,charIndex:a-c};c+=k;"\n"!==this.text[c]&&" "!==this.text[c]||c++}return{lineIndex:b-1,charIndex:this._textLines[b-1].length}},_getCursorBoundariesOffsets:function(a,b){for(var c=0,d=0,e=this.get2DCursorLocation(),
l=this._textLines[e.lineIndex].split(""),m=this._getLineLeftOffset(this._getLineWidth(this.ctx,e.lineIndex)),p=0;p<e.charIndex;p++)d+=this._getWidthOfChar(this.ctx,l[p],e.lineIndex,p);for(p=0;p<e.lineIndex;p++)c+=this._getHeightOfLine(this.ctx,p);return"cursor"===b&&(c+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,e.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(e.lineIndex,e.charIndex)*(1-this._fontSizeFraction)),{top:c,left:d,lineLeft:m}},getMinWidth:function(){return Math.max(this.minWidth,
this.dynamicMinWidth)},toObject:function(a){return c.util.object.extend(this.callSuper("toObject",a),{minWidth:this.minWidth})}});c.Textbox.fromObject=function(a){return new c.Textbox(a.text,b(a))};c.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}};c.Textbox.instances=[]})("undefined"!=typeof exports?exports:this);
(function(){var d=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(b,a,c,g,f,k,l){var e=a.target;e instanceof fabric.Textbox?(b=b.x/a.scaleX/(e.width+e.strokeWidth)*e.width,b>=e.getMinWidth()&&e.set("width",b)):d.call(fabric.Canvas.prototype,b,a,c,g,f,k,l)};fabric.Group.prototype._refreshControlsVisibility=function(){if("undefined"!=typeof fabric.Textbox)for(var b=this._objects.length;b--;)if(this._objects[b]instanceof fabric.Textbox)return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility())};
var c=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var b in this._styleMap)this._textLines[b]||delete this.styles[this._styleMap[b].line]},insertCharStyleObject:function(b,a,c){var d=this._styleMap[b];b=d.line;a=d.offset+a;fabric.IText.prototype.insertCharStyleObject.apply(this,[b,a,c])},insertNewlineStyleObject:function(b,a,c){var d=this._styleMap[b];b=d.line;a=d.offset+a;fabric.IText.prototype.insertNewlineStyleObject.apply(this,
[b,a,c])},shiftLineStyles:function(b,a){var d=c(this.styles);b=this._styleMap[b].line;for(var g in this.styles){var f=parseInt(g,10);f>b&&(this.styles[f+a]=d[f],d[f-a]||delete this.styles[f])}},_getTextOnPreviousLine:function(b){for(var a=this._textLines[b-1];this._styleMap[b-2]&&this._styleMap[b-2].line===this._styleMap[b-1].line;)a=this._textLines[b-2]+a,b--;return a},removeStyleObject:function(b,a){var c=this.get2DCursorLocation(a),d=this._styleMap[c.lineIndex];this._removeStyleObject(b,c,d.line,
d.offset+c.charIndex)}})})();(function(){var d=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(c,b,a,e,g){e=d.call(this,c,b,a,e,g);for(a=b=c=0;a<this._textLines.length&&(c+=this._textLines[a].length,!(c+b>=e));a++)"\n"!==this.text[c+b]&&" "!==this.text[c+b]||b++;return e-a+b}})();
(function(){function d(b,c,d){var f=a.parse(b);f.port||(f.port=0===f.protocol.indexOf("https:")?443:80);b=(0===f.protocol.indexOf("https:")?g:e).request({hostname:f.hostname,port:f.port,path:f.path,method:"GET"},function(a){var b="";c&&a.setEncoding(c);a.on("end",function(){d(b)});a.on("data",function(c){200===a.statusCode&&(b+=c)})});b.on("error",function(a){a.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+f.hostname+":"+f.port):fabric.log(a.message);d(null)});b.end()}
function c(a,b){require("fs").readFile(a,function(a,c){if(a)throw fabric.log(a),a;b(c)})}if("undefined"==typeof document||"undefined"==typeof window){var b=require("xmldom").DOMParser;var a=require("url");var e=require("http");var g=require("https");var f=require("canvas"),k=require("canvas").Image;fabric.util.loadImage=function(a,b,e){function f(c){c?(g.src=new Buffer(c,"binary"),g._src=a,b&&b.call(e,g)):(g=null,b&&b.call(e,null,!0))}var g=new k;a&&(a instanceof Buffer||0===a.indexOf("data"))?(g.src=
g._src=a,b&&b.call(e,g)):a&&0!==a.indexOf("http")?c(a,f):a?d(a,"binary",f):b&&b.call(e,a)};fabric.loadSVGFromURL=function(a,b,e){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();0!==a.indexOf("http")?c(a,function(a){fabric.loadSVGFromString(a.toString(),b,e)}):d(a,"",function(a){fabric.loadSVGFromString(a,b,e)})};fabric.loadSVGFromString=function(a,c,d){a=(new b).parseFromString(a);fabric.parseSVGDocument(a.documentElement,function(a,b){c&&c(a,b)},d)};fabric.util.getScript=function(a,b){d(a,"",
function(a){eval(a);b&&b()})};fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,function(c){var d=new fabric.Image(c);d._initConfig(a);d._initFilters(a.filters,function(c){d.filters=c||[];d._initFilters(a.resizeFilters,function(a){d.resizeFilters=a||[];b&&b(d)})})})};fabric.createCanvasForNode=function(a,b,c,d){d=d||c;var e=fabric.document.createElement("canvas");a=new f(a||600,b||600,d);e.style={};e.width=a.width;e.height=a.height;c=new (fabric.Canvas||fabric.StaticCanvas)(e,c);return c.contextContainer=
a.getContext("2d"),c.nodeCanvas=a,c.Font=f.Font,c};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};var l=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(a,b){return l.call(this,a,b),this.nodeCanvas.width=a,this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var m=fabric.StaticCanvas.prototype.setHeight;
fabric.StaticCanvas.prototype.setHeight=function(a,b){return m.call(this,a,b),this.nodeCanvas.height=a,this};fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}})();
function initAligningGuidelines(d){function c(b,c,d,f){a.save();a.lineWidth=1;a.strokeStyle="rgb(0,255,0)";a.beginPath();a.moveTo((b+e[4])*g,(c+e[5])*g);a.lineTo((d+e[4])*g,(f+e[5])*g);a.stroke();a.restore()}function b(a,b){a=Math.round(a);b=Math.round(b);for(var c=a-4,d=a+4;c<=d;c++)if(c===b)return!0;return!1}var a=d.getSelectionContext(),e,g=1,f=[],k=[];d.on("mouse:down",function(){e=d.viewportTransform;g=d.getZoom()});d.on("object:moving",function(a){a=a.target;var c=d.getObjects(),g=a.getCenterPoint(),
l=g.x,g=g.y,q=a.getBoundingRectHeight()/e[3],t=a.getBoundingRectWidth()/e[0],w=!1,C=!1;if(d._currentTransform){for(var B=c.length;B--;)if(c[B]!==a){var v=c[B].getCenterPoint(),r=v.x,v=v.y,u=c[B].getBoundingRectHeight()/e[3],y=c[B].getBoundingRectWidth()/e[0];b(r,l)&&(C=!0,f.push({x:r,y1:v<g?v-u/2-5:v+u/2+5,y2:g>v?g+q/2+5:g-q/2-5}),a.setPositionByOrigin(new fabric.Point(r,g),"center","center"));b(r-y/2,l-t/2)&&(C=!0,f.push({x:r-y/2,y1:v<g?v-u/2-5:v+u/2+5,y2:g>v?g+q/2+5:g-q/2-5}),a.setPositionByOrigin(new fabric.Point(r-
y/2+t/2,g),"center","center"));b(r+y/2,l+t/2)&&(C=!0,f.push({x:r+y/2,y1:v<g?v-u/2-5:v+u/2+5,y2:g>v?g+q/2+5:g-q/2-5}),a.setPositionByOrigin(new fabric.Point(r+y/2-t/2,g),"center","center"));b(v,g)&&(w=!0,k.push({y:v,x1:r<l?r-y/2-5:r+y/2+5,x2:l>r?l+t/2+5:l-t/2-5}),a.setPositionByOrigin(new fabric.Point(l,v),"center","center"));b(v-u/2,g-q/2)&&(w=!0,k.push({y:v-u/2,x1:r<l?r-y/2-5:r+y/2+5,x2:l>r?l+t/2+5:l-t/2-5}),a.setPositionByOrigin(new fabric.Point(l,v-u/2+q/2),"center","center"));b(v+u/2,g+q/2)&&
(w=!0,k.push({y:v+u/2,x1:r<l?r-y/2-5:r+y/2+5,x2:l>r?l+t/2+5:l-t/2-5}),a.setPositionByOrigin(new fabric.Point(l,v+u/2-q/2),"center","center"))}w||(k.length=0);C||(f.length=0)}});d.on("before:render",function(){d.clearContext(d.contextTop)});d.on("after:render",function(){for(var a=f.length;a--;){var b=f[a];c(b.x+.5,b.y1>b.y2?b.y2:b.y1,b.x+.5,b.y2>b.y1?b.y2:b.y1)}for(a=k.length;a--;)b=k[a],c(b.x1>b.x2?b.x2:b.x1,b.y+.5,b.x2>b.x1?b.x2:b.x1,b.y+.5);f.length=k.length=0});d.on("mouse:up",function(){f.length=
k.length=0;d.renderAll()})}
function initCenteringGuidelines(d){function c(a,b,c,d){l.save();l.strokeStyle="rgba(255,0,241,0.5)";l.lineWidth=1;l.beginPath();l.moveTo(a*m[0],b*m[3]);l.lineTo(c*m[0],d*m[3]);l.stroke();l.restore()}for(var b=d.getWidth(),a=d.getHeight(),e=b/2,g=a/2,f={},k={},l=d.getSelectionContext(),m,p=e-4,n=e+4;p<=n;p++)f[Math.round(p)]=!0;p=g-4;for(n=g+4;p<=n;p++)k[Math.round(p)]=!0;var q,t;d.on("mouse:down",function(){m=d.viewportTransform});d.on("object:moving",function(a){a=a.target;var b=a.getCenterPoint();
d._currentTransform&&(q=Math.round(b.x)in f,((t=Math.round(b.y)in k)||q)&&a.setPositionByOrigin(new fabric.Point(q?e:b.x,t?g:b.y),"center","center"))});d.on("before:render",function(){d.clearContext(d.contextTop)});d.on("after:render",function(){q&&c(e+.5,0,e+.5,a);t&&c(0,g+.5,b,g+.5)});d.on("mouse:up",function(){q=t=null;d.renderAll()})}
(function(){function d(a,c){a=void 0===a?"":a;c=void 0===c?"":c;""==a&&null!=document.getElementById("canva-row")?b.setWidth(document.getElementById("canva-row").offsetWidth):(b.setWidth(a),b.setHeight(c))}function c(a){fabric.Image.fromURL(a,function(a){b.add(a.set({left:110,top:110}).scale(.5))})}var b=new fabric.Canvas("canvas");b.backgroundColor="white";$("#canva-row").hide();$(".item-handler").hide();null!=document.getElementById("fileupload")&&(document.getElementById("fileupload").onchange=
function(a){var c=new FileReader;$("#canva-row").show();$(".item-handler").show();c.onload=function(a){$(".button-submit").show({duration:"260",easing:"easeInOutBack"});var c=new Image;c.src=a.target.result;c.onload=function(){var a=new fabric.Image(c);d(a.width,a.height);a.set("selectable",!1);b.add(a);b.centerObject(a)}};c.readAsDataURL(a.target.files[0])});window.addEventListener("resize",d,!1);d();initAligningGuidelines(b);initCenteringGuidelines(b);b.observe("object:modified",function(a){});
$(".menu img, .menu > img").on("click",function(){c(this.src)});$("#saveToPng").on("click",function(){b.setActiveGroup(new fabric.Group(b.getObjects())).renderAll();var a=b.getActiveGroup();b.discardActiveObject().renderAll();b.discardActiveGroup().renderAll();var c=document.createElement("canvas"),d=c.getContext("2d");c.width=a.width+60;c.height=a.height+60;var f=a.left-a.width/2-30,k=a.top-a.height/2-30;0>f&&(f=0);0>k&&(k=0);d.drawImage(b.getElement(),f,k,a.width+60,a.height+60,0,0,a.width+60,a.height+
60);Canvas2Image.saveAsJPEG(c)});$("#delete").on("click",function(){b.remove(b.getActiveObject())});$("#addText").on("click",function(){var a=new fabric.Text($("#canvaText").val(),{left:210,top:110});b.add(a)});$("#text-bold").click(function(){var a=b.getActiveObject();a&&"text"===a.type&&(a.fontWeight="bold"==a.fontWeight?"":"bold",b.renderAll())});$("#text-italic").click(function(){var a=b.getActiveObject();a&&"text"===a.type&&(a.fontStyle="italic"==a.fontStyle?"":"italic",b.renderAll())});$("#text-strike").click(function(){var a=
b.getActiveObject();a&&"text"===a.type&&(a.textDecoration="line-through"==a.textDecoration?"":"line-through",b.renderAll())});$("#text-underline").click(function(){var a=b.getActiveObject();a&&"text"===a.type&&(a.textDecoration="underline"==a.textDecoration?"":"underline",b.renderAll())});$("#text-left").click(function(){var a=b.getActiveObject();a&&"text"===a.type&&(a.textAlign="left",b.renderAll())});$("#text-center").click(function(){var a=b.getActiveObject();a&&"text"===a.type&&(a.textAlign="center",
b.renderAll())});$("#text-right").click(function(){var a=b.getActiveObject();a&&"text"===a.type&&(a.textAlign="right",b.renderAll())});$("#font-family").change(function(){var a=b.getActiveObject();a&&"text"===a.type&&(a.fontFamily=this.value,b.renderAll())});$("#text-bgcolor").miniColors({change:function(a,c){var d=b.getActiveObject();d&&"text"===d.type&&(d.backgroundColor=this.value,b.renderAll())},open:function(a,b){},close:function(a,b){}});$("#text-fontcolor").miniColors({change:function(a,c){var d=
b.getActiveObject();d&&"text"===d.type&&(d.fill=this.value,b.renderAll())},open:function(a,b){},close:function(a,b){}});$("#text-strokecolor").miniColors({change:function(a,c){var d=b.getActiveObject();d&&"text"===d.type&&(d.strokeStyle=this.value,b.renderAll())},open:function(a,b){},close:function(a,b){}});$("#send_image").click(function(a){a.preventDefault();var c=$(this).next(".msg");b.discardActiveGroup();b.discardActiveObject();b.renderAll();$.ajax({url:"upload/upload_result?type=fabric",type:"POST",
dataType:"json",data:{data:b.toDataURL("image/png"),_token:$('meta[name="csrf-token"]').attr("content")},complete:function(a,b){var d=$.parseJSON(a.responseText);c.empty();c.html('<div class="alert alert-danger msg"><button class="close" data-close="alert"></button>'+d.result.text+"</div>");1===d.result.code&&setTimeout(function(){window.location.href=base_URL+"fabric"},2E3);"success"==b&&alert("saved!")}})})})();
